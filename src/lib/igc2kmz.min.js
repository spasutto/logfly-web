"use strict";window.global=window;(()=>{var Aa=Object.create;var Kr=Object.defineProperty;var Ea=Object.getOwnPropertyDescriptor;var Ia=Object.getOwnPropertyNames;var Pa=Object.getPrototypeOf,Ma=Object.prototype.hasOwnProperty;var f=(i,t)=>Kr(i,"name",{value:t,configurable:!0}),Ae=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+i+'" is not supported')});var bt=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var Ta=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ia(t))!Ma.call(i,n)&&n!==e&&Kr(i,n,{get:()=>t[n],enumerable:!(r=Ea(t,n))||r.enumerable});return i};var ii=(i,t,e)=>(e=i!=null?Aa(Pa(i)):{},Ta(t||!i||!i.__esModule?Kr(e,"default",{value:i,enumerable:!0}):e,i));var Da=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var Yn=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)};var $r=(i,t,e)=>(Da(i,t,"access private method"),e);var qn=bt((Xr,Zr)=>{(function(i,t){typeof define=="function"&&define.amd?define([],t):typeof Xr<"u"?t():(t(),i.FileSaver={})})(Xr,function(){"use strict";function i(a,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}f(i,"b");function t(a,l,c){var u=new XMLHttpRequest;u.open("GET",a),u.responseType="blob",u.onload=function(){o(u.response,l,c)},u.onerror=function(){console.error("could not download file")},u.send()}f(t,"c");function e(a){var l=new XMLHttpRequest;l.open("HEAD",a,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}f(e,"d");function r(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(l)}}f(r,"e");var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,s=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(a,l,c){var u=n.URL||n.webkitURL,h=document.createElement("a");l=l||a.name||"download",h.download=l,h.rel="noopener",typeof a=="string"?(h.href=a,h.origin===location.origin?r(h):e(h.href)?t(a,l,c):r(h,h.target="_blank")):(h.href=u.createObjectURL(a),setTimeout(function(){u.revokeObjectURL(h.href)},4e4),setTimeout(function(){r(h)},0))}:"msSaveOrOpenBlob"in navigator?function(a,l,c){if(l=l||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(i(a,c),l);else if(e(a))t(a,l,c);else{var u=document.createElement("a");u.href=a,u.target="_blank",setTimeout(function(){r(u)})}}:function(a,l,c,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof a=="string")return t(a,l,c);var h=a.type==="application/octet-stream",_=/constructor/i.test(n.HTMLElement)||n.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||h&&_||s)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var y=v.result;y=g?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=y:location=y,u=null},v.readAsDataURL(a)}else{var b=n.URL||n.webkitURL,d=b.createObjectURL(a);u?u.location=d:location.href=d,u=null,setTimeout(function(){b.revokeObjectURL(d)},4e4)}});n.saveAs=o.saveAs=o,typeof Zr<"u"&&(Zr.exports=o)})});var es=bt((ts,Jr)=>{(function(i){typeof ts=="object"&&typeof Jr<"u"?Jr.exports=i():typeof define=="function"&&define.amd?define([],i):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=i()})(function(){return f(function i(t,e,r){function n(a,l){if(!e[a]){if(!t[a]){var c=typeof Ae=="function"&&Ae;if(!l&&c)return c(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=e[a]={exports:{}};t[a][0].call(h.exports,function(_){var g=t[a][1][_];return n(g||_)},h,h.exports,i,t,e,r)}return e[a].exports}f(n,"u");for(var s=typeof Ae=="function"&&Ae,o=0;o<r.length;o++)n(r[o]);return n},"s")({1:[function(i,t,e){"use strict";var r=i("./utils"),n=i("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(o){for(var a,l,c,u,h,_,g,v=[],b=0,d=o.length,y=d,w=r.getTypeOf(o)!=="string";b<o.length;)y=d-b,c=w?(a=o[b++],l=b<d?o[b++]:0,b<d?o[b++]:0):(a=o.charCodeAt(b++),l=b<d?o.charCodeAt(b++):0,b<d?o.charCodeAt(b++):0),u=a>>2,h=(3&a)<<4|l>>4,_=1<y?(15&l)<<2|c>>6:64,g=2<y?63&c:64,v.push(s.charAt(u)+s.charAt(h)+s.charAt(_)+s.charAt(g));return v.join("")},e.decode=function(o){var a,l,c,u,h,_,g=0,v=0,b="data:";if(o.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var d,y=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===s.charAt(64)&&y--,o.charAt(o.length-2)===s.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=n.uint8array?new Uint8Array(0|y):new Array(0|y);g<o.length;)a=s.indexOf(o.charAt(g++))<<2|(u=s.indexOf(o.charAt(g++)))>>4,l=(15&u)<<4|(h=s.indexOf(o.charAt(g++)))>>2,c=(3&h)<<6|(_=s.indexOf(o.charAt(g++))),d[v++]=a,h!==64&&(d[v++]=l),_!==64&&(d[v++]=c);return d}},{"./support":30,"./utils":32}],2:[function(i,t,e){"use strict";var r=i("./external"),n=i("./stream/DataWorker"),s=i("./stream/Crc32Probe"),o=i("./stream/DataLengthProbe");function a(l,c,u,h,_){this.compressedSize=l,this.uncompressedSize=c,this.crc32=u,this.compression=h,this.compressedContent=_}f(a,"o"),a.prototype={getContentWorker:function(){var l=new n(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),c=this;return l.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new n(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(l,c,u){return l.pipe(new s).pipe(new o("uncompressedSize")).pipe(c.compressWorker(u)).pipe(new o("compressedSize")).withStreamInfo("compression",c)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,t,e){"use strict";var r=i("./stream/GenericWorker");e.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},e.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,t,e){"use strict";var r=i("./utils"),n=function(){for(var s,o=[],a=0;a<256;a++){s=a;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;o[a]=s}return o}();t.exports=function(s,o){return s!==void 0&&s.length?r.getTypeOf(s)!=="string"?function(a,l,c,u){var h=n,_=u+c;a^=-1;for(var g=u;g<_;g++)a=a>>>8^h[255&(a^l[g])];return-1^a}(0|o,s,s.length,0):function(a,l,c,u){var h=n,_=u+c;a^=-1;for(var g=u;g<_;g++)a=a>>>8^h[255&(a^l.charCodeAt(g))];return-1^a}(0|o,s,s.length,0):0}},{"./utils":32}],5:[function(i,t,e){"use strict";e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null},{}],6:[function(i,t,e){"use strict";var r=null;r=typeof Promise<"u"?Promise:i("lie"),t.exports={Promise:r}},{lie:37}],7:[function(i,t,e){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=i("pako"),s=i("./utils"),o=i("./stream/GenericWorker"),a=r?"uint8array":"array";function l(c,u){o.call(this,"FlateWorker/"+c),this._pako=null,this._pakoAction=c,this._pakoOptions=u,this.meta={}}f(l,"h"),e.magic="\b\0",s.inherits(l,o),l.prototype.processChunk=function(c){this.meta=c.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(a,c.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var c=this;this._pako.onData=function(u){c.push({data:u,meta:c.meta})}},e.compressWorker=function(c){return new l("Deflate",c)},e.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,t,e){"use strict";function r(h,_){var g,v="";for(g=0;g<_;g++)v+=String.fromCharCode(255&h),h>>>=8;return v}f(r,"A");function n(h,_,g,v,b,d){var y,w,C=h.file,P=h.compression,k=d!==a.utf8encode,A=s.transformTo("string",d(C.name)),E=s.transformTo("string",a.utf8encode(C.name)),M=C.comment,F=s.transformTo("string",d(M)),x=s.transformTo("string",a.utf8encode(M)),D=E.length!==C.name.length,m=x.length!==M.length,z="",$="",N="",J=C.dir,W=C.date,it={crc32:0,compressedSize:0,uncompressedSize:0};_&&!g||(it.crc32=h.crc32,it.compressedSize=h.compressedSize,it.uncompressedSize=h.uncompressedSize);var B=0;_&&(B|=8),k||!D&&!m||(B|=2048);var R=0,nt=0;J&&(R|=16),b==="UNIX"?(nt=798,R|=function(Y,At){var Dt=Y;return Y||(Dt=At?16893:33204),(65535&Dt)<<16}(C.unixPermissions,J)):(nt=20,R|=function(Y){return 63&(Y||0)}(C.dosPermissions)),y=W.getUTCHours(),y<<=6,y|=W.getUTCMinutes(),y<<=5,y|=W.getUTCSeconds()/2,w=W.getUTCFullYear()-1980,w<<=4,w|=W.getUTCMonth()+1,w<<=5,w|=W.getUTCDate(),D&&($=r(1,1)+r(l(A),4)+E,z+="up"+r($.length,2)+$),m&&(N=r(1,1)+r(l(F),4)+x,z+="uc"+r(N.length,2)+N);var q="";return q+=`
\0`,q+=r(B,2),q+=P.magic,q+=r(y,2),q+=r(w,2),q+=r(it.crc32,4),q+=r(it.compressedSize,4),q+=r(it.uncompressedSize,4),q+=r(A.length,2),q+=r(z.length,2),{fileRecord:c.LOCAL_FILE_HEADER+q+A+z,dirRecord:c.CENTRAL_FILE_HEADER+r(nt,2)+q+r(F.length,2)+"\0\0\0\0"+r(R,4)+r(v,4)+A+z+F}}f(n,"n");var s=i("../utils"),o=i("../stream/GenericWorker"),a=i("../utf8"),l=i("../crc32"),c=i("../signature");function u(h,_,g,v){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=g,this.encodeFileName=v,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}f(u,"s"),s.inherits(u,o),u.prototype.push=function(h){var _=h.meta.percent||0,g=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,o.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:g?(_+100*(g-v-1))/g:100}}))},u.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var _=this.streamFiles&&!h.file.dir;if(_){var g=n(h,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(h){this.accumulate=!1;var _=this.streamFiles&&!h.file.dir,g=n(h,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),_)this.push({data:function(v){return c.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var h=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var g=this.bytesWritten-h,v=function(b,d,y,w,C){var P=s.transformTo("string",C(w));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(b,2)+r(b,2)+r(d,4)+r(y,4)+r(P.length,2)+P}(this.dirRecords.length,g,h,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(h){this._sources.push(h);var _=this;return h.on("data",function(g){_.processChunk(g)}),h.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),h.on("error",function(g){_.error(g)}),this},u.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(h){var _=this._sources;if(!o.prototype.error.call(this,h))return!1;for(var g=0;g<_.length;g++)try{_[g].error(h)}catch{}return!0},u.prototype.lock=function(){o.prototype.lock.call(this);for(var h=this._sources,_=0;_<h.length;_++)h[_].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,t,e){"use strict";var r=i("../compressions"),n=i("./ZipFileWorker");e.generateWorker=function(s,o,a){var l=new n(o.streamFiles,a,o.platform,o.encodeFileName),c=0;try{s.forEach(function(u,h){c++;var _=function(d,y){var w=d||y,C=r[w];if(!C)throw new Error(w+" is not a valid compression method !");return C}(h.options.compression,o.compression),g=h.options.compressionOptions||o.compressionOptions||{},v=h.dir,b=h.date;h._compressWorker(_,g).withStreamInfo("file",{name:u,dir:v,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(l)}),l.entriesCount=c}catch(u){l.error(u)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,t,e){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new r;for(var s in this)typeof this[s]!="function"&&(n[s]=this[s]);return n}}f(r,"n"),(r.prototype=i("./object")).loadAsync=i("./load"),r.support=i("./support"),r.defaults=i("./defaults"),r.version="3.10.1",r.loadAsync=function(n,s){return new r().loadAsync(n,s)},r.external=i("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,t,e){"use strict";var r=i("./utils"),n=i("./external"),s=i("./utf8"),o=i("./zipEntries"),a=i("./stream/Crc32Probe"),l=i("./nodejsUtils");function c(u){return new n.Promise(function(h,_){var g=u.decompressed.getContentWorker().pipe(new a);g.on("error",function(v){_(v)}).on("end",function(){g.streamInfo.crc32!==u.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}f(c,"f"),t.exports=function(u,h){var _=this;return h=r.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(u)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",u,!0,h.optimizedBinaryString,h.base64).then(function(g){var v=new o(h);return v.load(g),v}).then(function(g){var v=[n.Promise.resolve(g)],b=g.files;if(h.checkCRC32)for(var d=0;d<b.length;d++)v.push(c(b[d]));return n.Promise.all(v)}).then(function(g){for(var v=g.shift(),b=v.files,d=0;d<b.length;d++){var y=b[d],w=y.fileNameStr,C=r.resolve(y.fileNameStr);_.file(C,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:h.createFolders}),y.dir||(_.file(C).unsafeOriginalName=w)}return v.zipComment.length&&(_.comment=v.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,t,e){"use strict";var r=i("../utils"),n=i("../stream/GenericWorker");function s(o,a){n.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(a)}f(s,"s"),r.inherits(s,n),s.prototype._bindStream=function(o){var a=this;(this._stream=o).pause(),o.on("data",function(l){a.push({data:l,meta:{percent:0}})}).on("error",function(l){a.isPaused?this.generatedError=l:a.error(l)}).on("end",function(){a.isPaused?a._upstreamEnded=!0:a.end()})},s.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,t,e){"use strict";var r=i("readable-stream").Readable;function n(s,o,a){r.call(this,o),this._helper=s;var l=this;s.on("data",function(c,u){l.push(c)||l._helper.pause(),a&&a(u)}).on("error",function(c){l.emit("error",c)}).on("end",function(){l.push(null)})}f(n,"n"),i("../utils").inherits(n,r),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(i,t,e){"use strict";t.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,n);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,n)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var n=new Buffer(r);return n.fill(0),n},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(i,t,e){"use strict";function r(C,P,k){var A,E=s.getTypeOf(P),M=s.extend(k||{},l);M.date=M.date||new Date,M.compression!==null&&(M.compression=M.compression.toUpperCase()),typeof M.unixPermissions=="string"&&(M.unixPermissions=parseInt(M.unixPermissions,8)),M.unixPermissions&&16384&M.unixPermissions&&(M.dir=!0),M.dosPermissions&&16&M.dosPermissions&&(M.dir=!0),M.dir&&(C=b(C)),M.createFolders&&(A=v(C))&&d.call(this,A,!0);var F=E==="string"&&M.binary===!1&&M.base64===!1;k&&k.binary!==void 0||(M.binary=!F),(P instanceof c&&P.uncompressedSize===0||M.dir||!P||P.length===0)&&(M.base64=!1,M.binary=!0,P="",M.compression="STORE",E="string");var x=null;x=P instanceof c||P instanceof o?P:_.isNode&&_.isStream(P)?new g(C,P):s.prepareContent(C,P,M.binary,M.optimizedBinaryString,M.base64);var D=new u(C,x,M);this.files[C]=D}f(r,"s");var n=i("./utf8"),s=i("./utils"),o=i("./stream/GenericWorker"),a=i("./stream/StreamHelper"),l=i("./defaults"),c=i("./compressedObject"),u=i("./zipObject"),h=i("./generate"),_=i("./nodejsUtils"),g=i("./nodejs/NodejsStreamInputAdapter"),v=f(function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var P=C.lastIndexOf("/");return 0<P?C.substring(0,P):""},"_"),b=f(function(C){return C.slice(-1)!=="/"&&(C+="/"),C},"g"),d=f(function(C,P){return P=P!==void 0?P:l.createFolders,C=b(C),this.files[C]||r.call(this,C,null,{dir:!0,createFolders:P}),this.files[C]},"b");function y(C){return Object.prototype.toString.call(C)==="[object RegExp]"}f(y,"h");var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var P,k,A;for(P in this.files)A=this.files[P],(k=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&C(k,A)},filter:function(C){var P=[];return this.forEach(function(k,A){C(k,A)&&P.push(A)}),P},file:function(C,P,k){if(arguments.length!==1)return C=this.root+C,r.call(this,C,P,k),this;if(y(C)){var A=C;return this.filter(function(M,F){return!F.dir&&A.test(M)})}var E=this.files[this.root+C];return E&&!E.dir?E:null},folder:function(C){if(!C)return this;if(y(C))return this.filter(function(E,M){return M.dir&&C.test(E)});var P=this.root+C,k=d.call(this,P),A=this.clone();return A.root=k.name,A},remove:function(C){C=this.root+C;var P=this.files[C];if(P||(C.slice(-1)!=="/"&&(C+="/"),P=this.files[C]),P&&!P.dir)delete this.files[C];else for(var k=this.filter(function(E,M){return M.name.slice(0,C.length)===C}),A=0;A<k.length;A++)delete this.files[k[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var P,k={};try{if((k=s.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");s.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var A=k.comment||this.comment||"";P=h.generateWorker(this,k,A)}catch(E){(P=new o("error")).error(E)}return new a(P,k.type||"string",k.mimeType)},generateAsync:function(C,P){return this.generateInternalStream(C).accumulate(P)},generateNodeStream:function(C,P){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(P)}};t.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,t,e){"use strict";t.exports=i("stream")},{stream:void 0}],17:[function(i,t,e){"use strict";var r=i("./DataReader");function n(s){r.call(this,s);for(var o=0;o<this.data.length;o++)s[o]=255&s[o]}f(n,"i"),i("../utils").inherits(n,r),n.prototype.byteAt=function(s){return this.data[this.zero+s]},n.prototype.lastIndexOfSignature=function(s){for(var o=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),c=s.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===o&&this.data[u+1]===a&&this.data[u+2]===l&&this.data[u+3]===c)return u-this.zero;return-1},n.prototype.readAndCheckSignature=function(s){var o=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),c=s.charCodeAt(3),u=this.readData(4);return o===u[0]&&a===u[1]&&l===u[2]&&c===u[3]},n.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(i,t,e){"use strict";var r=i("../utils");function n(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}f(n,"i"),n.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var o,a=0;for(this.checkOffset(s),o=this.index+s-1;o>=this.index;o--)a=(a<<8)+this.byteAt(o);return this.index+=s,a},readString:function(s){return r.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},t.exports=n},{"../utils":32}],19:[function(i,t,e){"use strict";var r=i("./Uint8ArrayReader");function n(s){r.call(this,s)}f(n,"i"),i("../utils").inherits(n,r),n.prototype.readData=function(s){this.checkOffset(s);var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,t,e){"use strict";var r=i("./DataReader");function n(s){r.call(this,s)}f(n,"i"),i("../utils").inherits(n,r),n.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},n.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},n.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},n.prototype.readData=function(s){this.checkOffset(s);var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(i,t,e){"use strict";var r=i("./ArrayReader");function n(s){r.call(this,s)}f(n,"i"),i("../utils").inherits(n,r),n.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(i,t,e){"use strict";var r=i("../utils"),n=i("../support"),s=i("./ArrayReader"),o=i("./StringReader"),a=i("./NodeBufferReader"),l=i("./Uint8ArrayReader");t.exports=function(c){var u=r.getTypeOf(c);return r.checkSupport(u),u!=="string"||n.uint8array?u==="nodebuffer"?new a(c):n.uint8array?new l(r.transformTo("uint8array",c)):new s(r.transformTo("array",c)):new o(c)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,t,e){"use strict";e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,t,e){"use strict";var r=i("./GenericWorker"),n=i("../utils");function s(o){r.call(this,"ConvertWorker to "+o),this.destType=o}f(s,"s"),n.inherits(s,r),s.prototype.processChunk=function(o){this.push({data:n.transformTo(this.destType,o.data),meta:o.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(i,t,e){"use strict";var r=i("./GenericWorker"),n=i("../crc32");function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}f(s,"s"),i("../utils").inherits(s,r),s.prototype.processChunk=function(o){this.streamInfo.crc32=n(o.data,this.streamInfo.crc32||0),this.push(o)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,t,e){"use strict";var r=i("../utils"),n=i("./GenericWorker");function s(o){n.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}f(s,"s"),r.inherits(s,n),s.prototype.processChunk=function(o){if(o){var a=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=a+o.data.length}n.prototype.processChunk.call(this,o)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(i,t,e){"use strict";var r=i("../utils"),n=i("./GenericWorker");function s(o){n.call(this,"DataWorker");var a=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(l){a.dataIsReady=!0,a.data=l,a.max=l&&l.length||0,a.type=r.getTypeOf(l),a.isPaused||a._tickAndRepeat()},function(l){a.error(l)})}f(s,"s"),r.inherits(s,n),s.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,a=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,a);break;case"uint8array":o=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":o=this.data.slice(this.index,a)}return this.index=a,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(i,t,e){"use strict";function r(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}f(r,"n"),r.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,s){return this._listeners[n].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,s){if(this._listeners[n])for(var o=0;o<this._listeners[n].length;o++)this._listeners[n][o].call(this,s)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var s=this;return n.on("data",function(o){s.processChunk(o)}),n.on("end",function(){s.end()}),n.on("error",function(o){s.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,s){return this.extraStreamInfo[n]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},t.exports=r},{}],29:[function(i,t,e){"use strict";var r=i("../utils"),n=i("./ConvertWorker"),s=i("./GenericWorker"),o=i("../base64"),a=i("../support"),l=i("../external"),c=null;if(a.nodestream)try{c=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(_,g){return new l.Promise(function(v,b){var d=[],y=_._internalType,w=_._outputType,C=_._mimeType;_.on("data",function(P,k){d.push(P),g&&g(k)}).on("error",function(P){d=[],b(P)}).on("end",function(){try{var P=function(k,A,E){switch(k){case"blob":return r.newBlob(r.transformTo("arraybuffer",A),E);case"base64":return o.encode(A);default:return r.transformTo(k,A)}}(w,function(k,A){var E,M=0,F=null,x=0;for(E=0;E<A.length;E++)x+=A[E].length;switch(k){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(F=new Uint8Array(x),E=0;E<A.length;E++)F.set(A[E],M),M+=A[E].length;return F;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+k+"'")}}(y,d),C);v(P)}catch(k){b(k)}d=[]}).resume()})}f(u,"l");function h(_,g,v){var b=g;switch(g){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=g,this._mimeType=v,r.checkSupport(b),this._worker=_.pipe(new n(b)),_.lock()}catch(d){this._worker=new s("error"),this._worker.error(d)}}f(h,"f"),h.prototype={accumulate:function(_){return u(this,_)},on:function(_,g){var v=this;return _==="data"?this._worker.on(_,function(b){g.call(v,b.data,b.meta)}):this._worker.on(_,function(){r.delay(g,arguments,v)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:this._outputType!=="nodebuffer"},_)}},t.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,t,e){"use strict";if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",e.nodebuffer=typeof Buffer<"u",e.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")e.blob=!1;else{var r=new ArrayBuffer(0);try{e.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(r),e.blob=n.getBlob("application/zip").size===0}catch{e.blob=!1}}}try{e.nodestream=!!i("readable-stream").Readable}catch{e.nodestream=!1}},{"readable-stream":16}],31:[function(i,t,e){"use strict";for(var r=i("./utils"),n=i("./support"),s=i("./nodejsUtils"),o=i("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;a[254]=a[254]=1;function c(){o.call(this,"utf-8 decode"),this.leftOver=null}f(c,"a");function u(){o.call(this,"utf-8 encode")}f(u,"l"),e.utf8encode=function(h){return n.nodebuffer?s.newBufferFrom(h,"utf-8"):function(_){var g,v,b,d,y,w=_.length,C=0;for(d=0;d<w;d++)(64512&(v=_.charCodeAt(d)))==55296&&d+1<w&&(64512&(b=_.charCodeAt(d+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),d++),C+=v<128?1:v<2048?2:v<65536?3:4;for(g=n.uint8array?new Uint8Array(C):new Array(C),d=y=0;y<C;d++)(64512&(v=_.charCodeAt(d)))==55296&&d+1<w&&(64512&(b=_.charCodeAt(d+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),d++),v<128?g[y++]=v:(v<2048?g[y++]=192|v>>>6:(v<65536?g[y++]=224|v>>>12:(g[y++]=240|v>>>18,g[y++]=128|v>>>12&63),g[y++]=128|v>>>6&63),g[y++]=128|63&v);return g}(h)},e.utf8decode=function(h){return n.nodebuffer?r.transformTo("nodebuffer",h).toString("utf-8"):function(_){var g,v,b,d,y=_.length,w=new Array(2*y);for(g=v=0;g<y;)if((b=_[g++])<128)w[v++]=b;else if(4<(d=a[b]))w[v++]=65533,g+=d-1;else{for(b&=d===2?31:d===3?15:7;1<d&&g<y;)b=b<<6|63&_[g++],d--;1<d?w[v++]=65533:b<65536?w[v++]=b:(b-=65536,w[v++]=55296|b>>10&1023,w[v++]=56320|1023&b)}return w.length!==v&&(w.subarray?w=w.subarray(0,v):w.length=v),r.applyFromCharCode(w)}(h=r.transformTo(n.uint8array?"uint8array":"array",h))},r.inherits(c,o),c.prototype.processChunk=function(h){var _=r.transformTo(n.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var g=_;(_=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),_.set(g,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var v=function(d,y){var w;for((y=y||d.length)>d.length&&(y=d.length),w=y-1;0<=w&&(192&d[w])==128;)w--;return w<0||w===0?y:w+a[d[w]]>y?w:y}(_),b=_;v!==_.length&&(n.uint8array?(b=_.subarray(0,v),this.leftOver=_.subarray(v,_.length)):(b=_.slice(0,v),this.leftOver=_.slice(v,_.length))),this.push({data:e.utf8decode(b),meta:h.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=c,r.inherits(u,o),u.prototype.processChunk=function(h){this.push({data:e.utf8encode(h.data),meta:h.meta})},e.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,t,e){"use strict";var r=i("./support"),n=i("./base64"),s=i("./nodejsUtils"),o=i("./external");function a(g){return g}f(a,"n");function l(g,v){for(var b=0;b<g.length;++b)v[b]=255&g.charCodeAt(b);return v}f(l,"l"),i("setimmediate"),e.newBlob=function(g,v){e.checkSupport("blob");try{return new Blob([g],{type:v})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(g),b.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(g,v,b){var d=[],y=0,w=g.length;if(w<=b)return String.fromCharCode.apply(null,g);for(;y<w;)v==="array"||v==="nodebuffer"?d.push(String.fromCharCode.apply(null,g.slice(y,Math.min(y+b,w)))):d.push(String.fromCharCode.apply(null,g.subarray(y,Math.min(y+b,w)))),y+=b;return d.join("")},stringifyByChar:function(g){for(var v="",b=0;b<g.length;b++)v+=String.fromCharCode(g[b]);return v},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function u(g){var v=65536,b=e.getTypeOf(g),d=!0;if(b==="uint8array"?d=c.applyCanBeUsed.uint8array:b==="nodebuffer"&&(d=c.applyCanBeUsed.nodebuffer),d)for(;1<v;)try{return c.stringifyByChunk(g,b,v)}catch{v=Math.floor(v/2)}return c.stringifyByChar(g)}f(u,"s");function h(g,v){for(var b=0;b<g.length;b++)v[b]=g[b];return v}f(h,"f"),e.applyFromCharCode=u;var _={};_.string={string:a,array:function(g){return l(g,new Array(g.length))},arraybuffer:function(g){return _.string.uint8array(g).buffer},uint8array:function(g){return l(g,new Uint8Array(g.length))},nodebuffer:function(g){return l(g,s.allocBuffer(g.length))}},_.array={string:u,array:a,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return s.newBufferFrom(g)}},_.arraybuffer={string:function(g){return u(new Uint8Array(g))},array:function(g){return h(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:a,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return s.newBufferFrom(new Uint8Array(g))}},_.uint8array={string:u,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:a,nodebuffer:function(g){return s.newBufferFrom(g)}},_.nodebuffer={string:u,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return _.nodebuffer.uint8array(g).buffer},uint8array:function(g){return h(g,new Uint8Array(g.length))},nodebuffer:a},e.transformTo=function(g,v){if(v=v||"",!g)return v;e.checkSupport(g);var b=e.getTypeOf(v);return _[b][g](v)},e.resolve=function(g){for(var v=g.split("/"),b=[],d=0;d<v.length;d++){var y=v[d];y==="."||y===""&&d!==0&&d!==v.length-1||(y===".."?b.pop():b.push(y))}return b.join("/")},e.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":r.nodebuffer&&s.isBuffer(g)?"nodebuffer":r.uint8array&&g instanceof Uint8Array?"uint8array":r.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(g){if(!r[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(g){var v,b,d="";for(b=0;b<(g||"").length;b++)d+="\\x"+((v=g.charCodeAt(b))<16?"0":"")+v.toString(16).toUpperCase();return d},e.delay=function(g,v,b){setImmediate(function(){g.apply(b||null,v||[])})},e.inherits=function(g,v){function b(){}f(b,"r"),b.prototype=v.prototype,g.prototype=new b},e.extend=function(){var g,v,b={};for(g=0;g<arguments.length;g++)for(v in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],v)&&b[v]===void 0&&(b[v]=arguments[g][v]);return b},e.prepareContent=function(g,v,b,d,y){return o.Promise.resolve(v).then(function(w){return r.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new o.Promise(function(C,P){var k=new FileReader;k.onload=function(A){C(A.target.result)},k.onerror=function(A){P(A.target.error)},k.readAsArrayBuffer(w)}):w}).then(function(w){var C=e.getTypeOf(w);return C?(C==="arraybuffer"?w=e.transformTo("uint8array",w):C==="string"&&(y?w=n.decode(w):b&&d!==!0&&(w=function(P){return l(P,r.uint8array?new Uint8Array(P.length):new Array(P.length))}(w))),w):o.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,t,e){"use strict";var r=i("./reader/readerFor"),n=i("./utils"),s=i("./signature"),o=i("./zipEntry"),a=i("./support");function l(c){this.files=[],this.loadOptions=c}f(l,"h"),l.prototype={checkSignature:function(c){if(!this.reader.readAndCheckSignature(c)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(u)+", expected "+n.pretty(c)+")")}},isSignature:function(c,u){var h=this.reader.index;this.reader.setIndex(c);var _=this.reader.readString(4)===u;return this.reader.setIndex(h),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var c=this.reader.readData(this.zipCommentLength),u=a.uint8array?"uint8array":"array",h=n.transformTo(u,c);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var c,u,h,_=this.zip64EndOfCentralSize-44;0<_;)c=this.reader.readInt(2),u=this.reader.readInt(4),h=this.reader.readData(u),this.zip64ExtensibleData[c]={id:c,length:u,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var c,u;for(c=0;c<this.files.length;c++)u=this.files[c],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(c=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(c);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(c<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(c);var u=c;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(c=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(c),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var _=u-h;if(0<_)this.isSignature(u,s.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(c){this.reader=r(c)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,t,e){"use strict";var r=i("./reader/readerFor"),n=i("./utils"),s=i("./compressedObject"),o=i("./crc32"),a=i("./utf8"),l=i("./compressions"),c=i("./support");function u(h,_){this.options=h,this.loadOptions=_}f(u,"l"),u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var _,g;if(h.skip(22),this.fileNameLength=h.readInt(2),g=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=function(v){for(var b in l)if(Object.prototype.hasOwnProperty.call(l,b)&&l[b].magic===v)return l[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,_,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var _=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(_),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=r(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var _,g,v,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)_=h.readInt(2),g=h.readInt(2),v=h.readData(g),this.extraFields[_]={id:_,length:g,value:v};h.setIndex(b)},handleUTF8:function(){var h=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var g=n.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var b=n.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var _=r(h.value);return _.readInt(1)!==1||o(this.fileName)!==_.readInt(4)?null:a.utf8decode(_.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var _=r(h.value);return _.readInt(1)!==1||o(this.fileComment)!==_.readInt(4)?null:a.utf8decode(_.readData(h.length-5))}return null}},t.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,t,e){"use strict";function r(_,g,v){this.name=_,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=g,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}f(r,"n");var n=i("./stream/StreamHelper"),s=i("./stream/DataWorker"),o=i("./utf8"),a=i("./compressedObject"),l=i("./stream/GenericWorker");r.prototype={internalStream:function(_){var g=null,v="string";try{if(!_)throw new Error("No output type specified.");var b=(v=_.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),g=this._decompressWorker();var d=!this._dataBinary;d&&!b&&(g=g.pipe(new o.Utf8EncodeWorker)),!d&&b&&(g=g.pipe(new o.Utf8DecodeWorker))}catch(y){(g=new l("error")).error(y)}return new n(g,v,"")},async:function(_,g){return this.internalStream(_).accumulate(g)},nodeStream:function(_,g){return this.internalStream(_||"nodebuffer").toNodejsStream(g)},_compressWorker:function(_,g){if(this._data instanceof a&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(v,_,g)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)r.prototype[c[h]]=u;t.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,t,e){(function(r){"use strict";var n,s,o=r.MutationObserver||r.WebKitMutationObserver;if(o){var a=0,l=new o(_),c=r.document.createTextNode("");l.observe(c,{characterData:!0}),n=f(function(){c.data=a=++a%2},"r")}else if(r.setImmediate||r.MessageChannel===void 0)n="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var g=r.document.createElement("script");g.onreadystatechange=function(){_(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},r.document.documentElement.appendChild(g)}:function(){setTimeout(_,0)};else{var u=new r.MessageChannel;u.port1.onmessage=_,n=f(function(){u.port2.postMessage(0)},"r")}var h=[];function _(){var g,v;s=!0;for(var b=h.length;b;){for(v=h,h=[],g=-1;++g<b;)v[g]();b=h.length}s=!1}f(_,"u"),t.exports=function(g){h.push(g)!==1||s||n()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,t,e){"use strict";var r=i("immediate");function n(){}f(n,"u");var s={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,b!==n&&g(this,b)}f(c,"o");function u(b,d,y){this.promise=b,typeof d=="function"&&(this.onFulfilled=d,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}f(u,"h");function h(b,d,y){r(function(){var w;try{w=d(y)}catch(C){return s.reject(b,C)}w===b?s.reject(b,new TypeError("Cannot resolve promise with itself")):s.resolve(b,w)})}f(h,"f");function _(b){var d=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof d=="function")return function(){d.apply(b,arguments)}}f(_,"c");function g(b,d){var y=!1;function w(k){y||(y=!0,s.reject(b,k))}f(w,"n");function C(k){y||(y=!0,s.resolve(b,k))}f(C,"i");var P=v(function(){d(C,w)});P.status==="error"&&w(P.value)}f(g,"d");function v(b,d){var y={};try{y.value=b(d),y.status="success"}catch(w){y.status="error",y.value=w}return y}f(v,"p"),(t.exports=c).prototype.finally=function(b){if(typeof b!="function")return this;var d=this.constructor;return this.then(function(y){return d.resolve(b()).then(function(){return y})},function(y){return d.resolve(b()).then(function(){throw y})})},c.prototype.catch=function(b){return this.then(null,b)},c.prototype.then=function(b,d){if(typeof b!="function"&&this.state===a||typeof d!="function"&&this.state===o)return this;var y=new this.constructor(n);return this.state!==l?h(y,this.state===a?b:d,this.outcome):this.queue.push(new u(y,b,d)),y},u.prototype.callFulfilled=function(b){s.resolve(this.promise,b)},u.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},u.prototype.callRejected=function(b){s.reject(this.promise,b)},u.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},s.resolve=function(b,d){var y=v(_,d);if(y.status==="error")return s.reject(b,y.value);var w=y.value;if(w)g(b,w);else{b.state=a,b.outcome=d;for(var C=-1,P=b.queue.length;++C<P;)b.queue[C].callFulfilled(d)}return b},s.reject=function(b,d){b.state=o,b.outcome=d;for(var y=-1,w=b.queue.length;++y<w;)b.queue[y].callRejected(d);return b},c.resolve=function(b){return b instanceof this?b:s.resolve(new this(n),b)},c.reject=function(b){var d=new this(n);return s.reject(d,b)},c.all=function(b){var d=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=b.length,w=!1;if(!y)return this.resolve([]);for(var C=new Array(y),P=0,k=-1,A=new this(n);++k<y;)E(b[k],k);return A;function E(M,F){d.resolve(M).then(function(x){C[F]=x,++P!==y||w||(w=!0,s.resolve(A,C))},function(x){w||(w=!0,s.reject(A,x))})}},c.race=function(b){var d=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=b.length,w=!1;if(!y)return this.resolve([]);for(var C=-1,P=new this(n);++C<y;)k=b[C],d.resolve(k).then(function(A){w||(w=!0,s.resolve(P,A))},function(A){w||(w=!0,s.reject(P,A))});var k;return P}},{immediate:36}],38:[function(i,t,e){"use strict";var r={};(0,i("./lib/utils/common").assign)(r,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,t,e){"use strict";var r=i("./zlib/deflate"),n=i("./utils/common"),s=i("./utils/strings"),o=i("./zlib/messages"),a=i("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,h=0,_=8;function g(b){if(!(this instanceof g))return new g(b);this.options=n.assign({level:u,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var d=this.options;d.raw&&0<d.windowBits?d.windowBits=-d.windowBits:d.gzip&&0<d.windowBits&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var y=r.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(y!==c)throw new Error(o[y]);if(d.header&&r.deflateSetHeader(this.strm,d.header),d.dictionary){var w;if(w=typeof d.dictionary=="string"?s.string2buf(d.dictionary):l.call(d.dictionary)==="[object ArrayBuffer]"?new Uint8Array(d.dictionary):d.dictionary,(y=r.deflateSetDictionary(this.strm,w))!==c)throw new Error(o[y]);this._dict_set=!0}}f(g,"p");function v(b,d){var y=new g(d);if(y.push(b,!0),y.err)throw y.msg||o[y.err];return y.result}f(v,"n"),g.prototype.push=function(b,d){var y,w,C=this.strm,P=this.options.chunkSize;if(this.ended)return!1;w=d===~~d?d:d===!0?4:0,typeof b=="string"?C.input=s.string2buf(b):l.call(b)==="[object ArrayBuffer]"?C.input=new Uint8Array(b):C.input=b,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new n.Buf8(P),C.next_out=0,C.avail_out=P),(y=r.deflate(C,w))!==1&&y!==c)return this.onEnd(y),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(n.shrinkBuf(C.output,C.next_out))):this.onData(n.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&y!==1);return w===4?(y=r.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c):w!==2||(this.onEnd(c),!(C.avail_out=0))},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},e.Deflate=g,e.deflate=v,e.deflateRaw=function(b,d){return(d=d||{}).raw=!0,v(b,d)},e.gzip=function(b,d){return(d=d||{}).gzip=!0,v(b,d)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,t,e){"use strict";var r=i("./zlib/inflate"),n=i("./utils/common"),s=i("./utils/strings"),o=i("./zlib/constants"),a=i("./zlib/messages"),l=i("./zlib/zstream"),c=i("./zlib/gzheader"),u=Object.prototype.toString;function h(g){if(!(this instanceof h))return new h(g);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},g||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||g&&g.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var b=r.inflateInit2(this.strm,v.windowBits);if(b!==o.Z_OK)throw new Error(a[b]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}f(h,"a");function _(g,v){var b=new h(v);if(b.push(g,!0),b.err)throw b.msg||a[b.err];return b.result}f(_,"o"),h.prototype.push=function(g,v){var b,d,y,w,C,P,k=this.strm,A=this.options.chunkSize,E=this.options.dictionary,M=!1;if(this.ended)return!1;d=v===~~v?v:v===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof g=="string"?k.input=s.binstring2buf(g):u.call(g)==="[object ArrayBuffer]"?k.input=new Uint8Array(g):k.input=g,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new n.Buf8(A),k.next_out=0,k.avail_out=A),(b=r.inflate(k,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&E&&(P=typeof E=="string"?s.string2buf(E):u.call(E)==="[object ArrayBuffer]"?new Uint8Array(E):E,b=r.inflateSetDictionary(this.strm,P)),b===o.Z_BUF_ERROR&&M===!0&&(b=o.Z_OK,M=!1),b!==o.Z_STREAM_END&&b!==o.Z_OK)return this.onEnd(b),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&b!==o.Z_STREAM_END&&(k.avail_in!==0||d!==o.Z_FINISH&&d!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=s.utf8border(k.output,k.next_out),w=k.next_out-y,C=s.buf2string(k.output,y),k.next_out=w,k.avail_out=A-w,w&&n.arraySet(k.output,k.output,y,w,0),this.onData(C)):this.onData(n.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(M=!0)}while((0<k.avail_in||k.avail_out===0)&&b!==o.Z_STREAM_END);return b===o.Z_STREAM_END&&(d=o.Z_FINISH),d===o.Z_FINISH?(b=r.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===o.Z_OK):d!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(k.avail_out=0))},h.prototype.onData=function(g){this.chunks.push(g)},h.prototype.onEnd=function(g){g===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},e.Inflate=h,e.inflate=_,e.inflateRaw=function(g,v){return(v=v||{}).raw=!0,_(g,v)},e.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,t,e){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";e.assign=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)l.hasOwnProperty(c)&&(o[c]=l[c])}}return o},e.shrinkBuf=function(o,a){return o.length===a?o:o.subarray?o.subarray(0,a):(o.length=a,o)};var n={arraySet:function(o,a,l,c,u){if(a.subarray&&o.subarray)o.set(a.subarray(l,l+c),u);else for(var h=0;h<c;h++)o[u+h]=a[l+h]},flattenChunks:function(o){var a,l,c,u,h,_;for(a=c=0,l=o.length;a<l;a++)c+=o[a].length;for(_=new Uint8Array(c),a=u=0,l=o.length;a<l;a++)h=o[a],_.set(h,u),u+=h.length;return _}},s={arraySet:function(o,a,l,c,u){for(var h=0;h<c;h++)o[u+h]=a[l+h]},flattenChunks:function(o){return[].concat.apply([],o)}};e.setTyped=function(o){o?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(r)},{}],42:[function(i,t,e){"use strict";var r=i("./common"),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var o=new r.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(c,u){if(u<65537&&(c.subarray&&s||!c.subarray&&n))return String.fromCharCode.apply(null,r.shrinkBuf(c,u));for(var h="",_=0;_<u;_++)h+=String.fromCharCode(c[_]);return h}f(l,"l"),o[254]=o[254]=1,e.string2buf=function(c){var u,h,_,g,v,b=c.length,d=0;for(g=0;g<b;g++)(64512&(h=c.charCodeAt(g)))==55296&&g+1<b&&(64512&(_=c.charCodeAt(g+1)))==56320&&(h=65536+(h-55296<<10)+(_-56320),g++),d+=h<128?1:h<2048?2:h<65536?3:4;for(u=new r.Buf8(d),g=v=0;v<d;g++)(64512&(h=c.charCodeAt(g)))==55296&&g+1<b&&(64512&(_=c.charCodeAt(g+1)))==56320&&(h=65536+(h-55296<<10)+(_-56320),g++),h<128?u[v++]=h:(h<2048?u[v++]=192|h>>>6:(h<65536?u[v++]=224|h>>>12:(u[v++]=240|h>>>18,u[v++]=128|h>>>12&63),u[v++]=128|h>>>6&63),u[v++]=128|63&h);return u},e.buf2binstring=function(c){return l(c,c.length)},e.binstring2buf=function(c){for(var u=new r.Buf8(c.length),h=0,_=u.length;h<_;h++)u[h]=c.charCodeAt(h);return u},e.buf2string=function(c,u){var h,_,g,v,b=u||c.length,d=new Array(2*b);for(h=_=0;h<b;)if((g=c[h++])<128)d[_++]=g;else if(4<(v=o[g]))d[_++]=65533,h+=v-1;else{for(g&=v===2?31:v===3?15:7;1<v&&h<b;)g=g<<6|63&c[h++],v--;1<v?d[_++]=65533:g<65536?d[_++]=g:(g-=65536,d[_++]=55296|g>>10&1023,d[_++]=56320|1023&g)}return l(d,_)},e.utf8border=function(c,u){var h;for((u=u||c.length)>c.length&&(u=c.length),h=u-1;0<=h&&(192&c[h])==128;)h--;return h<0||h===0?u:h+o[c[h]]>u?h:u}},{"./common":41}],43:[function(i,t,e){"use strict";t.exports=function(r,n,s,o){for(var a=65535&r|0,l=r>>>16&65535|0,c=0;s!==0;){for(s-=c=2e3<s?2e3:s;l=l+(a=a+n[o++]|0)|0,--c;);a%=65521,l%=65521}return a|l<<16|0}},{}],44:[function(i,t,e){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,t,e){"use strict";var r=function(){for(var n,s=[],o=0;o<256;o++){n=o;for(var a=0;a<8;a++)n=1&n?3988292384^n>>>1:n>>>1;s[o]=n}return s}();t.exports=function(n,s,o,a){var l=r,c=a+o;n^=-1;for(var u=a;u<c;u++)n=n>>>8^l[255&(n^s[u])];return-1^n}},{}],46:[function(i,t,e){"use strict";var r,n=i("../utils/common"),s=i("./trees"),o=i("./adler32"),a=i("./crc32"),l=i("./messages"),c=0,u=4,h=0,_=-2,g=-1,v=4,b=2,d=8,y=9,w=286,C=30,P=19,k=2*w+1,A=15,E=3,M=258,F=M+E+1,x=42,D=113,m=1,z=2,$=3,N=4;function J(p,U){return p.msg=l[U],U}f(J,"R");function W(p){return(p<<1)-(4<p?9:0)}f(W,"T");function it(p){for(var U=p.length;0<=--U;)p[U]=0}f(it,"D");function B(p){var U=p.state,j=U.pending;j>p.avail_out&&(j=p.avail_out),j!==0&&(n.arraySet(p.output,U.pending_buf,U.pending_out,j,p.next_out),p.next_out+=j,U.pending_out+=j,p.total_out+=j,p.avail_out-=j,U.pending-=j,U.pending===0&&(U.pending_out=0))}f(B,"F");function R(p,U){s._tr_flush_block(p,0<=p.block_start?p.block_start:-1,p.strstart-p.block_start,U),p.block_start=p.strstart,B(p.strm)}f(R,"N");function nt(p,U){p.pending_buf[p.pending++]=U}f(nt,"U");function q(p,U){p.pending_buf[p.pending++]=U>>>8&255,p.pending_buf[p.pending++]=255&U}f(q,"P");function Y(p,U){var j,O,S=p.max_chain_length,T=p.strstart,H=p.prev_length,V=p.nice_match,L=p.strstart>p.w_size-F?p.strstart-(p.w_size-F):0,X=p.window,tt=p.w_mask,Z=p.prev,st=p.strstart+M,Ct=X[T+H-1],pt=X[T+H];p.prev_length>=p.good_match&&(S>>=2),V>p.lookahead&&(V=p.lookahead);do if(X[(j=U)+H]===pt&&X[j+H-1]===Ct&&X[j]===X[T]&&X[++j]===X[T+1]){T+=2,j++;do;while(X[++T]===X[++j]&&X[++T]===X[++j]&&X[++T]===X[++j]&&X[++T]===X[++j]&&X[++T]===X[++j]&&X[++T]===X[++j]&&X[++T]===X[++j]&&X[++T]===X[++j]&&T<st);if(O=M-(st-T),T=st-M,H<O){if(p.match_start=U,V<=(H=O))break;Ct=X[T+H-1],pt=X[T+H]}}while((U=Z[U&tt])>L&&--S!=0);return H<=p.lookahead?H:p.lookahead}f(Y,"L");function At(p){var U,j,O,S,T,H,V,L,X,tt,Z=p.w_size;do{if(S=p.window_size-p.lookahead-p.strstart,p.strstart>=Z+(Z-F)){for(n.arraySet(p.window,p.window,Z,Z,0),p.match_start-=Z,p.strstart-=Z,p.block_start-=Z,U=j=p.hash_size;O=p.head[--U],p.head[U]=Z<=O?O-Z:0,--j;);for(U=j=Z;O=p.prev[--U],p.prev[U]=Z<=O?O-Z:0,--j;);S+=Z}if(p.strm.avail_in===0)break;if(H=p.strm,V=p.window,L=p.strstart+p.lookahead,X=S,tt=void 0,tt=H.avail_in,X<tt&&(tt=X),j=tt===0?0:(H.avail_in-=tt,n.arraySet(V,H.input,H.next_in,tt,L),H.state.wrap===1?H.adler=o(H.adler,V,tt,L):H.state.wrap===2&&(H.adler=a(H.adler,V,tt,L)),H.next_in+=tt,H.total_in+=tt,tt),p.lookahead+=j,p.lookahead+p.insert>=E)for(T=p.strstart-p.insert,p.ins_h=p.window[T],p.ins_h=(p.ins_h<<p.hash_shift^p.window[T+1])&p.hash_mask;p.insert&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[T+E-1])&p.hash_mask,p.prev[T&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=T,T++,p.insert--,!(p.lookahead+p.insert<E)););}while(p.lookahead<F&&p.strm.avail_in!==0)}f(At,"j");function Dt(p,U){for(var j,O;;){if(p.lookahead<F){if(At(p),p.lookahead<F&&U===c)return m;if(p.lookahead===0)break}if(j=0,p.lookahead>=E&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+E-1])&p.hash_mask,j=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),j!==0&&p.strstart-j<=p.w_size-F&&(p.match_length=Y(p,j)),p.match_length>=E)if(O=s._tr_tally(p,p.strstart-p.match_start,p.match_length-E),p.lookahead-=p.match_length,p.match_length<=p.max_lazy_match&&p.lookahead>=E){for(p.match_length--;p.strstart++,p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+E-1])&p.hash_mask,j=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart,--p.match_length!=0;);p.strstart++}else p.strstart+=p.match_length,p.match_length=0,p.ins_h=p.window[p.strstart],p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+1])&p.hash_mask;else O=s._tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++;if(O&&(R(p,!1),p.strm.avail_out===0))return m}return p.insert=p.strstart<E-1?p.strstart:E-1,U===u?(R(p,!0),p.strm.avail_out===0?$:N):p.last_lit&&(R(p,!1),p.strm.avail_out===0)?m:z}f(Dt,"Z");function ct(p,U){for(var j,O,S;;){if(p.lookahead<F){if(At(p),p.lookahead<F&&U===c)return m;if(p.lookahead===0)break}if(j=0,p.lookahead>=E&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+E-1])&p.hash_mask,j=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),p.prev_length=p.match_length,p.prev_match=p.match_start,p.match_length=E-1,j!==0&&p.prev_length<p.max_lazy_match&&p.strstart-j<=p.w_size-F&&(p.match_length=Y(p,j),p.match_length<=5&&(p.strategy===1||p.match_length===E&&4096<p.strstart-p.match_start)&&(p.match_length=E-1)),p.prev_length>=E&&p.match_length<=p.prev_length){for(S=p.strstart+p.lookahead-E,O=s._tr_tally(p,p.strstart-1-p.prev_match,p.prev_length-E),p.lookahead-=p.prev_length-1,p.prev_length-=2;++p.strstart<=S&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+E-1])&p.hash_mask,j=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),--p.prev_length!=0;);if(p.match_available=0,p.match_length=E-1,p.strstart++,O&&(R(p,!1),p.strm.avail_out===0))return m}else if(p.match_available){if((O=s._tr_tally(p,0,p.window[p.strstart-1]))&&R(p,!1),p.strstart++,p.lookahead--,p.strm.avail_out===0)return m}else p.match_available=1,p.strstart++,p.lookahead--}return p.match_available&&(O=s._tr_tally(p,0,p.window[p.strstart-1]),p.match_available=0),p.insert=p.strstart<E-1?p.strstart:E-1,U===u?(R(p,!0),p.strm.avail_out===0?$:N):p.last_lit&&(R(p,!1),p.strm.avail_out===0)?m:z}f(ct,"W");function yt(p,U,j,O,S){this.good_length=p,this.max_lazy=U,this.nice_length=j,this.max_chain=O,this.func=S}f(yt,"M");function Bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*k),this.dyn_dtree=new n.Buf16(2*(2*C+1)),this.bl_tree=new n.Buf16(2*(2*P+1)),it(this.dyn_ltree),it(this.dyn_dtree),it(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(A+1),this.heap=new n.Buf16(2*w+1),it(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*w+1),it(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}f(Bt,"H");function Et(p){var U;return p&&p.state?(p.total_in=p.total_out=0,p.data_type=b,(U=p.state).pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?x:D,p.adler=U.wrap===2?0:1,U.last_flush=c,s._tr_init(U),h):J(p,_)}f(Et,"G");function oe(p){var U=Et(p);return U===h&&function(j){j.window_size=2*j.w_size,it(j.head),j.max_lazy_match=r[j.level].max_lazy,j.good_match=r[j.level].good_length,j.nice_match=r[j.level].nice_length,j.max_chain_length=r[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=E-1,j.match_available=0,j.ins_h=0}(p.state),U}f(oe,"K");function se(p,U,j,O,S,T){if(!p)return _;var H=1;if(U===g&&(U=6),O<0?(H=0,O=-O):15<O&&(H=2,O-=16),S<1||y<S||j!==d||O<8||15<O||U<0||9<U||T<0||v<T)return J(p,_);O===8&&(O=9);var V=new Bt;return(p.state=V).strm=p,V.wrap=H,V.gzhead=null,V.w_bits=O,V.w_size=1<<V.w_bits,V.w_mask=V.w_size-1,V.hash_bits=S+7,V.hash_size=1<<V.hash_bits,V.hash_mask=V.hash_size-1,V.hash_shift=~~((V.hash_bits+E-1)/E),V.window=new n.Buf8(2*V.w_size),V.head=new n.Buf16(V.hash_size),V.prev=new n.Buf16(V.w_size),V.lit_bufsize=1<<S+6,V.pending_buf_size=4*V.lit_bufsize,V.pending_buf=new n.Buf8(V.pending_buf_size),V.d_buf=1*V.lit_bufsize,V.l_buf=3*V.lit_bufsize,V.level=U,V.strategy=T,V.method=j,oe(p)}f(se,"Y"),r=[new yt(0,0,0,0,function(p,U){var j=65535;for(j>p.pending_buf_size-5&&(j=p.pending_buf_size-5);;){if(p.lookahead<=1){if(At(p),p.lookahead===0&&U===c)return m;if(p.lookahead===0)break}p.strstart+=p.lookahead,p.lookahead=0;var O=p.block_start+j;if((p.strstart===0||p.strstart>=O)&&(p.lookahead=p.strstart-O,p.strstart=O,R(p,!1),p.strm.avail_out===0)||p.strstart-p.block_start>=p.w_size-F&&(R(p,!1),p.strm.avail_out===0))return m}return p.insert=0,U===u?(R(p,!0),p.strm.avail_out===0?$:N):(p.strstart>p.block_start&&(R(p,!1),p.strm.avail_out),m)}),new yt(4,4,8,4,Dt),new yt(4,5,16,8,Dt),new yt(4,6,32,32,Dt),new yt(4,4,16,16,ct),new yt(8,16,32,32,ct),new yt(8,16,128,128,ct),new yt(8,32,128,256,ct),new yt(32,128,258,1024,ct),new yt(32,258,258,4096,ct)],e.deflateInit=function(p,U){return se(p,U,d,15,8,0)},e.deflateInit2=se,e.deflateReset=oe,e.deflateResetKeep=Et,e.deflateSetHeader=function(p,U){return p&&p.state?p.state.wrap!==2?_:(p.state.gzhead=U,h):_},e.deflate=function(p,U){var j,O,S,T;if(!p||!p.state||5<U||U<0)return p?J(p,_):_;if(O=p.state,!p.output||!p.input&&p.avail_in!==0||O.status===666&&U!==u)return J(p,p.avail_out===0?-5:_);if(O.strm=p,j=O.last_flush,O.last_flush=U,O.status===x)if(O.wrap===2)p.adler=0,nt(O,31),nt(O,139),nt(O,8),O.gzhead?(nt(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),nt(O,255&O.gzhead.time),nt(O,O.gzhead.time>>8&255),nt(O,O.gzhead.time>>16&255),nt(O,O.gzhead.time>>24&255),nt(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),nt(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(nt(O,255&O.gzhead.extra.length),nt(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(p.adler=a(p.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(nt(O,0),nt(O,0),nt(O,0),nt(O,0),nt(O,0),nt(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),nt(O,3),O.status=D);else{var H=d+(O.w_bits-8<<4)<<8;H|=(2<=O.strategy||O.level<2?0:O.level<6?1:O.level===6?2:3)<<6,O.strstart!==0&&(H|=32),H+=31-H%31,O.status=D,q(O,H),O.strstart!==0&&(q(O,p.adler>>>16),q(O,65535&p.adler)),p.adler=1}if(O.status===69)if(O.gzhead.extra){for(S=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>S&&(p.adler=a(p.adler,O.pending_buf,O.pending-S,S)),B(p),S=O.pending,O.pending!==O.pending_buf_size));)nt(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>S&&(p.adler=a(p.adler,O.pending_buf,O.pending-S,S)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(O.status===73)if(O.gzhead.name){S=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>S&&(p.adler=a(p.adler,O.pending_buf,O.pending-S,S)),B(p),S=O.pending,O.pending===O.pending_buf_size)){T=1;break}T=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,nt(O,T)}while(T!==0);O.gzhead.hcrc&&O.pending>S&&(p.adler=a(p.adler,O.pending_buf,O.pending-S,S)),T===0&&(O.gzindex=0,O.status=91)}else O.status=91;if(O.status===91)if(O.gzhead.comment){S=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>S&&(p.adler=a(p.adler,O.pending_buf,O.pending-S,S)),B(p),S=O.pending,O.pending===O.pending_buf_size)){T=1;break}T=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,nt(O,T)}while(T!==0);O.gzhead.hcrc&&O.pending>S&&(p.adler=a(p.adler,O.pending_buf,O.pending-S,S)),T===0&&(O.status=103)}else O.status=103;if(O.status===103&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&B(p),O.pending+2<=O.pending_buf_size&&(nt(O,255&p.adler),nt(O,p.adler>>8&255),p.adler=0,O.status=D)):O.status=D),O.pending!==0){if(B(p),p.avail_out===0)return O.last_flush=-1,h}else if(p.avail_in===0&&W(U)<=W(j)&&U!==u)return J(p,-5);if(O.status===666&&p.avail_in!==0)return J(p,-5);if(p.avail_in!==0||O.lookahead!==0||U!==c&&O.status!==666){var V=O.strategy===2?function(L,X){for(var tt;;){if(L.lookahead===0&&(At(L),L.lookahead===0)){if(X===c)return m;break}if(L.match_length=0,tt=s._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,tt&&(R(L,!1),L.strm.avail_out===0))return m}return L.insert=0,X===u?(R(L,!0),L.strm.avail_out===0?$:N):L.last_lit&&(R(L,!1),L.strm.avail_out===0)?m:z}(O,U):O.strategy===3?function(L,X){for(var tt,Z,st,Ct,pt=L.window;;){if(L.lookahead<=M){if(At(L),L.lookahead<=M&&X===c)return m;if(L.lookahead===0)break}if(L.match_length=0,L.lookahead>=E&&0<L.strstart&&(Z=pt[st=L.strstart-1])===pt[++st]&&Z===pt[++st]&&Z===pt[++st]){Ct=L.strstart+M;do;while(Z===pt[++st]&&Z===pt[++st]&&Z===pt[++st]&&Z===pt[++st]&&Z===pt[++st]&&Z===pt[++st]&&Z===pt[++st]&&Z===pt[++st]&&st<Ct);L.match_length=M-(Ct-st),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=E?(tt=s._tr_tally(L,1,L.match_length-E),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(tt=s._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),tt&&(R(L,!1),L.strm.avail_out===0))return m}return L.insert=0,X===u?(R(L,!0),L.strm.avail_out===0?$:N):L.last_lit&&(R(L,!1),L.strm.avail_out===0)?m:z}(O,U):r[O.level].func(O,U);if(V!==$&&V!==N||(O.status=666),V===m||V===$)return p.avail_out===0&&(O.last_flush=-1),h;if(V===z&&(U===1?s._tr_align(O):U!==5&&(s._tr_stored_block(O,0,0,!1),U===3&&(it(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),B(p),p.avail_out===0))return O.last_flush=-1,h}return U!==u?h:O.wrap<=0?1:(O.wrap===2?(nt(O,255&p.adler),nt(O,p.adler>>8&255),nt(O,p.adler>>16&255),nt(O,p.adler>>24&255),nt(O,255&p.total_in),nt(O,p.total_in>>8&255),nt(O,p.total_in>>16&255),nt(O,p.total_in>>24&255)):(q(O,p.adler>>>16),q(O,65535&p.adler)),B(p),0<O.wrap&&(O.wrap=-O.wrap),O.pending!==0?h:1)},e.deflateEnd=function(p){var U;return p&&p.state?(U=p.state.status)!==x&&U!==69&&U!==73&&U!==91&&U!==103&&U!==D&&U!==666?J(p,_):(p.state=null,U===D?J(p,-3):h):_},e.deflateSetDictionary=function(p,U){var j,O,S,T,H,V,L,X,tt=U.length;if(!p||!p.state||(T=(j=p.state).wrap)===2||T===1&&j.status!==x||j.lookahead)return _;for(T===1&&(p.adler=o(p.adler,U,tt,0)),j.wrap=0,tt>=j.w_size&&(T===0&&(it(j.head),j.strstart=0,j.block_start=0,j.insert=0),X=new n.Buf8(j.w_size),n.arraySet(X,U,tt-j.w_size,j.w_size,0),U=X,tt=j.w_size),H=p.avail_in,V=p.next_in,L=p.input,p.avail_in=tt,p.next_in=0,p.input=U,At(j);j.lookahead>=E;){for(O=j.strstart,S=j.lookahead-(E-1);j.ins_h=(j.ins_h<<j.hash_shift^j.window[O+E-1])&j.hash_mask,j.prev[O&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=O,O++,--S;);j.strstart=O,j.lookahead=E-1,At(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=E-1,j.match_available=0,p.next_in=V,p.input=L,p.avail_in=H,j.wrap=T,h},e.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,t,e){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,t,e){"use strict";t.exports=function(r,n){var s,o,a,l,c,u,h,_,g,v,b,d,y,w,C,P,k,A,E,M,F,x,D,m,z;s=r.state,o=r.next_in,m=r.input,a=o+(r.avail_in-5),l=r.next_out,z=r.output,c=l-(n-r.avail_out),u=l+(r.avail_out-257),h=s.dmax,_=s.wsize,g=s.whave,v=s.wnext,b=s.window,d=s.hold,y=s.bits,w=s.lencode,C=s.distcode,P=(1<<s.lenbits)-1,k=(1<<s.distbits)-1;t:do{y<15&&(d+=m[o++]<<y,y+=8,d+=m[o++]<<y,y+=8),A=w[d&P];e:for(;;){if(d>>>=E=A>>>24,y-=E,(E=A>>>16&255)===0)z[l++]=65535&A;else{if(!(16&E)){if(!(64&E)){A=w[(65535&A)+(d&(1<<E)-1)];continue e}if(32&E){s.mode=12;break t}r.msg="invalid literal/length code",s.mode=30;break t}M=65535&A,(E&=15)&&(y<E&&(d+=m[o++]<<y,y+=8),M+=d&(1<<E)-1,d>>>=E,y-=E),y<15&&(d+=m[o++]<<y,y+=8,d+=m[o++]<<y,y+=8),A=C[d&k];i:for(;;){if(d>>>=E=A>>>24,y-=E,!(16&(E=A>>>16&255))){if(!(64&E)){A=C[(65535&A)+(d&(1<<E)-1)];continue i}r.msg="invalid distance code",s.mode=30;break t}if(F=65535&A,y<(E&=15)&&(d+=m[o++]<<y,(y+=8)<E&&(d+=m[o++]<<y,y+=8)),h<(F+=d&(1<<E)-1)){r.msg="invalid distance too far back",s.mode=30;break t}if(d>>>=E,y-=E,(E=l-c)<F){if(g<(E=F-E)&&s.sane){r.msg="invalid distance too far back",s.mode=30;break t}if(D=b,(x=0)===v){if(x+=_-E,E<M){for(M-=E;z[l++]=b[x++],--E;);x=l-F,D=z}}else if(v<E){if(x+=_+v-E,(E-=v)<M){for(M-=E;z[l++]=b[x++],--E;);if(x=0,v<M){for(M-=E=v;z[l++]=b[x++],--E;);x=l-F,D=z}}}else if(x+=v-E,E<M){for(M-=E;z[l++]=b[x++],--E;);x=l-F,D=z}for(;2<M;)z[l++]=D[x++],z[l++]=D[x++],z[l++]=D[x++],M-=3;M&&(z[l++]=D[x++],1<M&&(z[l++]=D[x++]))}else{for(x=l-F;z[l++]=z[x++],z[l++]=z[x++],z[l++]=z[x++],2<(M-=3););M&&(z[l++]=z[x++],1<M&&(z[l++]=z[x++]))}break}}break}}while(o<a&&l<u);o-=M=y>>3,d&=(1<<(y-=M<<3))-1,r.next_in=o,r.next_out=l,r.avail_in=o<a?a-o+5:5-(o-a),r.avail_out=l<u?u-l+257:257-(l-u),s.hold=d,s.bits=y}},{}],49:[function(i,t,e){"use strict";var r=i("../utils/common"),n=i("./adler32"),s=i("./crc32"),o=i("./inffast"),a=i("./inftrees"),l=1,c=2,u=0,h=-2,_=1,g=852,v=592;function b(x){return(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24)}f(b,"L");function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}f(d,"s");function y(x){var D;return x&&x.state?(D=x.state,x.total_in=x.total_out=D.total=0,x.msg="",D.wrap&&(x.adler=1&D.wrap),D.mode=_,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new r.Buf32(g),D.distcode=D.distdyn=new r.Buf32(v),D.sane=1,D.back=-1,u):h}f(y,"a");function w(x){var D;return x&&x.state?((D=x.state).wsize=0,D.whave=0,D.wnext=0,y(x)):h}f(w,"o");function C(x,D){var m,z;return x&&x.state?(z=x.state,D<0?(m=0,D=-D):(m=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?h:(z.window!==null&&z.wbits!==D&&(z.window=null),z.wrap=m,z.wbits=D,w(x))):h}f(C,"h");function P(x,D){var m,z;return x?(z=new d,(x.state=z).window=null,(m=C(x,D))!==u&&(x.state=null),m):h}f(P,"u");var k,A,E=!0;function M(x){if(E){var D;for(k=new r.Buf32(512),A=new r.Buf32(32),D=0;D<144;)x.lens[D++]=8;for(;D<256;)x.lens[D++]=9;for(;D<280;)x.lens[D++]=7;for(;D<288;)x.lens[D++]=8;for(a(l,x.lens,0,288,k,0,x.work,{bits:9}),D=0;D<32;)x.lens[D++]=5;a(c,x.lens,0,32,A,0,x.work,{bits:5}),E=!1}x.lencode=k,x.lenbits=9,x.distcode=A,x.distbits=5}f(M,"j");function F(x,D,m,z){var $,N=x.state;return N.window===null&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new r.Buf8(N.wsize)),z>=N.wsize?(r.arraySet(N.window,D,m-N.wsize,N.wsize,0),N.wnext=0,N.whave=N.wsize):(z<($=N.wsize-N.wnext)&&($=z),r.arraySet(N.window,D,m-z,$,N.wnext),(z-=$)?(r.arraySet(N.window,D,m-z,z,0),N.wnext=z,N.whave=N.wsize):(N.wnext+=$,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=$))),0}f(F,"Z"),e.inflateReset=w,e.inflateReset2=C,e.inflateResetKeep=y,e.inflateInit=function(x){return P(x,15)},e.inflateInit2=P,e.inflate=function(x,D){var m,z,$,N,J,W,it,B,R,nt,q,Y,At,Dt,ct,yt,Bt,Et,oe,se,p,U,j,O,S=0,T=new r.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!x||!x.state||!x.output||!x.input&&x.avail_in!==0)return h;(m=x.state).mode===12&&(m.mode=13),J=x.next_out,$=x.output,it=x.avail_out,N=x.next_in,z=x.input,W=x.avail_in,B=m.hold,R=m.bits,nt=W,q=it,U=u;t:for(;;)switch(m.mode){case _:if(m.wrap===0){m.mode=13;break}for(;R<16;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(2&m.wrap&&B===35615){T[m.check=0]=255&B,T[1]=B>>>8&255,m.check=s(m.check,T,2,0),R=B=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&B)<<8)+(B>>8))%31){x.msg="incorrect header check",m.mode=30;break}if((15&B)!=8){x.msg="unknown compression method",m.mode=30;break}if(R-=4,p=8+(15&(B>>>=4)),m.wbits===0)m.wbits=p;else if(p>m.wbits){x.msg="invalid window size",m.mode=30;break}m.dmax=1<<p,x.adler=m.check=1,m.mode=512&B?10:12,R=B=0;break;case 2:for(;R<16;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(m.flags=B,(255&m.flags)!=8){x.msg="unknown compression method",m.mode=30;break}if(57344&m.flags){x.msg="unknown header flags set",m.mode=30;break}m.head&&(m.head.text=B>>8&1),512&m.flags&&(T[0]=255&B,T[1]=B>>>8&255,m.check=s(m.check,T,2,0)),R=B=0,m.mode=3;case 3:for(;R<32;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}m.head&&(m.head.time=B),512&m.flags&&(T[0]=255&B,T[1]=B>>>8&255,T[2]=B>>>16&255,T[3]=B>>>24&255,m.check=s(m.check,T,4,0)),R=B=0,m.mode=4;case 4:for(;R<16;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}m.head&&(m.head.xflags=255&B,m.head.os=B>>8),512&m.flags&&(T[0]=255&B,T[1]=B>>>8&255,m.check=s(m.check,T,2,0)),R=B=0,m.mode=5;case 5:if(1024&m.flags){for(;R<16;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}m.length=B,m.head&&(m.head.extra_len=B),512&m.flags&&(T[0]=255&B,T[1]=B>>>8&255,m.check=s(m.check,T,2,0)),R=B=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&(W<(Y=m.length)&&(Y=W),Y&&(m.head&&(p=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Array(m.head.extra_len)),r.arraySet(m.head.extra,z,N,Y,p)),512&m.flags&&(m.check=s(m.check,z,Y,N)),W-=Y,N+=Y,m.length-=Y),m.length))break t;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(W===0)break t;for(Y=0;p=z[N+Y++],m.head&&p&&m.length<65536&&(m.head.name+=String.fromCharCode(p)),p&&Y<W;);if(512&m.flags&&(m.check=s(m.check,z,Y,N)),W-=Y,N+=Y,p)break t}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(W===0)break t;for(Y=0;p=z[N+Y++],m.head&&p&&m.length<65536&&(m.head.comment+=String.fromCharCode(p)),p&&Y<W;);if(512&m.flags&&(m.check=s(m.check,z,Y,N)),W-=Y,N+=Y,p)break t}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;R<16;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(B!==(65535&m.check)){x.msg="header crc mismatch",m.mode=30;break}R=B=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),x.adler=m.check=0,m.mode=12;break;case 10:for(;R<32;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}x.adler=m.check=b(B),R=B=0,m.mode=11;case 11:if(m.havedict===0)return x.next_out=J,x.avail_out=it,x.next_in=N,x.avail_in=W,m.hold=B,m.bits=R,2;x.adler=m.check=1,m.mode=12;case 12:if(D===5||D===6)break t;case 13:if(m.last){B>>>=7&R,R-=7&R,m.mode=27;break}for(;R<3;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}switch(m.last=1&B,R-=1,3&(B>>>=1)){case 0:m.mode=14;break;case 1:if(M(m),m.mode=20,D!==6)break;B>>>=2,R-=2;break t;case 2:m.mode=17;break;case 3:x.msg="invalid block type",m.mode=30}B>>>=2,R-=2;break;case 14:for(B>>>=7&R,R-=7&R;R<32;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if((65535&B)!=(B>>>16^65535)){x.msg="invalid stored block lengths",m.mode=30;break}if(m.length=65535&B,R=B=0,m.mode=15,D===6)break t;case 15:m.mode=16;case 16:if(Y=m.length){if(W<Y&&(Y=W),it<Y&&(Y=it),Y===0)break t;r.arraySet($,z,N,Y,J),W-=Y,N+=Y,it-=Y,J+=Y,m.length-=Y;break}m.mode=12;break;case 17:for(;R<14;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(m.nlen=257+(31&B),B>>>=5,R-=5,m.ndist=1+(31&B),B>>>=5,R-=5,m.ncode=4+(15&B),B>>>=4,R-=4,286<m.nlen||30<m.ndist){x.msg="too many length or distance symbols",m.mode=30;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;R<3;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}m.lens[H[m.have++]]=7&B,B>>>=3,R-=3}for(;m.have<19;)m.lens[H[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,j={bits:m.lenbits},U=a(0,m.lens,0,19,m.lencode,0,m.work,j),m.lenbits=j.bits,U){x.msg="invalid code lengths set",m.mode=30;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;yt=(S=m.lencode[B&(1<<m.lenbits)-1])>>>16&255,Bt=65535&S,!((ct=S>>>24)<=R);){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(Bt<16)B>>>=ct,R-=ct,m.lens[m.have++]=Bt;else{if(Bt===16){for(O=ct+2;R<O;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(B>>>=ct,R-=ct,m.have===0){x.msg="invalid bit length repeat",m.mode=30;break}p=m.lens[m.have-1],Y=3+(3&B),B>>>=2,R-=2}else if(Bt===17){for(O=ct+3;R<O;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}R-=ct,p=0,Y=3+(7&(B>>>=ct)),B>>>=3,R-=3}else{for(O=ct+7;R<O;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}R-=ct,p=0,Y=11+(127&(B>>>=ct)),B>>>=7,R-=7}if(m.have+Y>m.nlen+m.ndist){x.msg="invalid bit length repeat",m.mode=30;break}for(;Y--;)m.lens[m.have++]=p}}if(m.mode===30)break;if(m.lens[256]===0){x.msg="invalid code -- missing end-of-block",m.mode=30;break}if(m.lenbits=9,j={bits:m.lenbits},U=a(l,m.lens,0,m.nlen,m.lencode,0,m.work,j),m.lenbits=j.bits,U){x.msg="invalid literal/lengths set",m.mode=30;break}if(m.distbits=6,m.distcode=m.distdyn,j={bits:m.distbits},U=a(c,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,j),m.distbits=j.bits,U){x.msg="invalid distances set",m.mode=30;break}if(m.mode=20,D===6)break t;case 20:m.mode=21;case 21:if(6<=W&&258<=it){x.next_out=J,x.avail_out=it,x.next_in=N,x.avail_in=W,m.hold=B,m.bits=R,o(x,q),J=x.next_out,$=x.output,it=x.avail_out,N=x.next_in,z=x.input,W=x.avail_in,B=m.hold,R=m.bits,m.mode===12&&(m.back=-1);break}for(m.back=0;yt=(S=m.lencode[B&(1<<m.lenbits)-1])>>>16&255,Bt=65535&S,!((ct=S>>>24)<=R);){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(yt&&!(240&yt)){for(Et=ct,oe=yt,se=Bt;yt=(S=m.lencode[se+((B&(1<<Et+oe)-1)>>Et)])>>>16&255,Bt=65535&S,!(Et+(ct=S>>>24)<=R);){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}B>>>=Et,R-=Et,m.back+=Et}if(B>>>=ct,R-=ct,m.back+=ct,m.length=Bt,yt===0){m.mode=26;break}if(32&yt){m.back=-1,m.mode=12;break}if(64&yt){x.msg="invalid literal/length code",m.mode=30;break}m.extra=15&yt,m.mode=22;case 22:if(m.extra){for(O=m.extra;R<O;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}m.length+=B&(1<<m.extra)-1,B>>>=m.extra,R-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;yt=(S=m.distcode[B&(1<<m.distbits)-1])>>>16&255,Bt=65535&S,!((ct=S>>>24)<=R);){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(!(240&yt)){for(Et=ct,oe=yt,se=Bt;yt=(S=m.distcode[se+((B&(1<<Et+oe)-1)>>Et)])>>>16&255,Bt=65535&S,!(Et+(ct=S>>>24)<=R);){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}B>>>=Et,R-=Et,m.back+=Et}if(B>>>=ct,R-=ct,m.back+=ct,64&yt){x.msg="invalid distance code",m.mode=30;break}m.offset=Bt,m.extra=15&yt,m.mode=24;case 24:if(m.extra){for(O=m.extra;R<O;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}m.offset+=B&(1<<m.extra)-1,B>>>=m.extra,R-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){x.msg="invalid distance too far back",m.mode=30;break}m.mode=25;case 25:if(it===0)break t;if(Y=q-it,m.offset>Y){if((Y=m.offset-Y)>m.whave&&m.sane){x.msg="invalid distance too far back",m.mode=30;break}At=Y>m.wnext?(Y-=m.wnext,m.wsize-Y):m.wnext-Y,Y>m.length&&(Y=m.length),Dt=m.window}else Dt=$,At=J-m.offset,Y=m.length;for(it<Y&&(Y=it),it-=Y,m.length-=Y;$[J++]=Dt[At++],--Y;);m.length===0&&(m.mode=21);break;case 26:if(it===0)break t;$[J++]=m.length,it--,m.mode=21;break;case 27:if(m.wrap){for(;R<32;){if(W===0)break t;W--,B|=z[N++]<<R,R+=8}if(q-=it,x.total_out+=q,m.total+=q,q&&(x.adler=m.check=m.flags?s(m.check,$,q,J-q):n(m.check,$,q,J-q)),q=it,(m.flags?B:b(B))!==m.check){x.msg="incorrect data check",m.mode=30;break}R=B=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;R<32;){if(W===0)break t;W--,B+=z[N++]<<R,R+=8}if(B!==(4294967295&m.total)){x.msg="incorrect length check",m.mode=30;break}R=B=0}m.mode=29;case 29:U=1;break t;case 30:U=-3;break t;case 31:return-4;case 32:default:return h}return x.next_out=J,x.avail_out=it,x.next_in=N,x.avail_in=W,m.hold=B,m.bits=R,(m.wsize||q!==x.avail_out&&m.mode<30&&(m.mode<27||D!==4))&&F(x,x.output,x.next_out,q-x.avail_out)?(m.mode=31,-4):(nt-=x.avail_in,q-=x.avail_out,x.total_in+=nt,x.total_out+=q,m.total+=q,m.wrap&&q&&(x.adler=m.check=m.flags?s(m.check,$,q,x.next_out-q):n(m.check,$,q,x.next_out-q)),x.data_type=m.bits+(m.last?64:0)+(m.mode===12?128:0)+(m.mode===20||m.mode===15?256:0),(nt==0&&q===0||D===4)&&U===u&&(U=-5),U)},e.inflateEnd=function(x){if(!x||!x.state)return h;var D=x.state;return D.window&&(D.window=null),x.state=null,u},e.inflateGetHeader=function(x,D){var m;return x&&x.state&&2&(m=x.state).wrap?((m.head=D).done=!1,u):h},e.inflateSetDictionary=function(x,D){var m,z=D.length;return x&&x.state?(m=x.state).wrap!==0&&m.mode!==11?h:m.mode===11&&n(1,D,z,0)!==m.check?-3:F(x,D,z,z)?(m.mode=31,-4):(m.havedict=1,u):h},e.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,t,e){"use strict";var r=i("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(l,c,u,h,_,g,v,b){var d,y,w,C,P,k,A,E,M,F=b.bits,x=0,D=0,m=0,z=0,$=0,N=0,J=0,W=0,it=0,B=0,R=null,nt=0,q=new r.Buf16(16),Y=new r.Buf16(16),At=null,Dt=0;for(x=0;x<=15;x++)q[x]=0;for(D=0;D<h;D++)q[c[u+D]]++;for($=F,z=15;1<=z&&q[z]===0;z--);if(z<$&&($=z),z===0)return _[g++]=20971520,_[g++]=20971520,b.bits=1,0;for(m=1;m<z&&q[m]===0;m++);for($<m&&($=m),x=W=1;x<=15;x++)if(W<<=1,(W-=q[x])<0)return-1;if(0<W&&(l===0||z!==1))return-1;for(Y[1]=0,x=1;x<15;x++)Y[x+1]=Y[x]+q[x];for(D=0;D<h;D++)c[u+D]!==0&&(v[Y[c[u+D]]++]=D);if(k=l===0?(R=At=v,19):l===1?(R=n,nt-=257,At=s,Dt-=257,256):(R=o,At=a,-1),x=m,P=g,J=D=B=0,w=-1,C=(it=1<<(N=$))-1,l===1&&852<it||l===2&&592<it)return 1;for(;;){for(A=x-J,M=v[D]<k?(E=0,v[D]):v[D]>k?(E=At[Dt+v[D]],R[nt+v[D]]):(E=96,0),d=1<<x-J,m=y=1<<N;_[P+(B>>J)+(y-=d)]=A<<24|E<<16|M|0,y!==0;);for(d=1<<x-1;B&d;)d>>=1;if(d!==0?(B&=d-1,B+=d):B=0,D++,--q[x]==0){if(x===z)break;x=c[u+v[D]]}if($<x&&(B&C)!==w){for(J===0&&(J=$),P+=m,W=1<<(N=x-J);N+J<z&&!((W-=q[N+J])<=0);)N++,W<<=1;if(it+=1<<N,l===1&&852<it||l===2&&592<it)return 1;_[w=B&C]=$<<24|N<<16|P-g|0}}return B!==0&&(_[P+B]=x-J<<24|64<<16|0),b.bits=$,0}},{"../utils/common":41}],51:[function(i,t,e){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,t,e){"use strict";var r=i("../utils/common"),n=0,s=1;function o(S){for(var T=S.length;0<=--T;)S[T]=0}f(o,"n");var a=0,l=29,c=256,u=c+1+l,h=30,_=19,g=2*u+1,v=15,b=16,d=7,y=256,w=16,C=17,P=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=new Array(2*(u+2));o(F);var x=new Array(2*h);o(x);var D=new Array(512);o(D);var m=new Array(256);o(m);var z=new Array(l);o(z);var $,N,J,W=new Array(h);function it(S,T,H,V,L){this.static_tree=S,this.extra_bits=T,this.extra_base=H,this.elems=V,this.max_length=L,this.has_stree=S&&S.length}f(it,"D");function B(S,T){this.dyn_tree=S,this.max_code=0,this.stat_desc=T}f(B,"F");function R(S){return S<256?D[S]:D[256+(S>>>7)]}f(R,"N");function nt(S,T){S.pending_buf[S.pending++]=255&T,S.pending_buf[S.pending++]=T>>>8&255}f(nt,"U");function q(S,T,H){S.bi_valid>b-H?(S.bi_buf|=T<<S.bi_valid&65535,nt(S,S.bi_buf),S.bi_buf=T>>b-S.bi_valid,S.bi_valid+=H-b):(S.bi_buf|=T<<S.bi_valid&65535,S.bi_valid+=H)}f(q,"P");function Y(S,T,H){q(S,H[2*T],H[2*T+1])}f(Y,"L");function At(S,T){for(var H=0;H|=1&S,S>>>=1,H<<=1,0<--T;);return H>>>1}f(At,"j");function Dt(S,T,H){var V,L,X=new Array(v+1),tt=0;for(V=1;V<=v;V++)X[V]=tt=tt+H[V-1]<<1;for(L=0;L<=T;L++){var Z=S[2*L+1];Z!==0&&(S[2*L]=At(X[Z]++,Z))}}f(Dt,"Z");function ct(S){var T;for(T=0;T<u;T++)S.dyn_ltree[2*T]=0;for(T=0;T<h;T++)S.dyn_dtree[2*T]=0;for(T=0;T<_;T++)S.bl_tree[2*T]=0;S.dyn_ltree[2*y]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}f(ct,"W");function yt(S){8<S.bi_valid?nt(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}f(yt,"M");function Bt(S,T,H,V){var L=2*T,X=2*H;return S[L]<S[X]||S[L]===S[X]&&V[T]<=V[H]}f(Bt,"H");function Et(S,T,H){for(var V=S.heap[H],L=H<<1;L<=S.heap_len&&(L<S.heap_len&&Bt(T,S.heap[L+1],S.heap[L],S.depth)&&L++,!Bt(T,V,S.heap[L],S.depth));)S.heap[H]=S.heap[L],H=L,L<<=1;S.heap[H]=V}f(Et,"G");function oe(S,T,H){var V,L,X,tt,Z=0;if(S.last_lit!==0)for(;V=S.pending_buf[S.d_buf+2*Z]<<8|S.pending_buf[S.d_buf+2*Z+1],L=S.pending_buf[S.l_buf+Z],Z++,V===0?Y(S,L,T):(Y(S,(X=m[L])+c+1,T),(tt=k[X])!==0&&q(S,L-=z[X],tt),Y(S,X=R(--V),H),(tt=A[X])!==0&&q(S,V-=W[X],tt)),Z<S.last_lit;);Y(S,y,T)}f(oe,"K");function se(S,T){var H,V,L,X=T.dyn_tree,tt=T.stat_desc.static_tree,Z=T.stat_desc.has_stree,st=T.stat_desc.elems,Ct=-1;for(S.heap_len=0,S.heap_max=g,H=0;H<st;H++)X[2*H]!==0?(S.heap[++S.heap_len]=Ct=H,S.depth[H]=0):X[2*H+1]=0;for(;S.heap_len<2;)X[2*(L=S.heap[++S.heap_len]=Ct<2?++Ct:0)]=1,S.depth[L]=0,S.opt_len--,Z&&(S.static_len-=tt[2*L+1]);for(T.max_code=Ct,H=S.heap_len>>1;1<=H;H--)Et(S,X,H);for(L=st;H=S.heap[1],S.heap[1]=S.heap[S.heap_len--],Et(S,X,1),V=S.heap[1],S.heap[--S.heap_max]=H,S.heap[--S.heap_max]=V,X[2*L]=X[2*H]+X[2*V],S.depth[L]=(S.depth[H]>=S.depth[V]?S.depth[H]:S.depth[V])+1,X[2*H+1]=X[2*V+1]=L,S.heap[1]=L++,Et(S,X,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(pt,Jt){var ei,Q,K,G,rt,ft,lt=Jt.dyn_tree,_t=Jt.max_code,le=Jt.stat_desc.static_tree,Qi=Jt.stat_desc.has_stree,Oa=Jt.stat_desc.extra_bits,Zn=Jt.stat_desc.extra_base,vi=Jt.stat_desc.max_length,tr=0;for(G=0;G<=v;G++)pt.bl_count[G]=0;for(lt[2*pt.heap[pt.heap_max]+1]=0,ei=pt.heap_max+1;ei<g;ei++)vi<(G=lt[2*lt[2*(Q=pt.heap[ei])+1]+1]+1)&&(G=vi,tr++),lt[2*Q+1]=G,_t<Q||(pt.bl_count[G]++,rt=0,Zn<=Q&&(rt=Oa[Q-Zn]),ft=lt[2*Q],pt.opt_len+=ft*(G+rt),Qi&&(pt.static_len+=ft*(le[2*Q+1]+rt)));if(tr!==0){do{for(G=vi-1;pt.bl_count[G]===0;)G--;pt.bl_count[G]--,pt.bl_count[G+1]+=2,pt.bl_count[vi]--,tr-=2}while(0<tr);for(G=vi;G!==0;G--)for(Q=pt.bl_count[G];Q!==0;)_t<(K=pt.heap[--ei])||(lt[2*K+1]!==G&&(pt.opt_len+=(G-lt[2*K+1])*lt[2*K],lt[2*K+1]=G),Q--)}}(S,T),Dt(X,Ct,S.bl_count)}f(se,"Y");function p(S,T,H){var V,L,X=-1,tt=T[1],Z=0,st=7,Ct=4;for(tt===0&&(st=138,Ct=3),T[2*(H+1)+1]=65535,V=0;V<=H;V++)L=tt,tt=T[2*(V+1)+1],++Z<st&&L===tt||(Z<Ct?S.bl_tree[2*L]+=Z:L!==0?(L!==X&&S.bl_tree[2*L]++,S.bl_tree[2*w]++):Z<=10?S.bl_tree[2*C]++:S.bl_tree[2*P]++,X=L,Ct=(Z=0)===tt?(st=138,3):L===tt?(st=6,3):(st=7,4))}f(p,"X");function U(S,T,H){var V,L,X=-1,tt=T[1],Z=0,st=7,Ct=4;for(tt===0&&(st=138,Ct=3),V=0;V<=H;V++)if(L=tt,tt=T[2*(V+1)+1],!(++Z<st&&L===tt)){if(Z<Ct)for(;Y(S,L,S.bl_tree),--Z!=0;);else L!==0?(L!==X&&(Y(S,L,S.bl_tree),Z--),Y(S,w,S.bl_tree),q(S,Z-3,2)):Z<=10?(Y(S,C,S.bl_tree),q(S,Z-3,3)):(Y(S,P,S.bl_tree),q(S,Z-11,7));X=L,Ct=(Z=0)===tt?(st=138,3):L===tt?(st=6,3):(st=7,4)}}f(U,"V"),o(W);var j=!1;function O(S,T,H,V){q(S,(a<<1)+(V?1:0),3),function(L,X,tt,Z){yt(L),Z&&(nt(L,tt),nt(L,~tt)),r.arraySet(L.pending_buf,L.window,X,tt,L.pending),L.pending+=tt}(S,T,H,!0)}f(O,"J"),e._tr_init=function(S){j||(function(){var T,H,V,L,X,tt=new Array(v+1);for(L=V=0;L<l-1;L++)for(z[L]=V,T=0;T<1<<k[L];T++)m[V++]=L;for(m[V-1]=L,L=X=0;L<16;L++)for(W[L]=X,T=0;T<1<<A[L];T++)D[X++]=L;for(X>>=7;L<h;L++)for(W[L]=X<<7,T=0;T<1<<A[L]-7;T++)D[256+X++]=L;for(H=0;H<=v;H++)tt[H]=0;for(T=0;T<=143;)F[2*T+1]=8,T++,tt[8]++;for(;T<=255;)F[2*T+1]=9,T++,tt[9]++;for(;T<=279;)F[2*T+1]=7,T++,tt[7]++;for(;T<=287;)F[2*T+1]=8,T++,tt[8]++;for(Dt(F,u+1,tt),T=0;T<h;T++)x[2*T+1]=5,x[2*T]=At(T,5);$=new it(F,k,c+1,u,v),N=new it(x,A,0,h,v),J=new it(new Array(0),E,0,_,d)}(),j=!0),S.l_desc=new B(S.dyn_ltree,$),S.d_desc=new B(S.dyn_dtree,N),S.bl_desc=new B(S.bl_tree,J),S.bi_buf=0,S.bi_valid=0,ct(S)},e._tr_stored_block=O,e._tr_flush_block=function(S,T,H,V){var L,X,tt=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(Z){var st,Ct=4093624447;for(st=0;st<=31;st++,Ct>>>=1)if(1&Ct&&Z.dyn_ltree[2*st]!==0)return n;if(Z.dyn_ltree[18]!==0||Z.dyn_ltree[20]!==0||Z.dyn_ltree[26]!==0)return s;for(st=32;st<c;st++)if(Z.dyn_ltree[2*st]!==0)return s;return n}(S)),se(S,S.l_desc),se(S,S.d_desc),tt=function(Z){var st;for(p(Z,Z.dyn_ltree,Z.l_desc.max_code),p(Z,Z.dyn_dtree,Z.d_desc.max_code),se(Z,Z.bl_desc),st=_-1;3<=st&&Z.bl_tree[2*M[st]+1]===0;st--);return Z.opt_len+=3*(st+1)+5+5+4,st}(S),L=S.opt_len+3+7>>>3,(X=S.static_len+3+7>>>3)<=L&&(L=X)):L=X=H+5,H+4<=L&&T!==-1?O(S,T,H,V):S.strategy===4||X===L?(q(S,2+(V?1:0),3),oe(S,F,x)):(q(S,4+(V?1:0),3),function(Z,st,Ct,pt){var Jt;for(q(Z,st-257,5),q(Z,Ct-1,5),q(Z,pt-4,4),Jt=0;Jt<pt;Jt++)q(Z,Z.bl_tree[2*M[Jt]+1],3);U(Z,Z.dyn_ltree,st-1),U(Z,Z.dyn_dtree,Ct-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,tt+1),oe(S,S.dyn_ltree,S.dyn_dtree)),ct(S),V&&yt(S)},e._tr_tally=function(S,T,H){return S.pending_buf[S.d_buf+2*S.last_lit]=T>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&T,S.pending_buf[S.l_buf+S.last_lit]=255&H,S.last_lit++,T===0?S.dyn_ltree[2*H]++:(S.matches++,T--,S.dyn_ltree[2*(m[H]+c+1)]++,S.dyn_dtree[2*R(T)]++),S.last_lit===S.lit_bufsize-1},e._tr_align=function(S){q(S,2,3),Y(S,y,F),function(T){T.bi_valid===16?(nt(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(i,t,e){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,t,e){(function(r){(function(n,s){"use strict";if(!n.setImmediate){var o,a,l,c,u=1,h={},_=!1,g=n.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(n);v=v&&v.setTimeout?v:n,o={}.toString.call(n.process)==="[object process]"?function(w){process.nextTick(function(){d(w)})}:function(){if(n.postMessage&&!n.importScripts){var w=!0,C=n.onmessage;return n.onmessage=function(){w=!1},n.postMessage("","*"),n.onmessage=C,w}}()?(c="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",y,!1):n.attachEvent("onmessage",y),function(w){n.postMessage(c+w,"*")}):n.MessageChannel?((l=new MessageChannel).port1.onmessage=function(w){d(w.data)},function(w){l.port2.postMessage(w)}):g&&"onreadystatechange"in g.createElement("script")?(a=g.documentElement,function(w){var C=g.createElement("script");C.onreadystatechange=function(){d(w),C.onreadystatechange=null,a.removeChild(C),C=null},a.appendChild(C)}):function(w){setTimeout(d,0,w)},v.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var C=new Array(arguments.length-1),P=0;P<C.length;P++)C[P]=arguments[P+1];var k={callback:w,args:C};return h[u]=k,o(u),u++},v.clearImmediate=b}function b(w){delete h[w]}f(b,"f");function d(w){if(_)setTimeout(d,0,w);else{var C=h[w];if(C){_=!0;try{(function(P){var k=P.callback,A=P.args;switch(A.length){case 0:k();break;case 1:k(A[0]);break;case 2:k(A[0],A[1]);break;case 3:k(A[0],A[1],A[2]);break;default:k.apply(s,A)}})(C)}finally{b(w),_=!1}}}}f(d,"c");function y(w){w.source===n&&typeof w.data=="string"&&w.data.indexOf(c)===0&&d(+w.data.slice(c.length))}f(y,"d")})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var os=bt((Oc,ss)=>{var en={};for(Ci=32;Ci<127;Ci++)en[Ci]=String.fromCharCode(Ci);var Ci;function ja(i){var t=0,e=0;return Ua(i,function(r,n,s){var o=Math.round(n*1e5),a=Math.round(s*1e5);return r+=ns(rs(o-t))+ns(rs(a-e)),t=o,e=a,r})}f(ja,"encode");function Ua(i,t){for(var e=null,r=0,n=0,s="",o=0;o<i.length;o++)e=i[o],r=e.lat||e.x||e[0],n=e.lng||e.y||e[1],s=t(s,r,n);return s}f(Ua,"reduce");function rs(i){return i<0?~(i<<1):i<<1}f(rs,"sign");function Ga(i){return(i&31|32)+63}f(Ga,"charCode");function ns(i){for(var t="";i>=32;)t+=en[Ga(i)],i=i>>5;return t+=en[i+63],t}f(ns,"chars");ss.exports=ja});var hs=bt((Ec,ls)=>{var as=1e5;function ni(i){var t=[],e=0,r=0,n=ni.integers(i,function(s,o){e+=s,r+=o,t.push([e/as,r/as])});return t}f(ni,"decode");ni.sign=function(i){return i&1?~(i>>>1):i>>>1};ni.integers=function(i,t){for(var e=0,r=0,n=0,s=0,o=0,a=0,l=0;l<i.length;l++)s=i.charCodeAt(l)-63,o=o|(s&31)<<a,a=a+5,s<32&&(++e&1?r=ni.sign(o):(n=ni.sign(o),t(r,n)),o=0,a=0);return e};ls.exports=ni});var us=bt((Pc,cs)=>{cs.exports={encode:os(),decode:hs()}});var ar=bt((Lc,fs)=>{fs.exports=Function;Function.noop=function(){};Function.identity=function(i){return i};Function.by=function(i,t){t=t||Object.compare,i=i||Function.identity;var e=f(function(r,n){return t(i(r),i(n))},"compareBy");return e.compare=t,e.by=i,e};Function.get=function(i){return function(t){return Object.get(t,i)}}});var ve=bt((Bc,ds)=>{"use strict";ds.exports=vt;function vt(){throw new Error("Can't construct. GenericCollection is a mixin.")}f(vt,"GenericCollection");var Ha=global.DOMTokenList||function(){};vt.EmptyArray=Object.freeze([]);vt.prototype.addEach=function(i,t,e){if(i&&(i instanceof Array||i instanceof Ha||i instanceof String))if(t)for(var r=0;r<i.length;r++)this.add(t.call(e,i[r]),r);else for(var r=0;r<i.length;r++)this.add(i[r],r);else if(i&&Object(i)===i)if(typeof i.forEach=="function")t?i.map(t,e).forEach(this.add,this):i.forEach(this.add,this);else if(typeof i.next=="function"){var n,r=0;if(t)for(;n=i.next().value;)this.add(t.call(e,n),r++);else for(;n=i.next().value;)this.add(n,r++)}else if(typeof i.length=="number")if(t)for(var r=0;r<i.length;r++)this.add(t.call(e,i[r]),r);else for(var r=0;r<i.length;r++)this.add(i[r],r);else t?Object.keys(i).forEach(function(s){this.add(t.call(e,i[s]),s)},this):Object.keys(i).forEach(function(s){this.add(i[s],s)},this);return this};vt.prototype.deleteEach=function(i,t){return i.forEach(function(e){this.delete(e,t)},this),this};vt.prototype.forEach=function(i){var t=arguments[1];return this.reduce(function(e,r,n,s,o){i.call(t,r,n,s,o)},void 0)};vt.prototype.map=function(i){var t=arguments[1],e=[];return this.reduce(function(r,n,s,o,a){e.push(i.call(t,n,s,o,a))},void 0),e};vt.prototype.enumerate=function(i){i==null&&(i=0);var t=[];return this.reduce(function(e,r){t.push([i++,r])},void 0),t};vt.prototype.group=function(i,t,e){e=e||Object.equals;var r=[],n=[];return this.forEach(function(s,l,a){var l=i.call(t,s,l,a),c=n.indexOf(l,e),u;c===-1?(u=[],r.push([l,u]),n.push(l)):u=r[c][1],u.push(s)}),r};vt.prototype.toArray=function(){return this.map(Function.identity)};vt.prototype.toObject=function(){var i={};return this.reduce(function(t,e,r){i[r]=e},void 0),i};vt.from=function(){return this.apply(this,arguments)};vt.prototype.filter=function(i){var t=arguments[1],e=this.constructClone();return this.reduce(function(r,n,s,o,a){i.call(t,n,s,o,a)&&e.add(n,s)},void 0),e};vt.prototype.every=function(i){var t=arguments[1];return this.reduce(function(e,r,n,s,o){return e&&i.call(t,r,n,s,o)},!0)};vt.prototype.some=function(i){var t=arguments[1];return this.reduce(function(e,r,n,s,o){return e||i.call(t,r,n,s,o)},!1)};vt.prototype.all=function(){return this.every(Boolean)};vt.prototype.any=function(){return this.some(Boolean)};vt.prototype.min=function(i){i=i||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(e,r){return t?(t=!1,r):i(r,e)<0?r:e},void 0)};vt.prototype.max=function(i){i=i||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(e,r){return t?(t=!1,r):i(r,e)>0?r:e},void 0)};vt.prototype.sum=function(i){return i=i===void 0?0:i,this.reduce(function(t,e){return t+e},i)};vt.prototype.average=function(i){var t=i===void 0?0:i,e=i===void 0?0:i;return this.reduce(function(r,n){t+=n,e+=1},void 0),t/e};vt.prototype.concat=function(){for(var i=this.constructClone(this),t=0;t<arguments.length;t++)i.addEach(arguments[t]);return i};vt.prototype.flatten=function(){var i=this;return this.reduce(function(t,e){return e.forEach(function(r){this.push(r)},t,i),t},[])};vt.prototype.zip=function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),Array.unzip(i)};vt.prototype.join=function(i){return this.reduce(function(t,e){return t===void 0?e:t+i+e},void 0)};vt.prototype.sorted=function(i,t,e){return i=i||this.contentCompare||Object.compare,i.by?(t=i.by,i=i.compare||this.contentCompare||Object.compare):t=t||Function.identity,e===void 0&&(e=1),this.map(function(r){return{by:t(r),value:r}}).sort(function(r,n){return i(r.by,n.by)*e}).map(function(r){return r.value})};vt.prototype.reversed=function(){return this.constructClone(this).reverse()};vt.prototype.clone=function(i,t){if(i===void 0)i=1/0;else if(i===0)return this;var e=this.constructClone();return this.forEach(function(r,n){e.add(Object.clone(r,i-1,t),n)},this),e};vt.prototype.only=function(){if(this.length===1)return this.one()};vt.prototype.iterator=function(){return this.iterate.apply(this,arguments)};vt._sizePropertyDescriptor={get:function(){return this.length},enumerable:!1,configurable:!0};Object.defineProperty(vt.prototype,"size",vt._sizePropertyDescriptor);nn()});var ps=bt((Nc,lr)=>{f(function(){"use strict";if(typeof ses<"u"&&ses.ok&&!ses.ok())return;function t(A){A.permitHostObjects___&&A.permitHostObjects___(t)}f(t,"weakMapPermitHostObjects"),typeof ses<"u"&&(ses.weakMapPermitHostObjects=t);var e=!1;if(typeof WeakMap=="function"){var r=WeakMap;if(!(typeof navigator<"u"&&/Firefox/.test(navigator.userAgent))){var n=new r,s=Object.freeze({});if(n.set(s,1),n.get(s)!==1)e=!0;else{lr.exports=WeakMap;return}}}var o=Object.prototype.hasOwnProperty,a=Object.getOwnPropertyNames,l=Object.defineProperty,c=Object.isExtensible,u="weakmap:",h=u+"ident:"+Math.random()+"___";if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"&&typeof ArrayBuffer=="function"&&typeof Uint8Array=="function"){var _=new ArrayBuffer(25),g=new Uint8Array(_);crypto.getRandomValues(g),h=u+"rand:"+Array.prototype.map.call(g,function(A){return(A%36).toString(36)}).join("")+"___"}function v(A){return!(A.substr(0,u.length)==u&&A.substr(A.length-3)==="___")}if(f(v,"isNotHiddenName"),l(Object,"getOwnPropertyNames",{value:f(function(E){return a(E).filter(v)},"fakeGetOwnPropertyNames")}),"getPropertyNames"in Object){var b=Object.getPropertyNames;l(Object,"getPropertyNames",{value:f(function(E){return b(E).filter(v)},"fakeGetPropertyNames")})}function d(A){if(A!==Object(A))throw new TypeError("Not an object: "+A);var E=A[h];if(E&&E.key===A)return E;if(c(A)){E={key:A};try{return l(A,h,{value:E,writable:!1,enumerable:!1,configurable:!1}),E}catch{return}}}f(d,"getHiddenRecord"),function(){var A=Object.freeze;l(Object,"freeze",{value:f(function(x){return d(x),A(x)},"identifyingFreeze")});var E=Object.seal;l(Object,"seal",{value:f(function(x){return d(x),E(x)},"identifyingSeal")});var M=Object.preventExtensions;l(Object,"preventExtensions",{value:f(function(x){return d(x),M(x)},"identifyingPreventExtensions")})}();function y(A){return A.prototype=null,Object.freeze(A)}f(y,"constFunc");var w=!1;function C(){!w&&typeof console<"u"&&(w=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}f(C,"calledAsFunctionWarning");var P=0,k=f(function(){this instanceof k||C();var A=[],E=[],M=P++;function F(z,$){var N,J=d(z);return J?M in J?J[M]:$:(N=A.indexOf(z),N>=0?E[N]:$)}f(F,"get___");function x(z){var $=d(z);return $?M in $:A.indexOf(z)>=0}f(x,"has___");function D(z,$){var N,J=d(z);return J?J[M]=$:(N=A.indexOf(z),N>=0?E[N]=$:(N=A.length,E[N]=$,A[N]=z)),this}f(D,"set___");function m(z){var $=d(z),N,J;return $?M in $&&delete $[M]:(N=A.indexOf(z),N<0?!1:(J=A.length-1,A[N]=void 0,E[N]=E[J],A[N]=A[J],A.length=J,E.length=J,!0))}return f(m,"delete___"),Object.create(k.prototype,{get___:{value:y(F)},has___:{value:y(x)},set___:{value:y(D)},delete___:{value:y(m)}})},"OurWeakMap");k.prototype=Object.create(Object.prototype,{get:{value:f(function(E,M){return this.get___(E,M)},"get"),writable:!0,configurable:!0},has:{value:f(function(E){return this.has___(E)},"has"),writable:!0,configurable:!0},set:{value:f(function(E,M){return this.set___(E,M)},"set"),writable:!0,configurable:!0},delete:{value:f(function(E){return this.delete___(E)},"remove"),writable:!0,configurable:!0}}),typeof r=="function"?function(){e&&typeof Proxy<"u"&&(Proxy=void 0);function A(){this instanceof k||C();var E=new r,M=void 0,F=!1;function x($,N){return M?E.has($)?E.get($):M.get___($,N):E.get($,N)}f(x,"dget");function D($){return E.has($)||(M?M.has___($):!1)}f(D,"dhas");var m;e?m=f(function($,N){return E.set($,N),E.has($)||(M||(M=new k),M.set($,N)),this},"dset"):m=f(function($,N){if(F)try{E.set($,N)}catch{M||(M=new k),M.set___($,N)}else E.set($,N);return this},"dset");function z($){var N=!!E.delete($);return M&&M.delete___($)||N}return f(z,"ddelete"),Object.create(k.prototype,{get___:{value:y(x)},has___:{value:y(D)},set___:{value:y(m)},delete___:{value:y(z)},permitHostObjects___:{value:y(function($){if($===t)F=!0;else throw new Error("bogus call to permitHostObjects___")})}})}f(A,"DoubleWeakMap"),A.prototype=k.prototype,lr.exports=A,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():(typeof Proxy<"u"&&(Proxy=void 0),lr.exports=k)},"WeakMapModule")()});var si=bt((Uc,gs)=>{gs.exports=typeof WeakMap<"u"?WeakMap:ps()});var ki=bt((Gc,ms)=>{"use strict";var on=si();ar();ms.exports=Object;Object.empty=Object.freeze(Object.create(null));Object.isObject=function(i){return Object(i)===i};Object.getValueOf=function(i){return i&&typeof i.valueOf=="function"&&(i=i.valueOf()),i};var sn=new on;Object.hash=function(i){return i&&typeof i.hash=="function"?""+i.hash():Object(i)===i?(sn.has(i)||sn.set(i,Math.random().toString(36).slice(2)),sn.get(i)):""+i};var Wa=Object.prototype.hasOwnProperty;Object.owns=function(i,t){return Wa.call(i,t)};Object.has=function(i,t){if(typeof i!="object")throw new Error("Object.has can't accept non-object: "+typeof i);if(i&&typeof i.has=="function")return i.has(t);if(typeof t=="string")return t in i&&i[t]!==Object.prototype[t];throw new Error("Key must be a string for Object.has on plain objects")};Object.get=function(i,t,e){if(typeof i!="object")throw new Error("Object.get can't accept non-object: "+typeof i);return i&&typeof i.get=="function"?i.get(t,e):Object.has(i,t)?i[t]:e};Object.set=function(i,t,e){i&&typeof i.set=="function"?i.set(t,e):i[t]=e};Object.addEach=function(i,t,e){var r=arguments.length===3?e:!0;if(t)if(typeof t.forEach=="function"&&!t.hasOwnProperty("forEach"))t.isMap===!0?t.forEach(function(l,c){i[c]=l}):t.forEach(function(l){i[l[0]]=l[1]});else if(typeof t.length=="number")for(var n=0;n<t.length;n++)i[n]=t[n];else for(var s=Object.keys(t),o=0,a;a=s[o];o++)(r||!Object.owns(i,a))&&(i[a]=t[a]);return i};Object.defineEach=function(i,t,e,r,n,s){var o=arguments.length===3?e:!0;if(t)if(typeof t.forEach=="function"&&!t.hasOwnProperty("forEach"))t.isMap===!0?t.forEach(function(h,_){Object.defineProperty(i,_,{value:h,writable:s,configurable:r,enumerable:n})}):t.forEach(function(h){Object.defineProperty(i,h[0],{value:h[1],writable:s,configurable:r,enumerable:n})});else if(typeof t.length=="number")for(var a=0;a<t.length;a++)Object.defineProperty(i,a,{value:t[a],writable:s,configurable:r,enumerable:n});else for(var l=Object.keys(t),c=0,u;u=l[c];c++)(o||!Object.owns(i,u))&&Object.defineProperty(i,u,{value:t[u],writable:s,configurable:r,enumerable:n});return i};Object.forEach=function(i,t,e){for(var r=Object.keys(i),n=0,s;s=r[n];n++)t.call(e,i[s],s,i)};Object.map=function(i,t,e){for(var r=Object.keys(i),n=0,s=[],o;o=r[n];n++)s.push(t.call(e,i[o],o,i));return s};Object.values=function(i){return Object.map(i,Function.identity)};Object.concat=function(){for(var i={},t=0;t<arguments.length;t++)Object.addEach(i,arguments[t]);return i};Object.from=Object.concat;Object.is=function(i,t){return i===t?i!==0||1/i===1/t:i!==i&&t!==t};Object.equals=function(i,t,e,r){if(e=e||Object.equals,i=Object.getValueOf(i),t=Object.getValueOf(t),i===t)return!0;if(Object.isObject(i)){if(r=r||new on,r.has(i))return!0;r.set(i,!0)}if(Object.isObject(i)&&typeof i.equals=="function")return i.equals(t,e,r);if(Object.isObject(t)&&typeof t.equals=="function")return t.equals(i,e,r);if(Object.isObject(i)&&Object.isObject(t)&&Object.getPrototypeOf(i)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){for(var n in i)if(!e(i[n],t[n],e,r))return!1;for(var n in t)if(!(n in i)||!e(t[n],i[n],e,r))return!1;return!0}return i!==i&&t!==t?!0:!i||!t?i===t:!1};Object.compare=function(i,t){if(i=Object.getValueOf(i),t=Object.getValueOf(t),i===t)return 0;var e=typeof i,r=typeof t;return e==="number"&&r==="number"?i-t:e==="string"&&r==="string"?i<t?-1/0:1/0:i&&typeof i.compare=="function"?i.compare(t):t&&typeof t.compare=="function"?-t.compare(i):0};Object.clone=function(i,t,e){if(i=Object.getValueOf(i),e=e||new on,t===void 0)t=1/0;else if(t===0)return i;if(Object.isObject(i)){if(!e.has(i))if(i&&typeof i.clone=="function")e.set(i,i.clone(t,e));else{var r=Object.getPrototypeOf(i);if(r===null||r===Object.prototype){var n=Object.create(r);e.set(i,n);for(var s in i)n[s]=Object.clone(i[s],t-1,e)}else throw new Error("Can't clone "+i)}return e.get(i)}return i};Object.clear=function(i){if(i&&typeof i.clear=="function")i.clear();else for(var t=Object.keys(i),e=t.length;e;)e--,delete i[t[e]];return i}});var an=bt((Hc,_s)=>{var ys=ki();_s.exports=hr;function hr(){throw new Error("Can't construct. GenericOrder is a mixin.")}f(hr,"GenericOrder");hr.prototype.equals=function(i,t){if(t=t||this.contentEquals||ys.equals,this===i)return!0;if(!i)return!1;var e=this;return this.length===i.length&&this.zip(i).every(function(r){return t(r[0],r[1])})};hr.prototype.compare=function(i,t){if(t=t||this.contentCompare||ys.compare,this===i)return 0;if(!i)return 1;var e=Math.min(this.length,i.length),r=this.zip(i).reduce(function(n,s,o){return n===0?o>=e?n:t(s[0],s[1]):n},0);return r===0?this.length-i.length:r};hr.prototype.toJSON=function(){return this.toArray()}});var nn=bt((Kc,xs)=>{"use strict";var Vc=ar(),$t=ve(),vs=an(),Va=si();xs.exports=Array;var Oi=Array.prototype.splice,Ka=Array.prototype.slice;Array.empty||(Array.empty=[],Object.freeze&&Object.freeze(Array.empty));Array.nativeFrom||(Array.nativeFrom=Array.from);var $a=typeof Symbol<"u";Array.from=function(i,t,e){if($a&&i&&(typeof i[Symbol.iterator]=="function"||typeof t=="function"))return Array.nativeFrom(i,t,e);var r=[];return r.addEach(i),r};Array.unzip=function(i){for(var t=[],e=1/0,r=0;r<i.length;r++){var n=i[r];i[r]=n.toArray(),n.length<e&&(e=n.length)}for(var r=0;r<i.length;r++)for(var n=i[r],s=0;s<n.length;s++)s<e&&s in n&&(t[s]=t[s]||[],t[s][r]=n[s]);return t};function ht(i,t){Object.defineProperty(Array.prototype,i,{value:t,writable:!0,configurable:!0,enumerable:!1})}f(ht,"define");ht("addEach",$t.prototype.addEach);ht("deleteEach",$t.prototype.deleteEach);ht("toArray",$t.prototype.toArray);ht("toObject",$t.prototype.toObject);ht("all",$t.prototype.all);ht("any",$t.prototype.any);ht("min",$t.prototype.min);ht("max",$t.prototype.max);ht("sum",$t.prototype.sum);ht("average",$t.prototype.average);ht("only",$t.prototype.only);ht("flatten",$t.prototype.flatten);ht("zip",$t.prototype.zip);ht("enumerate",$t.prototype.enumerate);ht("group",$t.prototype.group);ht("sorted",$t.prototype.sorted);ht("reversed",$t.prototype.reversed);ht("constructClone",function(i){var t=new this.constructor;return t.addEach(i),t});ht("has",function(i,t){return this.findValue(i,t)!==-1});ht("get",function(i,t){if(+i!==i)throw new Error("Indicies must be numbers");return!i in this?t:this[i]});ht("set",function(i,t){return this[i]=t,!0});ht("add",function(i){return this.push(i),!0});ht("delete",function(i,t){var e=this.findValue(i,t);return e!==-1?(this.spliceOne(e),!0):!1});ht("deleteAll",function(i,t){t=t||this.contentEquals||Object.equals;for(var e=0,r=0;r<this.length;)t(i,this[r])?(this.swap(r,1),e++):r++;return e});Array.prototype.find||ht("find",function(i){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),e=t.length>>>0;if(typeof i!="function")throw new TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<e;){var s=t[n];if(i.call(r,s,n,t))return s;n++}});var bs={};function ws(i,t){typeof console<"u"&&typeof console.warn=="function"&&t!==!0&&bs.hasOwnProperty(i)===!1&&(console.warn(i),bs[i]++)}f(ws,"deprecatedWarn");var Xa=Object.getOwnPropertyDescriptor(Array.prototype,"find").value;ht("find",function(i,t,e){return typeof arguments[0]=="function"&&this instanceof Array?Xa.apply(this,arguments):(ws("Array#find usage is deprecated please use Array#findValue"),this.findValue.apply(this,arguments))});ht("findValue",function(i,t,e){if(e)throw new Error("Array#findValue does not support third argument: index");t=t||this.contentEquals||Object.equals;for(var e=0;e<this.length;e++)if(e in this&&t(i,this[e]))return e;return-1});ht("findLast",function(i,t){return ws("Array#findLast function is deprecated please use Array#findLastValue instead."),this.findLastValue.apply(this,arguments)});ht("findLastValue",function(i,t){t=t||this.contentEquals||Object.equals;var e=this.length;do if(e--,e in this&&t(this[e],i))return e;while(e>0);return-1});ht("swap",function(i,t,e){var r,n,s,o,a;if(i>this.length&&(this.length=i),typeof e<"u")if(r=[i,t],Array.isArray(e)||(e=Ka.call(e)),s=0,n=e.length,n<1e3){for(s;s<n;s++)r[s+2]=e[s];return Oi.apply(this,r)}else{for(a=Oi.apply(this,r),s;s<n;){for(r=[i+s,0],o=2;o<1002&&s<n;o++,s++)r[o]=e[s];Oi.apply(this,r)}return a}else return typeof t<"u"?Oi.call(this,i,t):typeof i<"u"?Oi.call(this,i):[]});ht("peek",function(){return this[0]});ht("poke",function(i){this.length>0&&(this[0]=i)});ht("peekBack",function(){if(this.length>0)return this[this.length-1]});ht("pokeBack",function(i){this.length>0&&(this[this.length-1]=i)});ht("one",function(){for(var i in this)if(Object.owns(this,i))return this[i]});Array.prototype.clear||ht("clear",function(){return this.length=0,this});ht("compare",function(i,t){t=t||Object.compare;var e,r,n,s,o;if(this===i)return 0;if(!i||!Array.isArray(i))return vs.prototype.compare.call(this,i,t);for(r=this.length<i.length?this.length:i.length,e=0;e<r;e++)if(e in this)if(e in i){if(n=this[e],s=i[e],o=t(n,s),o)return o}else return-1;else if(e in i)return 1;return this.length-i.length});ht("equals",function(i,t){t=t||Object.equals;var e=0,r=this.length,n,s;if(this===i)return!0;if(!i||!Array.isArray(i))return vs.prototype.equals.call(this,i);if(r!==i.length)return!1;for(;e<r;++e)if(e in this){if(!(e in i)||(n=this[e],s=i[e],!t(n,s)))return!1}else if(e in i)return!1;return!0});ht("clone",function(i,t){if(i==null)i=1/0;else if(i===0)return this;if(t=t||new Va,t.has(this))return t.get(this);var e=new Array(this.length);t.set(this,e);for(var r in this)e[r]=Object.clone(this[r],i-1,t);return e});ht("iterate",function(i,t){return new Ai(this,i,t)});Array.prototype.spliceOne===void 0&&ht("spliceOne",function(i,t){var e=this.length;if(e)if(arguments.length===1){for(;i<e;)this[i]=this[i+1],i++;this.length--}else this[i]=t});ht("Iterator",Ai);function Ai(i,t,e){this.array=i,this.start=t??0,this.end=e}f(Ai,"ArrayIterator");Ai.prototype.__iterationObject=null;Object.defineProperty(Ai.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}});Ai.prototype.next=function(){return this.start===(this.end==null?this.array.length:this.end)?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=this.array[this.start++],this._iterationObject}});var Cs=bt(()=>{RegExp.escape||(Ss=/[-[\]{}()*+?.\\^$|,#\s]/g,RegExp.escape=function(i){return i.replace(Ss,"\\$&")});var Ss});var Ee=bt(()=>{var Yc=nn(),qc=ki(),Jc=ar(),Qc=Cs()});var cr=bt((iu,ks)=>{ks.exports=Qt;function Qt(){throw new Error("Can't construct. GenericSet is a mixin.")}f(Qt,"GenericSet");Qt.prototype.isSet=!0;Qt.prototype.union=function(i){var t=this.constructClone(this);return t.addEach(i),t};Qt.prototype.intersection=function(i){return this.constructClone(this.filter(function(t){return i.has(t)}))};Qt.prototype.difference=function(i){var t=this.constructClone(this);return t.deleteEach(i),t};Qt.prototype.symmetricDifference=function(i){var t=this.union(i),e=this.intersection(i);return t.difference(e)};Qt.prototype.deleteAll=function(i){return+this.delete(i)};Qt.prototype.equals=function(i,t){var e=this;return i&&typeof i.reduce=="function"&&this.length===i.length&&i.reduce(function(r,n){return r&&e.has(n,t)},!0)};Qt.prototype.forEach=function(i){var t=arguments[1];return this.reduce(function(e,r,n,s,o){i.call(t,r,r,s,o)},void 0)};Qt.prototype.toJSON=function(){return this.toArray()};Qt.prototype.contains=function(i){return this.has(i)};Qt.prototype.remove=function(i){return this.delete(i)};Qt.prototype.toggle=function(i){this.has(i)?this.delete(i):this.add(i)};var Za=f(function(i,t){return i},"_valuesArrayFunction");Qt.prototype.valuesArray=function(){return this.map(Za)};var Ya=f(function(i,t){return[t,i]},"_entriesArrayFunction");Qt.prototype.entriesArray=function(){return this.map(Ya)}});var ln=bt((su,As)=>{"use strict";As.exports=dt;var nu=Ee(),Os=ve(),qa=an();function dt(i,t,e){return dt._init(dt,this,i,t,e)}f(dt,"List");dt._init=function(i,t,e,r,n){if(!(t instanceof i))return new i(e,r,n);var s=t.head=new t.Node;s.next=s,s.prev=s,t.contentEquals=r||Object.equals,t.getDefault=n||Function.noop,t.length=0,t.addEach(e)};dt.List=dt;Object.addEach(dt.prototype,Os.prototype);Object.addEach(dt.prototype,qa.prototype);dt.from=Os.from;dt.prototype.constructClone=function(i){return new this.constructor(i,this.contentEquals,this.getDefault)};dt.prototype.find=function(i,t,e){t=t||this.contentEquals;for(var r=this.head,n=this.scan(e,r.next);n!==r;){if(t(n.value,i))return n;n=n.next}};dt.prototype.findLast=function(i,t,e){t=t||this.contentEquals;for(var r=this.head,n=this.scan(e,r.prev);n!==r;){if(t(n.value,i))return n;n=n.prev}};dt.prototype.has=function(i,t){return!!this.find(i,t)};dt.prototype.get=function(i,t){var e=this.find(i,t);return e?e.value:this.getDefault(i)};dt.prototype.delete=function(i,t){var e=this.findLast(i,t);return e?(e.delete(),this.length--,!0):!1};dt.prototype.deleteAll=function(i,t){t=t||this.contentEquals;for(var e=this.head,r=e.next,n=0;r!==e;)t(i,r.value)&&(r.delete(),n++),r=r.next;return this.length-=n,n};dt.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0};dt.prototype.add=function(i){var t=new this.Node(i);return this._addNode(t)};dt.prototype._addNode=function(i){return this.head.addBefore(i),this.length++,!0};dt.prototype.push=function(){for(var i=this.head,t=0;t<arguments.length;t++){var e=arguments[t],r=new this.Node(e);i.addBefore(r)}this.length+=arguments.length};dt.prototype.unshift=function(){for(var i=this.head,t=0;t<arguments.length;t++){var e=arguments[t],r=new this.Node(e);i.addAfter(r),i=r}this.length+=arguments.length};dt.prototype._shouldPop=function(){var i,t=this.head;return t.prev!==t&&(i=t.prev.value),i};dt.prototype.pop=function(i,t){var e,r=this.head;if(r.prev!==r){e=r.prev.value;var n=this.length-1,s=i?i.call(this,e,n):void 0;r.prev.delete(),this.length--,t&&t.call(this,e,n,s)}return e};dt.prototype.shift=function(i,t){var e,r=this.head;if(r.prev!==r){e=r.next.value;var n=i?i.call(this,e,0):void 0;r.next.delete(),this.length--,t&&t.call(this,e,0,n)}return e};dt.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value};dt.prototype.poke=function(i){this.head!==this.head.next?this.head.next.value=i:this.push(i)};dt.prototype.one=function(){return this.peek()};dt.prototype.scan=function(i,t){var e=this.head;if(typeof i=="number"){var r=i;if(r>=0)for(i=e.next;r&&(r--,i=i.next,i!=e););else for(i=e;r<0&&(r++,i=i.prev,i!=e););return i}else return i||t};dt.prototype.slice=function(i,t){var e=[],r=this.head;for(i=this.scan(i,r.next),t=this.scan(t,r);i!==t&&i!==r;)e.push(i.value),i=i.next;return e};dt.prototype.splice=function(i,t){return this.swap(i,t,Array.prototype.slice.call(arguments,2))};dt.prototype.swap=function(i,t,e,r,n){var s=i;i=this.scan(i,this.head),t==null&&(t=1/0),e=Array.from(e);for(var o=[],c=i;t--&&t>=0&&c!==this.head;)o.push(c.value),c=c.next;var a,l;a=r?r.call(this,i,e,o):void 0;for(var c=i,u=0,c=i;u<o.length;u++,c=c.next)c.delete();s==null&&c===this.head&&(c=this.head.next);for(var u=0;u<e.length;u++){var h=new this.Node(e[u]);c.addBefore(h)}return this.length+=e.length-o.length,n&&n.call(this,i,e,o),o};dt.prototype.reverse=function(){var i=this.head;do{var t=i.next;i.next=i.prev,i.prev=t,i=i.next}while(i!==this.head);return this};dt.prototype.sort=function(){this.swap(0,this.length,this.sorted.apply(this,arguments))};dt.prototype.reduce=function(i,t){for(var e=arguments[2],r=this.head,n=r.next;n!==r;)t=i.call(e,t,n.value,n,this),n=n.next;return t};dt.prototype.reduceRight=function(i,t){for(var e=arguments[2],r=this.head,n=r.prev;n!==r;)t=i.call(e,t,n.value,n,this),n=n.prev;return t};dt.prototype.updateIndexes=function(i,t){for(;i!==this.head;)i.index=t++,i=i.next};dt.prototype.iterate=function(){return new ur(this.head)};function ur(i){this.head=i,this.at=i.next}f(ur,"ListIterator");ur.prototype.__iterationObject=null;Object.defineProperty(ur.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}});ur.prototype.next=function(){if(this.at===this.head)this._iterationObject.done=!0,this._iterationObject.value=void 0;else{var i=this.at.value;this.at=this.at.next,this._iterationObject.value=i}return this._iterationObject};dt.prototype.Node=fr;function fr(i){this.value=i,this.prev=null,this.next=null}f(fr,"Node");fr.prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev};fr.prototype.addBefore=function(i){var t=this.prev;this.prev=i,i.prev=t,t.next=i,i.next=this};fr.prototype.addAfter=function(i){var t=this.next;this.next=i,i.next=t,t.prev=i,i.prev=this}});var hn=bt((au,Es)=>{"use strict";Es.exports=et;var Ie=ki(),Nt=ve();function et(i,t){var e=t&&i&&i.values&&i.values();if(e&&typeof e.next=="function")return e;if(!(this instanceof et))return new et(i);if(Array.isArray(i)||typeof i=="string")return et.iterate(i);if(i=Ie(i),i instanceof et)return i;if(i.next)this.next=function(){return i.next()};else if(i.iterate){var r=i.iterate();this.next=function(){return r.next()}}else if(Ie.prototype.toString.call(i)==="[object Function]")this.next=i;else throw new TypeError("Can't iterate "+i)}f(et,"Iterator");et.prototype.forEach=Nt.prototype.forEach;et.prototype.map=Nt.prototype.map;et.prototype.filter=Nt.prototype.filter;et.prototype.every=Nt.prototype.every;et.prototype.some=Nt.prototype.some;et.prototype.any=Nt.prototype.any;et.prototype.all=Nt.prototype.all;et.prototype.min=Nt.prototype.min;et.prototype.max=Nt.prototype.max;et.prototype.sum=Nt.prototype.sum;et.prototype.average=Nt.prototype.average;et.prototype.flatten=Nt.prototype.flatten;et.prototype.zip=Nt.prototype.zip;et.prototype.enumerate=Nt.prototype.enumerate;et.prototype.sorted=Nt.prototype.sorted;et.prototype.group=Nt.prototype.group;et.prototype.reversed=Nt.prototype.reversed;et.prototype.toArray=Nt.prototype.toArray;et.prototype.toObject=Nt.prototype.toObject;et.prototype.iterator=Nt.prototype.iterator;et.prototype.__iterationObject=null;Ie.defineProperty(et.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}});et.prototype.constructClone=function(i){var t=[];return t.addEach(i),t};et.prototype.mapIterator=function(i){var t=et(this),e=arguments[1],r=0;if(Ie.prototype.toString.call(i)!="[object Function]")throw new TypeError;return new t.constructor(function(){if(t._iterationObject.done!==!0){var n=i.call(e,t.next().value,r++,t);t._iterationObject.value=n}return t._iterationObject})};et.prototype.filterIterator=function(i){var t=et(this),e=arguments[1],r=0;if(Ie.prototype.toString.call(i)!="[object Function]")throw new TypeError;return new t.constructor(function(){for(var n;;)if(n=t.next(),n.done!==!0){if(i.call(e,n.value,r++,t))return n}else return n})};et.prototype.reduce=function(i){var t=et(this),e=arguments[1],r=arguments[2],n=0,s;if(Ie.prototype.toString.call(i)!="[object Function]")throw new TypeError;if(s=t.next(),s.done===!0){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(arguments.length>1?e=i.call(r,e,s.value,n,t):e=s.value,n++;;){if(s=t.next(),s.done===!0)return e;e=i.call(r,e,s.value,n,t),n++}};et.prototype.concat=function(){return et.concat(Array.prototype.concat.apply(this,arguments))};et.prototype.dropWhile=function(i){var t=et(this),e=arguments[1],r=!1,n,s,o=0;if(Ie.prototype.toString.call(i)!="[object Function]")throw new TypeError;for(;s=t.next(),s.done!==!0;){if(!i.call(e,s.value,o,t)){r=!0,n=s.value;break}o++}return r?t.constructor([n]).concat(t):t.constructor([])};et.prototype.takeWhile=function(i){var t=et(this),e=arguments[1],r,n=0;if(Ie.prototype.toString.call(i)!="[object Function]")throw new TypeError;return new t.constructor(function(){if(t._iterationObject.done!==!0){var s=t.next().value;i.call(e,s,n++,t)?t._iterationObject.value=s:(t._iterationObject.done=!0,t._iterationObject.value=void 0)}return t._iterationObject})};et.prototype.zipIterator=function(){return et.unzip(Array.prototype.concat.apply(this,arguments))};et.prototype.enumerateIterator=function(i){return et.count(i).zipIterator(this)};et.iterate=function(i){var t;return t=0,new et(function(){if(typeof i=="object")for(;!(t in i);)if(t>=i.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}else t+=1;else t>=i.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=i[t],t+=1),this._iterationObject})};et.cycle=function(i,t){var e;return arguments.length<2&&(t=1/0),new et(function(){var r,n;return e&&(n=e()),(!e||n.done===!0)&&(t>0?(t--,r=et.iterate(i),n=(e=r.next.bind(r))()):(this._iterationObject.done=!0,n=this._iterationObject)),n})};et.concat=function(i){i=et(i);var t;return new et(function(){var e,r;return t&&(r=t()),!r||r.done===!0?(r=i.next(),r.done===!1?(e=et(r.value),t=e.next.bind(e),t()):r):r})};et.unzip=function(i){return i=et(i).map(et),i.length===0?new et([]):new et(function(){var t,e,r=i.map(function(n){return e=n.next(),e.done===!0&&(t=!0),e.value});return t?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=r,this._iterationObject})};et.zip=function(){return et.unzip(Array.prototype.slice.call(arguments))};et.chain=function(){return et.concat(Array.prototype.slice.call(arguments))};et.range=function(i,t,e){return arguments.length<3&&(e=1),arguments.length<2&&(t=i,i=0),i=i||0,e=e||1,new et(function(){i>=t&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var r=i;return i+=e,this._iterationObject.value=r,this._iterationObject})};et.count=function(i,t){return et.range(i,1/0,t)};et.repeat=function(i,t){return new et.range(t).mapIterator(function(){return i})}});var fn=bt((hu,Is)=>{"use strict";var Pe=ki(),cn=hn();Is.exports=Rt;function Rt(){throw new Error("Can't construct. GenericMap is a mixin.")}f(Rt,"GenericMap");Rt.prototype.isMap=!0;Rt.prototype.addEach=function(i){var t;if(i&&Pe(i)===i)if(typeof i.forEach=="function")i.isMap===!0?i.forEach(function(e,r){this.set(r,e)},this):i.forEach(function(e){this.set(e[0],e[1])},this);else if(typeof i.length=="number")for(t=0;t<i.length;t++)this.add(i[t],t);else Pe.keys(i).forEach(function(e){this.set(e,i[e])},this);else if(i&&typeof i.length=="number")for(t=0;t<i.length;t++)this.add(i[t],t);return this};Rt.prototype.get=function(i,t){var e=this.store.get(new this.Item(i));return e?e.value:arguments.length>1?(console.log("Use of a second argument as default value is deprecated to match standards"),t):this.getDefault(i)};Rt.prototype.set=function(i,t){var e=new this.Item(i,t),r=this.store.get(e),n=!1;return r?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,r.value),r.value=t,this.dispatchesMapChanges&&this.dispatchMapChange(i,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,void 0),this.store.add(e)&&(this.length++,n=!0),this.dispatchesMapChanges&&this.dispatchMapChange(i,t)),this};Rt.prototype.add=function(i,t){return this.set(t,i)};Rt.prototype.has=function(i){return this.store.has(new this.Item(i))};Rt.prototype.delete=function(i){var t=new this.Item(i);if(this.store.has(t)){var e=this.store.get(t).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,e),this.store.delete(t),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(i,void 0),!0}return!1};Rt.prototype.clear=function(){var i,t;if(this.dispatchesMapChanges&&(this.forEach(function(r,n){this.dispatchBeforeMapChange(n,r)},this),i=this.keysArray()),this.store.clear(),this.length=0,this.dispatchesMapChanges)for(var e=0;t=i[e];e++)this.dispatchMapChange(t)};Rt.prototype.reduce=function(i,t,e){return this.store.reduce(function(r,n){return i.call(e,r,n.value,n.key,this)},t,this)};Rt.prototype.reduceRight=function(i,t,e){return this.store.reduceRight(function(r,n){return i.call(e,r,n.value,n.key,this)},t,this)};Rt.prototype.keysArray=function(){return this.map(function(i,t){return t})};Rt.prototype.keys=function(){return new cn(this.keysArray(),!0)};Rt.prototype.valuesArray=function(){return this.map(Function.identity)};Rt.prototype.values=function(){return new cn(this.valuesArray(),!0)};Rt.prototype.entriesArray=function(){return this.map(function(i,t){return[t,i]})};Rt.prototype.entries=function(){return new cn(this.entriesArray(),!0)};Rt.prototype.items=function(){return this.entriesArray()};Rt.prototype.equals=function(i,t){if(t=t||Pe.equals,this===i)return!0;if(i&&typeof i.every=="function")return i.length===this.length&&i.every(function(r,n){return t(this.get(n),r)},this);var e=Pe.keys(i);return e.length===this.length&&Pe.keys(i).every(function(r){return t(this.get(r),i[r])},this)};Rt.prototype.toJSON=function(){return this.entriesArray()};Rt.prototype.Item=un;function un(i,t){this.key=i,this.value=t}f(un,"Item");un.prototype.equals=function(i){return Pe.equals(this.key,i.key)&&Pe.equals(this.value,i.value)};un.prototype.compare=function(i){return Pe.compare(this.key,i.key)}});var Ms=bt((fu,Ps)=>{"use strict";var uu=Ee(),dn=ve(),Ja=fn();Ps.exports=It;function It(i,t){if(!(this instanceof It))return new It(i,t);t=t||Function.noop,this.getDefault=t,this.store=Object.create(null),this.length=0,this.addEach(i)}f(It,"Dict");It.Dict=It;Object.addEach(It.prototype,dn.prototype);Object.addEach(It.prototype,Ja.prototype);It.from=dn.from;It.prototype.constructClone=function(i){return new this.constructor(i,this.getDefault)};It.prototype.assertString=function(i){if(typeof i!="string")throw new TypeError("key must be a string but Got "+i)};Object.defineProperty(It.prototype,"$__proto__",{writable:!0});Object.defineProperty(It.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&typeof this._protoValue<"u"}});Object.defineProperty(It.prototype,"_protoValue",{get:function(){return this.$__proto__},set:function(i){this.$__proto__=i}});Object.defineProperty(It.prototype,"size",dn._sizePropertyDescriptor);It.prototype.get=function(i,t){return this.assertString(i),i==="__proto__"?this._hasProto?this._protoValue:arguments.length>1?t:this.getDefault(i):i in this.store?this.store[i]:arguments.length>1?t:this.getDefault(i)};It.prototype.set=function(i,t){this.assertString(i);var e=i==="__proto__";return(e?this._hasProto:i in this.store)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,e?this._protoValue:this.store[i]),e?this._protoValue=t:this.store[i]=t,this.dispatchesMapChanges&&this.dispatchMapChange(i,t),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,void 0),this.length++,e?this._protoValue=t:this.store[i]=t,this.dispatchesMapChanges&&this.dispatchMapChange(i,t),!0)};It.prototype.has=function(i){return this.assertString(i),i==="__proto__"?this._hasProto:i in this.store};It.prototype.delete=function(i){return this.assertString(i),i==="__proto__"?this._hasProto?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,this._protoValue),this._protoValue=void 0,this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(i,void 0),!0):!1:i in this.store?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,this.store[i]),delete this.store[i],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(i,void 0),!0):!1};It.prototype.clear=function(){var i;this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange("__proto__",this._protoValue),this._protoValue=void 0,this.dispatchesMapChanges&&this.dispatchMapChange("__proto__",void 0));for(i in this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,this.store[i]),delete this.store[i],this.dispatchesMapChanges&&this.dispatchMapChange(i,void 0);this.length=0};It.prototype.reduce=function(i,t,e){this._hasProto&&(t=i.call(e,t,"$__proto__","__proto__",this));var r=this.store;for(var n in this.store)t=i.call(e,t,r[n],n,this);return t};It.prototype.reduceRight=function(i,t,e){var r=this,n=this.store;return t=Object.keys(this.store).reduceRight(function(s,o){return i.call(e,s,n[o],o,r)},t),this._hasProto?i.call(e,t,this._protoValue,"__proto__",r):t};It.prototype.one=function(){var i;for(i in this.store)return this.store[i];return this._protoValue};It.prototype.toJSON=function(){return this.toObject()}});var pn=bt((pu,Ts)=>{"use strict";Ts.exports=dr;function dr(){}f(dr,"TreeLog");dr.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"};dr.unicodeRound={intersection:"\u254B",through:"\u2501",branchUp:"\u253B",branchDown:"\u2533",fromBelow:"\u256D",fromAbove:"\u2570",fromBoth:"\u2523",strafe:"\u2503"};dr.unicodeSharp={intersection:"\u254B",through:"\u2501",branchUp:"\u253B",branchDown:"\u2533",fromBelow:"\u250F",fromAbove:"\u2517",fromBoth:"\u2523",strafe:"\u2503"}});var Ls=bt((yu,Rs)=>{"use strict";var mu=Ee(),Qa=Ms(),tl=ln(),Ds=ve(),el=cr(),il=pn();Rs.exports=Lt;function Lt(i,t,e,r){if(!(this instanceof Lt))return new Lt(i,t,e,r);t=t||Object.equals,e=e||Object.hash,r=r||Function.noop,this.contentEquals=t,this.contentHash=e,this.getDefault=r;var n=this;this.buckets=new this.Buckets(null,f(function(){return new n.Bucket},"getDefaultBucket")),this.length=0,this.addEach(i)}f(Lt,"FastSet");Lt.FastSet=Lt;Object.addEach(Lt.prototype,Ds.prototype);Object.addEach(Lt.prototype,el.prototype);Lt.from=Ds.from;Lt.prototype.Buckets=Qa;Lt.prototype.Bucket=tl;Lt.prototype.constructClone=function(i){return new this.constructor(i,this.contentEquals,this.contentHash,this.getDefault)};Lt.prototype.has=function(i){var t=this.contentHash(i);return this.buckets.get(t).has(i)};Lt.prototype.get=function(i,t){if(t)throw new Error("FastSet#get does not support second argument: equals");var e=this.contentHash(i),r=this.buckets;return r.has(e)?r.get(e).get(i):this.getDefault(i)};Lt.prototype.delete=function(i,t){if(t)throw new Error("FastSet#delete does not support second argument: equals");var e=this.contentHash(i),r=this.buckets;if(r.has(e)){var n=r.get(e);if(n.delete(i))return this.length--,n.length===0&&r.delete(e),!0}return!1};Lt.prototype.clear=function(){this.buckets.clear(),this.length=0};Lt.prototype.add=function(i){var t=this.contentHash(i),e=this.buckets;return e.has(t)||e.set(t,new this.Bucket(null,this.contentEquals)),e.get(t).has(i)?!1:(e.get(t).add(i),this.length++,!0)};Lt.prototype.reduce=function(i,t){var e=arguments[2],r=this.buckets,n=0;return r.reduce(function(s,o){return o.reduce(function(a,l){return i.call(e,a,l,n++,this)},s,this)},t,this)};Lt.prototype.one=function(){if(this.length>0)return this.buckets.one().one()};Lt.prototype.iterate=function(){return this.buckets.valuesArray().flatten().iterate()};Lt.prototype.log=function(i,t,e,r){i=i||il.unicodeSharp,t=t||this.logNode,e||(e=console.log,r=console),e=e.bind(r);for(var n=this.buckets,s=n.size,o=n.keys(),a,l=0,c,u,h;a=o.next().value;)l===s-1?(c=i.fromAbove,u=" "):l===0?(c=i.branchDown,u=i.strafe):(c=i.fromBoth,u=i.strafe),h=n.get(a),e.call(r,c+i.through+i.branchDown+" "+a),h.forEach(function(_,g){var v,b,d;g===h.head.prev?(v=i.fromAbove,b=" "):(v=i.fromBoth,b=i.strafe),t(g,function(y){d?e.call(r,u+" "+b+"  "+y):(e.call(r,u+" "+v+i.through+i.through+y),d=!0)},function(y){e.call(r,u+" "+i.strafe+"  "+y)})}),l++};Lt.prototype.logNode=function(i,t){var e=i.value;Object(e)===e?JSON.stringify(e,null,4).split(`
`).forEach(function(r){t(" "+r)}):t(" "+e)}});var Fs=bt((vu,gr)=>{"use strict";var bu=Ee(),mr=ve(),pr=cr(),jt,St;global.Set!==void 0&&typeof global.Set.prototype.values=="function"&&(jt=gr.exports=global.Set,jt.Set=jt,jt.prototype.reduce=function(i,t){var e=arguments[2];return this.forEach(function(r){t=i.call(e,t,r,this)}),t},jt.prototype.reduceRight=function(i,t){for(var e=arguments[2],r=this.values(),n=this.size,s=new Array(this.size),o,a=n;o=r.next().value;)s[--a]=o;for(;a<n;)t=i.call(e,t,s[a++],this);return t},jt.prototype.equals=function(i,t){var e=this;return i&&typeof i.reduce=="function"&&this.size===(i.size||i.length)&&i.reduce(function(r,n){return r&&e.has(n,t)},!0)},jt.prototype.constructClone=function(i){return new this.constructor(i,this.contentEquals,this.contentHash,this.getDefault)},jt.prototype.toJSON=function(){return this.entriesArray()},jt.prototype.one=function(){if(this.size>0)return this.values().next().value},jt.prototype.pop=function(){if(this.size){for(var i=this.values(),t,e;t=i.next().value;)e=t;return this.delete(e,this.size-1),e}},jt.prototype.shift=function(){if(this.size){var i=this.values().next().value;return this.delete(i,0),i}},Object.defineProperty(jt.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),jt.from=function(i){var t=new this;return t.addEach(i),t},Object.addEach(jt.prototype,mr.prototype,!1),Object.addEach(jt.prototype,pr.prototype,!1));var rl=ln(),nl=Ls(),sl=hn();St=f(function i(t,e,r,n){return i._init(i,this,t,e,r,n)},"CollectionsSet");St._init=function(i,t,e,r,n,s){if(!(t instanceof i))return new i(e,r,n,s);r=r||Object.equals,n=n||Object.hash,s=s||Function.noop,t.contentEquals=r,t.contentHash=n,t.getDefault=s,t.order=new t.Order(void 0,r),t.store=new t.Store(void 0,function(o,a){return r(o.value,a.value)},function(o){return n(o.value)}),t.length=0,t.addEach(e)};St.Set=St;St.CollectionsSet=St;Object.addEach(St.prototype,mr.prototype);Object.addEach(St.prototype,pr.prototype);St.from=mr.from;Object.defineProperty(St.prototype,"size",mr._sizePropertyDescriptor);St.prototype.Order=rl;St.prototype.Store=nl;St.prototype.constructClone=function(i){return new this.constructor(i,this.contentEquals,this.contentHash,this.getDefault)};St.prototype.has=function(i){var t=new this.order.Node(i);return this.store.has(t)};St.prototype.get=function(i,t){if(t)throw new Error("Set#get does not support second argument: equals");var e=new this.order.Node(i);return e=this.store.get(e),e?e.value:this.getDefault(i)};St.prototype.add=function(i){var t=new this.order.Node(i);if(!this.store.has(t)){var e=this.length;return this.order.add(i),t=this.order.head.prev,this.store.add(t),this.length++,!0}return!1};St.prototype.delete=function(i,t){if(t)throw new Error("Set#delete does not support second argument: equals");var e=new this.order.Node(i);return this.store.has(e)?(e=this.store.get(e),this.store.delete(e),this.order.splice(e,1),this.length--,!0):!1};St.prototype.pop=function(){if(this.length){var i=this.order.head.prev.value;return this.delete(i),i}};St.prototype.shift=function(){if(this.length){var i=this.order.head.next.value;return this.delete(i),i}};St.prototype.one=function(){if(this.length>0)return this.store.one().value};St.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0};Object.defineProperty(St.prototype,"_clear",{value:St.prototype.clear});St.prototype.reduce=function(i,t){var e=arguments[2],r=this.order,n=0;return r.reduce(function(s,o){return i.call(e,s,o,n++,this)},t,this)};St.prototype.reduceRight=function(i,t){var e=arguments[2],r=this.order,n=this.length-1;return r.reduceRight(function(s,o){return i.call(e,s,o,n--,this)},t,this)};St.prototype.iterate=function(){return this.order.iterate()};St.prototype.values=function(){return new sl(this.valuesArray(),!0)};St.prototype.log=function(){var i=this.store;return i.log.apply(i,arguments)};jt?(jt.prototype.valuesArray=pr.prototype.valuesArray,jt.prototype.entriesArray=pr.prototype.entriesArray,gr.exports=jt,jt.CollectionsSet=St):gr.exports=St});var oi=bt((Su,br)=>{"use strict";var xu=Ee(),vr=ve(),mt,_r,mn;global.Map!==void 0&&typeof global.Set.prototype.values=="function"&&(mt=br.exports=global.Map,_r=mt,mt.Map=mt,Bs={}.__proto__===Object.prototype,Bs?yr=f(function(){this.__proto__=Ws},"map_makeObservable"):yr=f(function(){Object.defineProperties(this,observableSetProperties)},"map_makeObservable"),Object.defineProperty(mt.prototype,"makeObservable",{value:yr,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(mt.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),mt.prototype.constructClone=function(i){return new this.constructor(i)},mt.prototype.isMap=!0,mt.prototype.addEach=function(i){if(i&&Object(i)===i)if(typeof i.forEach=="function")i.isMap===!0?i.forEach(function(e,r){this.set(r,e)},this):i.forEach(function(e){this.set(e[0],e[1])},this);else if(typeof i.length=="number")for(var t=0;t<i.length;t++)this.add(i[t],t);else Object.keys(i).forEach(function(e){this.set(e,i[e])},this);else if(i&&typeof i.length=="number")for(var t=0;t<i.length;t++)this.add(i[t],t);return this},mt.prototype.add=function(i,t){return this.set(t,i)},mt.prototype.reduce=function(i,t){var e=arguments[2];return this.forEach(function(r,n,s){t=i.call(e,t,r,n,this)}),t},mt.prototype.reduceRight=function(i,t){for(var e=arguments[2],r=this.keys(),n=this.size,s=new Array(this.size),o,a=0;o=r.next().value;)s[--n]=o;for(;a++<n;)t=i.call(e,t,this.get(s[a]),s[a],this);return t},mt.prototype.equals=function(i,t){if(t=t||Object.equals,this===i)return!0;if(i&&typeof i.every=="function")return i.size===this.size&&i.every(function(r,n){return t(this.get(n),r)},this);var e=Object.keys(i);return e.length===this.size&&Object.keys(i).every(function(r){return t(this.get(r),i[r])},this)},zs=f(function(i,t){return t},"_keysArrayFunction"),mt.prototype.keysArray=function(){return this.map(zs)},Ns=f(function(i,t){return i},"_valuesArrayFunction"),mt.prototype.valuesArray=function(){return this.map(Ns)},js=f(function(i,t){return[t,i]},"_entriesArrayFunction"),mt.prototype.entriesArray=function(){return this.map(js)},mt.prototype.toJSON=function(){return this.entriesArray()},mt.prototype.items=function(){return this.entriesArray()},mt.from=function(i){var t=new this;return t.addEach(i),t},Object.defineProperty(mt.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),Us=mt.prototype.clear,gn=mt.prototype.set,Gs=mt.prototype.delete,Hs={clear:{value:function(){var i;this.dispatchesMapChanges&&(this.forEach(function(t,e){this.dispatchBeforeMapChange(e,t)},this),i=this.keysArray()),Us.call(this),this.dispatchesMapChanges&&i.forEach(function(t){this.dispatchMapChange(t)},this)},writable:!0,configurable:!0},set:{value:function(i,t){var e=this.get(i);return e?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,e),gn.call(this,i,t),this.dispatchesMapChanges&&this.dispatchMapChange(i,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,void 0),gn.call(this,i,t),this.dispatchesMapChanges&&this.dispatchMapChange(i,t)),this},writable:!0,configurable:!0},delete:{value:function(i){return this.has(i)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(i,this.get(i)),Gs.call(this,i),this.dispatchesMapChanges&&this.dispatchMapChange(i,void 0),!0):!1}}},Object.addEach(mt.prototype,vr.prototype,!1),Ws=Object.create(mt.prototype,Hs));var Bs,yr,zs,Ns,js,Us,gn,Gs,Hs,Ws,ol=Fs().CollectionsSet,al=fn();mn=mt=f(function i(t,e,r,n){if(!(this instanceof i))return new i(t,e,r,n);e=e||Object.equals,r=r||Object.hash,n=n||Function.noop,this.contentEquals=e,this.contentHash=r,this.getDefault=n,this.store=new ol(void 0,f(function(o,a){return e(o.key,a.key)},"keysEqual"),f(function(o){return r(o.key)},"keyHash")),this.length=0,this.addEach(t)},"Map");mt.Map=mt;Object.addEach(mt.prototype,vr.prototype);Object.addEach(mt.prototype,al.prototype);Object.defineProperty(mt.prototype,"size",vr._sizePropertyDescriptor);mt.from=vr.from;mt.prototype.constructClone=function(i){return new this.constructor(i,this.contentEquals,this.contentHash,this.getDefault)};mt.prototype.log=function(i,t,e,r){t=t||this.logNode,this.store.log(i,function(n,s,o){t(n.value.value,s,o)},e,r)};mt.prototype.logNode=function(i,t){t(" key: "+i.key),t(" value: "+i.value)};_r?(br.exports=_r,_r.CollectionsMap=mn):br.exports=mn});var xr=bt((ku,Ei)=>{var $s=oi(),ll=Ei.exports.ObjectChangeDescriptor=f(function(t){return this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null,this},"ObjectChangeDescriptor");Object.defineProperties(ll.prototype,{name:{value:null,writable:!0},isActive:{value:!1,writable:!0},_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new this.willChangeListenersRecordConstructor(this.name))}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new this.changeListenersRecordConstructor(this.name))}},changeListenersRecordConstructor:{value:wr,writable:!0},willChangeListenersRecordConstructor:{value:ai,writable:!0}});var hl=Ei.exports.ListenerGhost=Object.create(null),Vs=new $s;Ei.exports.ChangeListenersRecord=wr;function wr(i){var t=Vs.get(i);return t||(t="handle",t+=i,t+="Change",Vs.set(i,t)),this._current=null,this._current=null,this.specificHandlerMethodName=t,this}f(wr,"ChangeListenersRecord");Object.defineProperties(wr.prototype,{_current:{value:null,writable:!0},current:{get:function(){return this._current},set:function(i){this._current=i}},ListenerGhost:{value:hl,writable:!0},ghostCount:{value:0,writable:!0},maxListenerGhostRatio:{value:.3,writable:!0},listenerGhostFilter:{value:f(function(t){return t!==this.ListenerGhost},"listenerGhostFilter")},removeCurrentGostListenersIfNeeded:{value:function(){return this._current&&this.ghostCount/this._current.length>this.maxListenerGhostRatio&&(this.ghostCount=0,this._current=this._current.filter(this.listenerGhostFilter,this)),this._current}},dispatchBeforeChange:{value:!1,writable:!0},genericHandlerMethodName:{value:"handlePropertyChange",writable:!0}});Ei.exports.WillChangeListenersRecord=ai;var Ks=new $s;function ai(i){var t=Ks.get(i);return t||(t="handle",t+=i,t+="WillChange",Ks.set(i,t)),this.specificHandlerMethodName=t,this}f(ai,"WillChangeListenersRecord");ai.prototype=new wr;ai.prototype.constructor=ai;ai.prototype.genericHandlerMethodName="handlePropertyWillChange"});var bn=bt((Eu,Js)=>{Js.exports=ut;function ut(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}f(ut,"PropertyChanges");Ee();var Ys=oi(),yn=si(),qs=xr(),cl=qs.ObjectChangeDescriptor,_n=qs.ListenerGhost;ut.debug=!0;var Ii=new yn,Xs=new Ys;ut.ObjectChangeDescriptor=function(){};ut.prototype.getOwnPropertyChangeDescriptor=function(i){var t=Ii.get(this),e;if(t||(t=Object.create(null),Ii.set(this,t)),(e=t[i])===void 0){var r=Xs.get(i);return r||(r=String(i),r=r&&r[0].toUpperCase()+r.slice(1),Xs.set(i,r)),t[i]=new cl(r)}else return e};ut.prototype.hasOwnPropertyChangeDescriptor=function(i){var t=Ii.get(this);return t?i?t[i]!==void 0:!0:!1};ut.prototype.addOwnPropertyChangeListener=function(i,t,e){this.makeObservable&&!this.isObservable&&this.makeObservable();var r=ut.getOwnPropertyChangeDescriptor(this,i),n=e?r.willChangeListeners:r.changeListeners;ut.makePropertyObservable(this,i),n._current?Array.isArray(n._current)?n._current.push(t):n._current=[n._current,t]:n._current=t;var s=this;return f(function(){ut.removeOwnPropertyChangeListener(s,i,t,e),s=null},"cancelOwnPropertyChangeListener")};ut.prototype.addBeforeOwnPropertyChangeListener=function(i,t){return ut.addOwnPropertyChangeListener(this,i,t,!0)};ut.prototype.removeOwnPropertyChangeListener=f(function i(t,e,r){var n=ut.getOwnPropertyChangeDescriptor(this,t),s;if(r?s=n._willChangeListeners:s=n._changeListeners,s&&s._current)if(s._current===e)s._current=null;else{var o=s._current.lastIndexOf(e);if(o===-1)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(t));n.isActive?(s.ghostCount=s.ghostCount+1,s._current[o]=i.ListenerGhost):s._current.spliceOne(o)}},"removeOwnPropertyChangeListener");ut.prototype.removeOwnPropertyChangeListener.ListenerGhost=_n;ut.prototype.removeBeforeOwnPropertyChangeListener=function(i,t){return ut.removeOwnPropertyChangeListener(this,i,t,!0)};ut.prototype.dispatchOwnPropertyChange=f(function i(t,e,r){var n=ut.getOwnPropertyChangeDescriptor(this,t),s;if(!n.isActive){n.isActive=!0,s=r?n._willChangeListeners:n._changeListeners;try{i.dispatchEach(s,t,e,this)}finally{n.isActive=!1}}},"dispatchOwnPropertyChange");ut.prototype.dispatchOwnPropertyChange.dispatchEach=Sr;function Sr(i,t,e,r){if(i&&i._current){var n,s,o,a,l,c=i.specificHandlerMethodName,u=i.genericHandlerMethodName,h=_n;if(Array.isArray(i._current)){for(n=i.removeCurrentGostListenersIfNeeded(),o=0,a=n.length;o<a;o++)if((l=n[o])!==h){if(s=l[c]||l[u]||l,!s.call)throw new Error("No event listener for "+i.specificHandlerName+" or "+i.genericHandlerName+" or call on "+s);s.call(l,e,t,r)}}else{if(l=i._current,s=l[c]||l[u]||l,!s.call)throw new Error("No event listener for "+i.specificHandlerName+" or "+i.genericHandlerName+" or call on "+s);s.call(l,e,t,r)}}}f(Sr,"dispatchEach");Sr.ListenerGhost=_n;ut.prototype.dispatchBeforeOwnPropertyChange=function(i,t){return ut.dispatchOwnPropertyChange(this,i,t,!0)};var Zs=new yn,Au=new yn,Wt={get:void 0,set:void 0,configurable:!0,enumerable:!1};ut.prototype.makePropertyObservable=function(i){var t=Zs.get(this);if(!(t&&t.get(i)!==void 0)){if(!t){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(i)+" observable on "+this+" because object is not extensible");t=new Ys,Zs.set(this,t)}var e,r=this;do{if(e=Object.getOwnPropertyDescriptor(r,i),e)break;r=Object.getPrototypeOf(r)}while(r);if(!e)e={value:void 0,enumerable:!0,writable:!0,configurable:!0};else if(!e.configurable||!e.writable&&!e.set)return;t.set(i,e),"value"in e?(Wt.get=f(function n(){return n.overriddenDescriptor.value},"dispatchingGetter"),Wt.set=f(function n(s){var o,a,l=n.overriddenDescriptor;if(s!==l.value){if(!(a=(o=n.descriptor).isActive)){o.isActive=!0;try{n.dispatchEach(o._willChangeListeners,n.key,l.value,this)}finally{}}if(l.value=s,!a)try{n.dispatchEach(o._changeListeners,n.key,s,this)}finally{o.isActive=!1}}},"dispatchingSetter"),Wt.set.dispatchEach=Sr,Wt.set.key=i,Wt.get.overriddenDescriptor=Wt.set.overriddenDescriptor=e,Wt.set.descriptor=Ii.get(this)[i],Wt.enumerable=e.enumerable,Wt.configurable=!0):(Wt.get=e.get,Wt.set=f(function n(){var s=n.overriddenGetter.call(this),o,a,l;if(arguments.length===1?n.overriddenSetter.call(this,arguments[0]):arguments.length===2?n.overriddenSetter.call(this,arguments[0],arguments[1]):n.overriddenSetter.apply(this,arguments),(l=n.overriddenGetter.call(this))!==s){if(o=n.descriptor,!(a=o.isActive)){o.isActive=!0;try{n.dispatchEach(o._willChangeListeners,i,s,this)}finally{}}if(!a)try{n.dispatchEach(o._changeListeners,i,l,this)}finally{o.isActive=!1}}},"dispatchingSetter"),Wt.enumerable=e.enumerable,Wt.configurable=!0,Wt.set.dispatchEach=Sr,Wt.set.overriddenSetter=e.set,Wt.set.overriddenGetter=e.get,Wt.set.descriptor=Ii.get(this)[i]),Object.defineProperty(this,i,Wt)}};ut.getOwnPropertyChangeDescriptor=function(i,t){return i.getOwnPropertyChangeDescriptor?i.getOwnPropertyChangeDescriptor(t):ut.prototype.getOwnPropertyChangeDescriptor.call(i,t)};ut.hasOwnPropertyChangeDescriptor=function(i,t){return i.hasOwnPropertyChangeDescriptor?i.hasOwnPropertyChangeDescriptor(t):ut.prototype.hasOwnPropertyChangeDescriptor.call(i,t)};ut.addOwnPropertyChangeListener=function(i,t,e,r){if(Object.isObject(i))return i.addOwnPropertyChangeListener?i.addOwnPropertyChangeListener(t,e,r):this.prototype.addOwnPropertyChangeListener.call(i,t,e,r)};ut.removeOwnPropertyChangeListener=function(i,t,e,r){if(Object.isObject(i))return i.removeOwnPropertyChangeListener?i.removeOwnPropertyChangeListener(t,e,r):ut.prototype.removeOwnPropertyChangeListener.call(i,t,e,r)};ut.dispatchOwnPropertyChange=function(i,t,e,r){if(Object.isObject(i))return i.dispatchOwnPropertyChange?i.dispatchOwnPropertyChange(t,e,r):ut.prototype.dispatchOwnPropertyChange.call(i,t,e,r)};ut.addBeforeOwnPropertyChangeListener=function(i,t,e){return ut.addOwnPropertyChangeListener(i,t,e,!0)};ut.removeBeforeOwnPropertyChangeListener=function(i,t,e){return ut.removeOwnPropertyChangeListener(i,t,e,!0)};ut.dispatchBeforeOwnPropertyChange=function(i,t,e){return ut.dispatchOwnPropertyChange(i,t,e,!0)};ut.makePropertyObservable=function(i,t){return i.makePropertyObservable?i.makePropertyObservable(t):ut.prototype.makePropertyObservable.call(i,t)}});var ao=bt((Pu,oo)=>{"use strict";var io=si(),wn=oi(),xn=xr(),ul=xn.ObjectChangeDescriptor,ro=xn.ChangeListenersRecord,no=xn.ListenerGhost,vn=new io;function Ne(i){this.name=i,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}f(Ne,"RangeChangeDescriptor");Ne.prototype=new ul;Ne.prototype.constructor=Ne;Ne.prototype.changeListenersRecordConstructor=Cr;Ne.prototype.willChangeListenersRecordConstructor=kr;Object.defineProperty(Ne.prototype,"active",{get:function(){return this._active||(this._active=this._current?this._current.slice():[])}});var Qs=new wn;function Cr(i){var t=Qs.get(i);return t||(t="handle",t+=i.slice(0,1).toUpperCase(),t+=i.slice(1),t+="RangeChange",Qs.set(i,t)),this.specificHandlerMethodName=t,this}f(Cr,"RangeChangeListenersRecord");Cr.prototype=new ro;Cr.prototype.constructor=Cr;var to=new wn;function kr(i){var t=to.get(i);return t||(t="handle",t+=i.slice(0,1).toUpperCase(),t+=i.slice(1),t+="RangeWillChange",to.set(i,t)),this.specificHandlerMethodName=t,this}f(kr,"RangeWillChangeListenersRecord");kr.prototype=new ro;kr.prototype.constructor=kr;oo.exports=we;function we(){throw new Error("Can't construct. RangeChanges is a mixin.")}f(we,"RangeChanges");we.prototype.getAllRangeChangeDescriptors=function(){return vn.has(this)||vn.set(this,new wn),vn.get(this)};we.prototype.getRangeChangeDescriptor=function(i){var t=this.getAllRangeChangeDescriptors();return i=i||"",t.has(i)||t.set(i,new Ne(i)),t.get(i)};var so=new io,fl=f(function(){return so.get(this)},"dispatchesRangeChangesGetter"),dl=f(function(i){return so.set(this,i)},"dispatchesRangeChangesSetter"),eo="dispatchesRangeChanges",pl={get:fl,set:dl,configurable:!0,enumerable:!1};we.prototype.addRangeChangeListener=f(function(t,e,r){!this.isObservable&&this.makeObservable&&this.makeObservable();var n=this.getRangeChangeDescriptor(e),s;r?s=n.willChangeListeners:s=n.changeListeners,s._current?Array.isArray(s._current)?s._current.push(t):s._current=[s._current,t]:s._current=t,Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),eo)===void 0&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),eo,pl),this.dispatchesRangeChanges=!0;var o=this;return f(function(){o&&(o.removeRangeChangeListener(t,e,r),o=null)},"cancelRangeChangeListener")},"addRangeChangeListener");we.prototype.removeRangeChangeListener=function(i,t,e){var r=this.getRangeChangeDescriptor(t),n;if(e?n=r._willChangeListeners:n=r._changeListeners,n._current)if(n._current===i)n._current=null;else{var s=n._current.lastIndexOf(i);if(s===-1)throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(t));r.isActive?(n.ghostCount=n.ghostCount+1,n._current[s]=no):n._current.spliceOne(s)}};we.prototype.dispatchRangeChange=function(i,t,e,r){var n=this.getAllRangeChangeDescriptors(),s,o=n.values(),a,l,c,u,h,_,g;for(n.dispatchBeforeChange=r;s=o.next().value;){if(s.isActive)return;if(a=r?s._willChangeListeners:s._changeListeners,a&&a._current)if(l=a.specificHandlerMethodName,Array.isArray(a._current)){if(a._current.length){s.isActive=!0;try{for(_=a.removeCurrentGostListenersIfNeeded(),g=no,c=0,u=_.length;c<u;c++)if((h=_[c])!==g)if(h[l])h[l](i,t,e,this,r);else if(h.call)h.call(this,i,t,e,this,r);else throw new Error("Handler "+h+" has no method "+l+" and is not callable")}finally{s.isActive=!1}}}else{s.isActive=!0;try{if(h=a._current,h[l])h[l](i,t,e,this,r);else if(h.call)h.call(this,i,t,e,this,r);else throw new Error("Handler "+h+" has no method "+l+" and is not callable")}finally{s.isActive=!1}}}};we.prototype.addBeforeRangeChangeListener=function(i,t){return this.addRangeChangeListener(i,t,!0)};we.prototype.removeBeforeRangeChangeListener=function(i,t){return this.removeRangeChangeListener(i,t,!0)};we.prototype.dispatchBeforeRangeChange=function(i,t,e){return this.dispatchRangeChange(i,t,e,!0)}});var co=bt((Du,ho)=>{"use strict";ho.exports=at;var Tu=Ee(),Sn=ve(),gl=cr(),ml=bn(),yl=ao(),lo=pn();function at(i,t,e,r){if(!(this instanceof at))return new at(i,t,e,r);this.contentEquals=t||Object.equals,this.contentCompare=e||Object.compare,this.getDefault=r||Function.noop,this.root=null,this.length=0,this.addEach(i)}f(at,"SortedSet");at.SortedSet=at;Object.addEach(at.prototype,Sn.prototype);Object.addEach(at.prototype,gl.prototype);Object.addEach(at.prototype,ml.prototype);Object.addEach(at.prototype,yl.prototype);Object.defineProperty(at.prototype,"size",Sn._sizePropertyDescriptor);at.from=Sn.from;at.prototype.isSorted=!0;at.prototype.constructClone=function(i){return new this.constructor(i,this.contentEquals,this.contentCompare,this.getDefault)};at.prototype.has=function(i,t){if(t)throw new Error("SortedSet#has does not support second argument: equals");return this.root?(this.splay(i),this.contentEquals(i,this.root.value)):!1};at.prototype.get=function(i,t){if(t)throw new Error("SortedSet#get does not support second argument: equals");return this.root&&(this.splay(i),this.contentEquals(i,this.root.value))?this.root.value:this.getDefault(i)};at.prototype.add=function(i){var t=new this.Node(i);if(this.root){if(this.splay(i),!this.contentEquals(i,this.root.value)){var e=this.contentCompare(i,this.root.value);if(e===0)throw new Error("SortedSet cannot contain incomparable but inequal values: "+i+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([i],[],this.root.index),e<0?(t.right=this.root,t.left=this.root.left,this.root.left=null,this.root.touch()):(t.left=this.root,t.right=this.root.right,this.root.right=null,this.root.touch()),t.touch(),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([i],[],this.root.index),!0}}else return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([i],[],0),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([i],[],0),!0;return!1};at.prototype.delete=function(i,t){if(t)throw new Error("SortedSet#delete does not support second argument: equals");if(this.root&&(this.splay(i),this.contentEquals(i,this.root.value))){var e=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[i],e),!this.root.left)this.root=this.root.right;else{var r=this.root.right;this.root=this.root.left,this.splay(i),this.root.right=r}return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[i],e),!0}return!1};at.prototype.indexOf=function(i,t){if(t)throw new Error("SortedSet#indexOf does not support second argument: startIndex");return this.root&&(this.splay(i),this.contentEquals(i,this.root.value))?this.root.index:-1};at.prototype.find=function(i,t,e){if(t)throw new Error("SortedSet#find does not support second argument: equals");if(e)throw new Error("SortedSet#find does not support third argument: index");if(this.root&&(this.splay(i),this.contentEquals(i,this.root.value)))return this.root};at.prototype.findGreatest=function(i){if(this.root){for(i=i||this.root;i.right;)i=i.right;return i}};at.prototype.findLeast=function(i){if(this.root){for(i=i||this.root;i.left;)i=i.left;return i}};at.prototype.findGreatestLessThanOrEqual=function(i){if(this.root)return this.splay(i),this.contentCompare(this.root.value,i)>0?this.root.getPrevious():this.root};at.prototype.findGreatestLessThan=function(i){if(this.root)return this.splay(i),this.contentCompare(this.root.value,i)>=0?this.root.getPrevious():this.root};at.prototype.findLeastGreaterThanOrEqual=function(i){if(this.root)return this.splay(i),this.contentCompare(this.root.value,i)>=0?this.root:this.root.getNext()};at.prototype.findLeastGreaterThan=function(i){if(this.root)return this.splay(i),this.contentCompare(this.root.value,i)<=0?this.root.getNext():this.root};at.prototype.pop=function(){if(this.root){var i=this.findGreatest();return this.delete(i.value),i.value}};at.prototype.shift=function(){if(this.root){var i=this.findLeast();return this.delete(i.value),i.value}};at.prototype.push=function(){this.addEach(arguments)};at.prototype.unshift=function(){this.addEach(arguments)};at.prototype.slice=function(i,t){var e;i=i||0,t=t||this.length,i<0&&(i+=this.length),t<0&&(t+=this.length);var r=[];if(this.root)for(this.splayIndex(i);this.root.index<t&&(r.push(this.root.value),!!this.root.right);)this.splay(this.root.getNext().value);return r};at.prototype.splice=function(i,t){return this.swap(i,t,Array.prototype.slice.call(arguments,2))};at.prototype.swap=function(i,t,e){if(i===void 0&&t===void 0)return[];i=i||0,i<0&&(i+=this.length),t===void 0&&(t=1/0);var r=[];if(this.root){this.splayIndex(i);for(var n=0;n<t;n++){r.push(this.root.value);var s=this.root.getNext();if(this.delete(this.root.value),!s)break;this.splay(s.value)}}return this.addEach(e),r};at.prototype.splay=function(i){var t,e,r,n,s,o;if(this.root){for(t=e=r=new this.Node,o=new this.Node,s=this.root;;){var a=this.contentCompare(i,s.value);if(a<0)if(s.left){if(this.contentCompare(i,s.left.value)<0&&(n=s.left,s.left=n.right,s.touch(),n.right=s,n.touch(),s=n,!s.left))break;n=new he,n.right=s,n.left=o.left,o.left=n,r.left=s,r.touch(),r=s,s=s.left}else break;else if(a>0)if(s.right){if(this.contentCompare(i,s.right.value)>0&&(n=s.right,s.right=n.left,s.touch(),n.left=s,n.touch(),s=n,!s.right))break;n=new he,n.left=s,n.right=o.right,o.right=n,e.right=s,e.touch(),e=s,s=s.right}else break;else break}for(e.right=s.left,e.touch(),r.left=s.right,r.touch(),s.left=t.right,s.right=t.left;o.left;)o.left.right.touch(),o.left=o.left.left;for(;o.right;)o.right.left.touch(),o.right=o.right.right;s.touch(),this.root=s}};at.prototype.splayIndex=function(i){if(this.root){for(var t=this.root,e=this.root.index;e!==i;)if(e>i&&t.left)t=t.left,e-=1+(t.right?t.right.length:0);else if(e<i&&t.right)t=t.right,e+=1+(t.left?t.left.length:0);else break;return this.splay(t.value),this.root.index===i}return!1};at.prototype.reduce=function(i,t,e){return this.root&&(t=this.root.reduce(i,t,0,e,this)),t};at.prototype.reduceRight=function(i,t,e){return this.root&&(t=this.root.reduceRight(i,t,this.length-1,e,this)),t};at.prototype.min=function(i){var t=this.findLeast(i);if(t)return t.value};at.prototype.max=function(i){var t=this.findGreatest(i);if(t)return t.value};at.prototype.one=function(){return this.min()};at.prototype.clear=function(){var i;this.dispatchesRangeChanges&&(i=this.toArray(),this.dispatchBeforeRangeChange([],i,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],i,0)};at.prototype.iterate=function(i,t){return new this.Iterator(this,i,t)};at.prototype.Iterator=Or;at.prototype.summary=function(){return this.root?this.root.summary():"()"};at.prototype.log=function(i,t,e,r){i=i||lo.unicodeRound,t=t||this.logNode,e||(e=console.log,r=console),e=e.bind(r),this.root&&this.root.log(i,t,e,e)};at.prototype.logNode=function(i,t,e){t(" "+i.value)};at.logCharsets=lo;at.prototype.Node=he;function he(i){this.value=i,this.left=null,this.right=null,this.length=1}f(he,"Node");he.prototype.reduce=function(i,t,e,r,n,s){if(s=s||0,this.left){var o=this.left.length;t=this.left.reduce(i,t,e,r,n,s+1),e+=o}return t=i.call(r,t,this.value,e,n,this,s),e+=1,this.right&&(t=this.right.reduce(i,t,e,r,n,s+1)),t};he.prototype.reduceRight=function(i,t,e,r,n,s){return s=s||0,this.right&&(t=this.right.reduceRight(i,t,e,r,n,s+1),e-=this.right.length),t=i.call(r,t,this.value,this.value,n,this,s),e-=1,this.left&&(t=this.left.reduceRight(i,t,e,r,n,s+1)),t};he.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0};he.prototype.checkIntegrity=function(){var i=1;if(i+=this.left?this.left.checkIntegrity():0,i+=this.right?this.right.checkIntegrity():0,this.length!==i)throw new Error("Integrity check failed: "+this.summary());return i};he.prototype.getNext=function(){var i=this;if(i.right){for(i=i.right;i.left;)i=i.left;return i}};he.prototype.getPrevious=function(){var i=this;if(i.left){for(i=i.left;i.right;)i=i.right;return i}};he.prototype.summary=function(){var i=this.value||"-";return i+=" <"+this.length,!this.left&&!this.right?"("+i+")":"("+i+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")"};he.prototype.log=function(i,t,e,r){var n=this,s;this.left&&this.right?s=i.intersection:this.left?s=i.branchUp:this.right?s=i.branchDown:s=i.through;var o;this.left&&this.left.log(i,t,f(function(u){o?r(i.strafe+" "+u):(o=!0,r(i.fromBelow+i.through+u))},"innerWrite"),f(function(u){r("  "+u)},"innerWriteAbove"));var a;t(this,f(function(u){a?e((n.right?i.strafe:" ")+u):(a=!0,e(s+u))},"innerWrite"),f(function(u){r((n.left?i.strafe:" ")+u)},"innerWriteAbove"));var l;this.right&&this.right.log(i,t,f(function(u){l?e("  "+u):(l=!0,e(i.fromAbove+i.through+u))},"innerWrite"),f(function(u){e(i.strafe+" "+u)},"innerWriteAbove"))};function Or(i,t,e){if(this.set=i,this.prev=null,this.end=e,t){var r=this.set.findLeastGreaterThanOrEqual(t);r&&(this.set.splay(r.value),this.prev=r.getPrevious())}}f(Or,"Iterator");Or.prototype.__iterationObject=null;Object.defineProperty(Or.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}});Or.prototype.next=function(){var i;return this.prev?i=this.set.findLeastGreaterThan(this.prev.value):i=this.set.findLeast(),i?this.end!==void 0&&this.set.contentCompare(i.value,this.end)>=0?(this._iterationObject.done=!0,this._iterationObject.value=void 0):(this.prev=i,this._iterationObject.value=i.value):(this._iterationObject.done=!0,this._iterationObject.value=void 0),this._iterationObject}});var Oo=bt(($u,ko)=>{"use strict";var wo=si(),En=oi(),In=xr(),xl=In.ObjectChangeDescriptor,xo=In.ChangeListenersRecord,So=In.ListenerGhost;ko.exports=Ce;function Ce(){throw new Error("Can't construct. MapChanges is a mixin.")}f(Ce,"MapChanges");var An=new wo;function ci(i){this.name=i,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}f(ci,"MapChangeDescriptor");ci.prototype=new xl;ci.prototype.constructor=ci;ci.prototype.changeListenersRecordConstructor=Pi;ci.prototype.willChangeListenersRecordConstructor=Mi;var _o=new En;function Pi(i){var t=_o.get(i);return t||(t="handle",t+=i.slice(0,1).toUpperCase(),t+=i.slice(1),t+="MapChange",_o.set(i,t)),this.specificHandlerMethodName=t,this}f(Pi,"MapChangeListenersRecord");Pi.prototype=new xo;Pi.prototype.constructor=Pi;Pi.prototype.genericHandlerMethodName="handleMapChange";var bo=new En;function Mi(i){var t=bo.get(i);return t||(t="handle",t+=i.slice(0,1).toUpperCase(),t+=i.slice(1),t+="MapWillChange",bo.set(i,t)),this.specificHandlerMethodName=t,this}f(Mi,"MapWillChangeListenersRecord");Mi.prototype=new xo;Mi.prototype.constructor=Mi;Mi.prototype.genericHandlerMethodName="handleMapWillChange";Ce.prototype.getAllMapChangeDescriptors=function(){return An.has(this)||An.set(this,new En),An.get(this)};Ce.prototype.getMapChangeDescriptor=function(i){var t=this.getAllMapChangeDescriptors();return i=i||"",t.has(i)||t.set(i,new ci(i)),t.get(i)};var Co=new wo,Sl=f(function(){return Co.get(this)},"dispatchesMapChangesGetter"),Cl=f(function(i){return Co.set(this,i)},"dispatchesMapChangesSetter"),vo="dispatchesMapChanges",kl={get:Sl,set:Cl,configurable:!0,enumerable:!1};Ce.prototype.addMapChangeListener=f(function(t,e,r){!this.isObservable&&this.makeObservable&&this.makeObservable();var n=this.getMapChangeDescriptor(e),s;r?s=n.willChangeListeners:s=n.changeListeners,s._current?Array.isArray(s._current)?s._current.push(t):s._current=[s._current,t]:s._current=t,Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),vo)===void 0&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),vo,kl),this.dispatchesMapChanges=!0;var o=this;return f(function(){o&&(o.removeMapChangeListener(t,e,r),o=null)},"cancelMapChangeListener")},"addMapChangeListener");Ce.prototype.removeMapChangeListener=function(i,t,e){var r=this.getMapChangeDescriptor(t),n;if(e?n=r.willChangeListeners:n=r.changeListeners,n._current)if(n._current===i)n._current=null;else{var s=n._current.lastIndexOf(i);if(s===-1)throw new Error("Can't remove map change listener: does not exist: token "+JSON.stringify(t));r.isActive?(n.ghostCount=n.ghostCount+1,n._current[s]=So):n._current.spliceOne(s)}};Ce.prototype.dispatchMapChange=function(i,t,e){var r=this.getAllMapChangeDescriptors(),n=So;r.forEach(function(s,o){if(!s.isActive){var a=e?s.willChangeListeners:s.changeListeners;if(a&&a._current){var l=a.specificHandlerMethodName;if(Array.isArray(a._current)){if(a._current.length){var c=a.removeCurrentGostListenersIfNeeded(),u,h,_;s.isActive=!0;try{for(u=0,h=c.length;u<h;u++)if((_=c[u])!==n)if(_[l])_[l](t,i,this);else if(_.call)_.call(_,t,i,this);else throw new Error("Handler "+_+" has no method "+l+" and is not callable")}finally{s.isActive=!1}}}else{s.isActive=!0;try{if(_=a._current,_[l])_[l](t,i,this);else if(_.call)_.call(_,t,i,this);else throw new Error("Handler "+_+" has no method "+l+" and is not callable")}finally{s.isActive=!1}}}}},this)};Ce.prototype.addBeforeMapChangeListener=function(i,t){return this.addMapChangeListener(i,t,!0)};Ce.prototype.removeBeforeMapChangeListener=function(i,t){return this.removeMapChangeListener(i,t,!0)};Ce.prototype.dispatchBeforeMapChange=function(i,t){return this.dispatchMapChange(i,t,!0)}});var Po=bt((Zu,Io)=>{"use strict";var Ti=oi(),Ao=bn(),Eo=Oo();Io.exports=Ti;global.Map===void 0||typeof global.Set.prototype.values!="function"?(Object.addEach(Ti.prototype,Ao.prototype),Object.addEach(Ti.prototype,Eo.prototype)):(Object.defineEach(Ti.prototype,Ao.prototype,!1,!0,!1,!0),Object.defineEach(Ti.prototype,Eo.prototype,!1,!0,!1,!0))});var Mo=bt((Pn,Mn)=>{(function(i,t){typeof Pn=="object"&&typeof Mn<"u"?Mn.exports=t():typeof define=="function"&&define.amd?define(t):(i=i||self).RBush=t()})(Pn,function(){"use strict";function i(d,y,w,C,P){f(function k(A,E,M,F,x){for(;F>M;){if(F-M>600){var D=F-M+1,m=E-M+1,z=Math.log(D),$=.5*Math.exp(2*z/3),N=.5*Math.sqrt(z*$*(D-$)/D)*(m-D/2<0?-1:1),J=Math.max(M,Math.floor(E-m*$/D+N)),W=Math.min(F,Math.floor(E+(D-m)*$/D+N));k(A,E,J,W,x)}var it=A[E],B=M,R=F;for(t(A,M,E),x(A[F],it)>0&&t(A,M,F);B<R;){for(t(A,B,R),B++,R--;x(A[B],it)<0;)B++;for(;x(A[R],it)>0;)R--}x(A[M],it)===0?t(A,M,R):t(A,++R,F),R<=E&&(M=R+1),E<=R&&(F=R-1)}},"t")(d,y,w||0,C||d.length-1,P||e)}f(i,"t");function t(d,y,w){var C=d[y];d[y]=d[w],d[w]=C}f(t,"i");function e(d,y){return d<y?-1:d>y?1:0}f(e,"n");var r=f(function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()},"r");function n(d,y,w){if(!w)return y.indexOf(d);for(var C=0;C<y.length;C++)if(w(d,y[C]))return C;return-1}f(n,"e");function s(d,y){o(d,0,d.children.length,y,d)}f(s,"a");function o(d,y,w,C,P){P||(P=v(null)),P.minX=1/0,P.minY=1/0,P.maxX=-1/0,P.maxY=-1/0;for(var k=y;k<w;k++){var A=d.children[k];a(P,d.leaf?C(A):A)}return P}f(o,"h");function a(d,y){return d.minX=Math.min(d.minX,y.minX),d.minY=Math.min(d.minY,y.minY),d.maxX=Math.max(d.maxX,y.maxX),d.maxY=Math.max(d.maxY,y.maxY),d}f(a,"o");function l(d,y){return d.minX-y.minX}f(l,"s");function c(d,y){return d.minY-y.minY}f(c,"l");function u(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}f(u,"f");function h(d){return d.maxX-d.minX+(d.maxY-d.minY)}f(h,"u");function _(d,y){return d.minX<=y.minX&&d.minY<=y.minY&&y.maxX<=d.maxX&&y.maxY<=d.maxY}f(_,"m");function g(d,y){return y.minX<=d.maxX&&y.minY<=d.maxY&&y.maxX>=d.minX&&y.maxY>=d.minY}f(g,"c");function v(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}f(v,"p");function b(d,y,w,C,P){for(var k=[y,w];k.length;)if(!((w=k.pop())-(y=k.pop())<=C)){var A=y+Math.ceil((w-y)/C/2)*C;i(d,A,y,w,P),k.push(y,A,A,w)}}return f(b,"d"),r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(d){var y=this.data,w=[];if(!g(d,y))return w;for(var C=this.toBBox,P=[];y;){for(var k=0;k<y.children.length;k++){var A=y.children[k],E=y.leaf?C(A):A;g(d,E)&&(y.leaf?w.push(A):_(d,E)?this._all(A,w):P.push(A))}y=P.pop()}return w},r.prototype.collides=function(d){var y=this.data;if(!g(d,y))return!1;for(var w=[];y;){for(var C=0;C<y.children.length;C++){var P=y.children[C],k=y.leaf?this.toBBox(P):P;if(g(d,k)){if(y.leaf||_(d,k))return!0;w.push(P)}}y=w.pop()}return!1},r.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var y=0;y<d.length;y++)this.insert(d[y]);return this}var w=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===w.height)this._splitRoot(this.data,w);else{if(this.data.height<w.height){var C=this.data;this.data=w,w=C}this._insert(w,this.data.height-w.height-1,!0)}else this.data=w;return this},r.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},r.prototype.clear=function(){return this.data=v([]),this},r.prototype.remove=function(d,y){if(!d)return this;for(var w,C,P,k=this.data,A=this.toBBox(d),E=[],M=[];k||E.length;){if(k||(k=E.pop(),C=E[E.length-1],w=M.pop(),P=!0),k.leaf){var F=n(d,k.children,y);if(F!==-1)return k.children.splice(F,1),E.push(k),this._condense(E),this}P||k.leaf||!_(k,A)?C?(w++,k=C.children[w],P=!1):k=null:(E.push(k),M.push(w),w=0,C=k,k=k.children[0])}return this},r.prototype.toBBox=function(d){return d},r.prototype.compareMinX=function(d,y){return d.minX-y.minX},r.prototype.compareMinY=function(d,y){return d.minY-y.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(d){return this.data=d,this},r.prototype._all=function(d,y){for(var w=[];d;)d.leaf?y.push.apply(y,d.children):w.push.apply(w,d.children),d=w.pop();return y},r.prototype._build=function(d,y,w,C){var P,k=w-y+1,A=this._maxEntries;if(k<=A)return s(P=v(d.slice(y,w+1)),this.toBBox),P;C||(C=Math.ceil(Math.log(k)/Math.log(A)),A=Math.ceil(k/Math.pow(A,C-1))),(P=v([])).leaf=!1,P.height=C;var E=Math.ceil(k/A),M=E*Math.ceil(Math.sqrt(A));b(d,y,w,M,this.compareMinX);for(var F=y;F<=w;F+=M){var x=Math.min(F+M-1,w);b(d,F,x,E,this.compareMinY);for(var D=F;D<=x;D+=E){var m=Math.min(D+E-1,x);P.children.push(this._build(d,D,m,C-1))}}return s(P,this.toBBox),P},r.prototype._chooseSubtree=function(d,y,w,C){for(;C.push(y),!y.leaf&&C.length-1!==w;){for(var P=1/0,k=1/0,A=void 0,E=0;E<y.children.length;E++){var M=y.children[E],F=u(M),x=(D=d,m=M,(Math.max(m.maxX,D.maxX)-Math.min(m.minX,D.minX))*(Math.max(m.maxY,D.maxY)-Math.min(m.minY,D.minY))-F);x<k?(k=x,P=F<P?F:P,A=M):x===k&&F<P&&(P=F,A=M)}y=A||y.children[0]}var D,m;return y},r.prototype._insert=function(d,y,w){var C=w?d:this.toBBox(d),P=[],k=this._chooseSubtree(C,this.data,y,P);for(k.children.push(d),a(k,C);y>=0&&P[y].children.length>this._maxEntries;)this._split(P,y),y--;this._adjustParentBBoxes(C,P,y)},r.prototype._split=function(d,y){var w=d[y],C=w.children.length,P=this._minEntries;this._chooseSplitAxis(w,P,C);var k=this._chooseSplitIndex(w,P,C),A=v(w.children.splice(k,w.children.length-k));A.height=w.height,A.leaf=w.leaf,s(w,this.toBBox),s(A,this.toBBox),y?d[y-1].children.push(A):this._splitRoot(w,A)},r.prototype._splitRoot=function(d,y){this.data=v([d,y]),this.data.height=d.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(d,y,w){for(var C,P,k,A,E,M,F,x=1/0,D=1/0,m=y;m<=w-y;m++){var z=o(d,0,m,this.toBBox),$=o(d,m,w,this.toBBox),N=(P=z,k=$,A=void 0,E=void 0,M=void 0,F=void 0,A=Math.max(P.minX,k.minX),E=Math.max(P.minY,k.minY),M=Math.min(P.maxX,k.maxX),F=Math.min(P.maxY,k.maxY),Math.max(0,M-A)*Math.max(0,F-E)),J=u(z)+u($);N<x?(x=N,C=m,D=J<D?J:D):N===x&&J<D&&(D=J,C=m)}return C||w-y},r.prototype._chooseSplitAxis=function(d,y,w){var C=d.leaf?this.compareMinX:l,P=d.leaf?this.compareMinY:c;this._allDistMargin(d,y,w,C)<this._allDistMargin(d,y,w,P)&&d.children.sort(C)},r.prototype._allDistMargin=function(d,y,w,C){d.children.sort(C);for(var P=this.toBBox,k=o(d,0,y,P),A=o(d,w-y,w,P),E=h(k)+h(A),M=y;M<w-y;M++){var F=d.children[M];a(k,d.leaf?P(F):F),E+=h(k)}for(var x=w-y-1;x>=y;x--){var D=d.children[x];a(A,d.leaf?P(D):D),E+=h(A)}return E},r.prototype._adjustParentBBoxes=function(d,y,w){for(var C=w;C>=0;C--)a(y[C],d)},r.prototype._condense=function(d){for(var y=d.length-1,w=void 0;y>=0;y--)d[y].children.length===0?y>0?(w=d[y-1].children).splice(w.indexOf(d[y]),1):this.clear():s(d[y],this.toBBox)},r})});var ga=bt((Uf,rh)=>{rh.exports=[{name:"Aircotec",long:"ACT",short:"I"},{name:"Cambridge Aero Instruments",long:"CAM",short:"C"},{name:"ClearNav Instruments",long:"CNI",short:null},{name:"Data Swan/DSX",long:"DSX",short:"D"},{name:"EW Avionics",long:"EWA",short:"E"},{name:"Filser",long:"FIL",short:"F"},{name:"Flarm",long:"FLA",short:"G"},{name:"Flytech",long:"FLY",short:null},{name:"Garrecht",long:"GCS",short:"A"},{name:"IMI Gliding Equipment",long:"IMI",short:"M"},{name:"Logstream",long:"LGS",short:null},{name:"LX Navigation",long:"LXN",short:"L"},{name:"LXNAV",long:"LXV",short:"V"},{name:"Naviter",long:"NAV",short:null},{name:"New Technologies",long:"NTE",short:"N"},{name:"Nielsen Kellerman",long:"NKL",short:"K"},{name:"Peschges",long:"PES",short:"P"},{name:"PressFinish Electronics",long:"PFE",short:null},{name:"Print Technik",long:"PRT",short:"R"},{name:"Scheffel",long:"SCH",short:"H"},{name:"Streamline Data Instruments",long:"SDI",short:"S"},{name:"Triadis Engineering GmbH",long:"TRI",short:"T"},{name:"Zander",long:"ZAN",short:"Z"},{name:"XCSoar",long:"XCS",short:null},{name:"LK8000",long:"XLK",short:null},{name:"GpsDump",long:"XGD",short:null},{name:"SeeYou Recorder",long:"XCM",short:null},{name:"Flyskyhy",long:"XFH",short:null},{name:"XCTrack",long:"XCT",short:null},{name:"Flymaster Live",long:"XFM",short:null},{name:"XCTracer",long:"XTR",short:null},{name:"SkyBean",long:"XSB",short:null},{name:"leGPSBip",long:"XSD",short:null},{name:"Logfly",long:"XLF",short:null},{name:"Loctome",long:"XLM",short:null}]});var ya=bt((Gf,ma)=>{var nh=ga();ma.exports=f(function(t){let e=t.length===1;t=t.toUpperCase();let r=nh.filter(n=>n[e?"short":"long"]===t);return r.length!==0?r[0].name:t},"lookup")});var wa=bt((Wf,va)=>{"use strict";var _a=ya(),sh=60*60*1e3,oh=24*60*60*1e3,ah=/^A(\w{3})(\w{3,}?)(?:FLIGHT:(\d+)|\:(.+))?$/,lh=/^HFDTE(?:DATE:)?(\d{2})(\d{2})(\d{2})(?:,?(\d{2}))?/,hh=/^H(\w)PLT(?:.{0,}?:(.*)|(.*))$/,ch=/^H(\w)CM2(?:.{0,}?:(.*)|(.*))$/,uh=/^H(\w)GTY(?:.{0,}?:(.*)|(.*))$/,fh=/^H(\w)GID(?:.{0,}?:(.*)|(.*))$/,dh=/^H(\w)CID(?:.{0,}?:(.*)|(.*))$/,ph=/^H(\w)CCL(?:.{0,}?:(.*)|(.*))$/,gh=/^H(\w)SIT(?:.{0,}?:(.*)|(.*))$/,mh=/^H(\w)FTY(?:.{0,}?:(.*)|(.*))$/,yh=/^H(\w)RFW(?:.{0,}?:(.*)|(.*))$/,_h=/^H(\w)RHW(?:.{0,}?:(.*)|(.*))$/,bh=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{3})([NS])(\d{3})(\d{2})(\d{3})([EW])([AV])(-\d{4}|\d{5})(-\d{4}|\d{5})/,vh=/^K(\d{2})(\d{2})(\d{2})/,wh=/^[IJ](\d{2})(?:\d{2}\d{2}[A-Z]{3})+/,xh=/^C(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{4})([-\d]{2})(.*)/,Sh=/^C(\d{2})(\d{2})(\d{3})([NS])(\d{3})(\d{2})(\d{3})([EW])(.*)/,ba=/^\d*$/,Ch=["F","O","P"],kh=function(){function i(t){t===void 0&&(t={}),this._result={numFlight:null,pilot:null,copilot:null,gliderType:null,registration:null,callsign:null,competitionClass:null,loggerType:null,firmwareVersion:null,hardwareVersion:null,task:null,fixes:[],dataRecords:[],security:null,errors:[]},this.fixExtensions=[],this.dataExtensions=[],this.lineNumber=0,this.prevTimestamp=null,this.options=t}return f(i,"IGCParser"),i.parse=function(t,e){e===void 0&&(e={});for(var r=new i(e),n=[],s=0,o=t.split(`
`);s<o.length;s++){var a=o[s];try{r.processLine(a.trim())}catch(c){if(e.lenient)n.push(c);else throw c}}var l=r.result;return l.errors=n,l},Object.defineProperty(i.prototype,"result",{get:function(){if(!this._result.loggerManufacturer)throw new Error("Missing A record");if(!this._result.date)throw new Error("Missing HFDTE record");return this._result},enumerable:!1,configurable:!0}),i.prototype.processLine=function(t){this.lineNumber+=1;var e=t[0];if(e==="B"){var r=this.parseBRecord(t);this.prevTimestamp=r.timestamp,this._result.fixes.push(r)}else if(e==="K"){var n=this.parseKRecord(t);this.prevTimestamp=n.timestamp,this._result.dataRecords.push(n)}else if(e==="H")this.processHeader(t);else if(e==="C")this.processTaskLine(t);else if(e==="A"){var s=this.parseARecord(t);this._result.loggerId=s.loggerId,this._result.loggerManufacturer=s.manufacturer,s.numFlight!==null&&(this._result.numFlight=s.numFlight)}else e==="I"?this.fixExtensions=this.parseIJRecord(t):e==="J"?this.dataExtensions=this.parseIJRecord(t):e==="G"&&(this._result.security=(this._result.security||"")+t.slice(1))},i.prototype.processHeader=function(t){var e=t.slice(2,5);if(e==="DTE"){var r=this.parseDateHeader(t);this._result.date=r.date,r.numFlight!==null&&(this._result.numFlight=r.numFlight)}else e==="PLT"?this._result.pilot=this.parsePilot(t):e==="CM2"?this._result.copilot=this.parseCopilot(t):e==="GTY"?this._result.gliderType=this.parseGliderType(t):e==="GID"?this._result.registration=this.parseRegistration(t):e==="CID"?this._result.callsign=this.parseCallsign(t):e==="CCL"?this._result.competitionClass=this.parseCompetitionClass(t):e==="SIT"?this._result.site=this.parseSite(t):e==="FTY"?this._result.loggerType=this.parseLoggerType(t):e==="RFW"?this._result.firmwareVersion=this.parseFirmwareVersion(t):e==="RHW"&&(this._result.hardwareVersion=this.parseHardwareVersion(t))},i.prototype.parseARecord=function(t){var e=t.match(ah);if(e){var r=_a(e[1]),n=e[2],s=e[3]?parseInt(e[3],10):null,o=e[4]||null;return{manufacturer:r,loggerId:n,numFlight:s,additionalData:o}}if(e=t.match(/^A(\w{3})(.+)?$/),e){var r=_a(e[1]),o=e[2]?e[2].trim():null;return{manufacturer:r,loggerId:null,numFlight:null,additionalData:o}}throw new Error("Invalid A record at line ".concat(this.lineNumber,": ").concat(t))},i.prototype.parseDateHeader=function(t){var e=t.match(lh);if(!e)throw new Error("Invalid DTE header at line ".concat(this.lineNumber,": ").concat(t));var r=e[3][0]==="8"||e[3][0]==="9",n="".concat(r?"19":"20").concat(e[3],"-").concat(e[2],"-").concat(e[1]),s=e[4]?parseInt(e[4],10):null;return{date:n,numFlight:s}},i.prototype.parseTextHeader=function(t,e,r,n){n===void 0&&(n=" ");var s=r.match(e);if(!s)throw new Error("Invalid ".concat(t," header at line ").concat(this.lineNumber,": ").concat(r));var o=s[1];if(Ch.indexOf(o)===-1&&!this.options.lenient)throw new Error("Invalid data source at line ".concat(this.lineNumber,": ").concat(o));return(s[2]||s[3]||"").replace(/_/g,n).trim()},i.prototype.parsePilot=function(t){return this.parseTextHeader("PLT",hh,t)},i.prototype.parseCopilot=function(t){return this.parseTextHeader("CM2",ch,t)},i.prototype.parseGliderType=function(t){return this.parseTextHeader("GTY",uh,t)},i.prototype.parseRegistration=function(t){return this.parseTextHeader("GID",fh,t,"-")},i.prototype.parseCallsign=function(t){return this.parseTextHeader("GTY",dh,t)},i.prototype.parseCompetitionClass=function(t){return this.parseTextHeader("GID",ph,t)},i.prototype.parseSite=function(t){return this.parseTextHeader("SIT",gh,t)},i.prototype.parseLoggerType=function(t){return this.parseTextHeader("FTY",mh,t)},i.prototype.parseFirmwareVersion=function(t){return this.parseTextHeader("RFW",yh,t)},i.prototype.parseHardwareVersion=function(t){return this.parseTextHeader("RHW",_h,t)},i.prototype.processTaskLine=function(t){this._result.task?this._result.task.points.push(this.parseTaskPoint(t)):this._result.task=this.parseTask(t)},i.prototype.parseTask=function(t){var e=t.match(xh);if(!e)throw new Error("Invalid task declaration at line ".concat(this.lineNumber,": ").concat(t));var r=e[3][0]==="8"||e[3][0]==="9",n="".concat(r?"19":"20").concat(e[3],"-").concat(e[2],"-").concat(e[1]),s="".concat(e[4],":").concat(e[5],":").concat(e[6]),o=Date.parse("".concat(n,"T").concat(s,"Z")),a=null;(e[7]!=="00"||e[8]!=="00"||e[9]!=="00")&&(r=e[9][0]==="8"||e[9][0]==="9",a="".concat(r?"19":"20").concat(e[9],"-").concat(e[8],"-").concat(e[7]));var l=e[10]!=="0000"?parseInt(e[10],10):null,c=parseInt(e[11],10),u=e[12]||null;return{declarationDate:n,declarationTime:s,declarationTimestamp:o,flightDate:a,taskNumber:l,numTurnpoints:c,comment:u,points:[]}},i.prototype.parseTaskPoint=function(t){var e=t.match(Sh);if(!e)throw new Error("Invalid task point declaration at line ".concat(this.lineNumber,": ").concat(t));var r=i.parseLatitude(e[1],e[2],e[3],e[4]),n=i.parseLongitude(e[5],e[6],e[7],e[8]),s=e[9]||null;return{latitude:r,longitude:n,name:s}},i.prototype.parseBRecord=function(t){if(!this._result.date)throw new Error("Missing HFDTE record before first B record");var e=t.match(bh);if(!e)throw new Error("Invalid B record at line ".concat(this.lineNumber,": ").concat(t));var r={};if(this.fixExtensions)for(var n=0,s=this.fixExtensions;n<s.length;n++){var o=s[n],a=o.code,l=o.start,c=o.length;r[a]=t.slice(l,l+c)}var u="".concat(e[1],":").concat(e[2],":").concat(e[3]),h=this.calcTimestamp(u),_=ba.test(r.LAD)?r.LAD:"",g=i.parseLatitude(e[4],e[5],e[6]+_,e[7]);_=ba.test(r.LOD)?r.LOD:"";var v=i.parseLongitude(e[8],e[9],e[10]+_,e[11]),b=e[12]==="A",d=e[13]==="00000"?null:parseInt(e[13],10),y=e[14]==="00000"?null:parseInt(e[14],10),w=null;if(r.ENL){var C=this.fixExtensions.filter(function(A){return A.code==="ENL"})[0].length,P=Math.pow(10,C);w=parseInt(r.ENL,10)/P}var k=r.FXA?parseInt(r.FXA,10):null;return{timestamp:h,time:u,latitude:g,longitude:v,valid:b,pressureAltitude:d,gpsAltitude:y,extensions:r,enl:w,fixAccuracy:k}},i.prototype.parseKRecord=function(t){if(!this._result.date)throw new Error("Missing HFDTE record before first K record");if(!this.dataExtensions)throw new Error("Missing J record before first K record");var e=t.match(vh);if(!e)throw new Error("Invalid K record at line ".concat(this.lineNumber,": ").concat(t));var r="".concat(e[1],":").concat(e[2],":").concat(e[3]),n=this.calcTimestamp(r),s={};if(this.dataExtensions)for(var o=0,a=this.dataExtensions;o<a.length;o++){var l=a[o],c=l.code,u=l.start,h=l.length;s[c]=t.slice(u,u+h)}return{timestamp:n,time:r,extensions:s}},i.prototype.parseIJRecord=function(t){var e=t.match(wh);if(!e)throw new Error("Invalid ".concat(t[0]," record at line ").concat(this.lineNumber,": ").concat(t));var r=parseInt(e[1],10);if(t.length<3+r*7)throw new Error("Invalid ".concat(t[0]," record at line ").concat(this.lineNumber,": ").concat(t));for(var n=new Array(r),s=0;s<r;s++){var o=3+s*7,a=parseInt(t.slice(o,o+2),10)-1,l=parseInt(t.slice(o+2,o+4),10)-1,c=l-a+1,u=t.slice(o+4,o+7);n[s]={start:a,length:c,code:u}}return n},i.parseLatitude=function(t,e,r,n){var s=parseInt(t,10)+parseFloat("".concat(e,".").concat(r))/60;return n==="S"?-s:s},i.parseLongitude=function(t,e,r,n){var s=parseInt(t,10)+parseFloat("".concat(e,".").concat(r))/60;return n==="W"?-s:s},i.prototype.calcTimestamp=function(t){for(var e=Date.parse("".concat(this._result.date,"T").concat(t,"Z"));this.prevTimestamp&&e<this.prevTimestamp-sh;)e+=oh;return e},i}();va.exports=kh});var ka=ii(qn());var _e=class{constructor(t,e,r){this.r=0;this.g=0;this.b=0;this.r=t,this.g=e,this.b=r}static fromByteValue(t,e,r,n){return new _e(t/255,e/255,r/255)}static validColor(t){let e=/^#?([\da-f]{6}(?:[\da-f]{2})?)$/;t=(t??"").trim().toLowerCase();let r=t.match(e);return!r||r.length<=1?null:r[1]}static fromRGBHexString(t){return t=_e.validColor(t),t?_e.fromByteValue(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)):null}toHexString(){return("0"+Math.trunc(255*this.b).toString(16)).substr(-2)+("0"+Math.trunc(255*this.g).toString(16)).substr(-2)+("0"+Math.trunc(255*this.r).toString(16)).substr(-2)}toRGBString(){return`rgb(${Math.trunc(255*this.r)},${Math.trunc(255*this.g)},${Math.trunc(255*this.b)})`}};f(_e,"RGB");var Ht=class extends _e{constructor(e,r,n,s){super(e,r,n);this.a=0;this.a=s}static fromByteValue(e,r,n,s){return new Ht(e/255,r/255,n/255,s/255)}static fromRGBAHexString(e){if(e=_e.validColor(e),!e)return null;let r=1;return e.length==8&&(r=parseInt(e.substring(6,8),16)),Ht.fromByteValue(parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16),r)}toHexString(){return("0"+Math.trunc(255*this.a).toString(16)).substr(-2)+super.toHexString()}toRGBAString(){return`rgba(${Math.trunc(255*this.r)},${Math.trunc(255*this.g)},${Math.trunc(255*this.b)},${Math.trunc(255*this.a)})`}};f(Ht,"RGBA");function Yr(i,t,e){return e<0?e++:1<e&&e--,e<1/6?i+6*(t-i)*e:e<.5?t:e<2/3?i+6*(t-i)*(2/3-e):i}f(Yr,"h_to_value");function er(i,t,e,r=1){if(t==0)return new Ht(1,1,1,r);let n;e<.5?n=e*(t+1):n=e+t-e*t;let s=2*e-n,o=Yr(s,n,i+1/3),a=Yr(s,n,i),l=Yr(s,n,i-1/3);return new Ht(o,a,l,r)}f(er,"hsl_to_rgba");function wi(i){let t;return i<0?er(2/3,1,.5):1<=i?er(0,1,.5):(t=2*(1-i)/3,er(t,1,.5))}f(wi,"default_gradient");function Jn(i){let t;return i<0?t=2/3:i<.5?t=(6-4*i)/9:i==.5?t=1/3:i<1?t=(4-4*i)/9:t=0,er(t,1,.5)}f(Jn,"bilinear_gradient");var Pt=class{constructor(t){if(t instanceof Pt)this.min=t.min,this.max=t.max;else if(t instanceof Array)if(t.length==2)this.min=t[0],this.max=t[1];else{this.min=t[0],this.max=t[0];for(let e=0;e<t.length;e++)t[e]<this.min&&(this.min=t[e]),t[e]>this.max&&(this.max=t[e])}else this.min=t,this.max=t}static createbounds(t){return t instanceof Array&&t.length==0||t==null?null:new Pt(t)}update(t){t instanceof Pt?(t.min<this.min&&(this.min=t.min),t.max>this.max&&(this.max=t.max)):(t<this.min&&(this.min=t),t>this.max&&(this.max=t))}tuple(){return[this.min,this.max]}};f(Pt,"Bounds");function Qn(i,t){for(let e in t)i.hasOwnProperty(e)?i[e]?.update(t[e]):i[e]=new Pt(t[e])}f(Qn,"bsupdate");function zt(i,t=0){return t=t?t*10:1,Math.round(i*t)/t}f(zt,"round");function qr(i,t){return new Date(i.getTime()+t*1e3)}f(qr,"add_seconds");var gt=class{static incr_douglas_peucker(t,e,r,n=Number.MAX_SAFE_INTEGER){let s=[0],o=[[0,t.length-1]],a=0,l=0,c=0,u=0,h=0,_=0,g=0,v=0,b=0;for(;a<o.length&&(l=o[a][0],c=o[a][1],a++,s.push(c),s.length!=n);){u=e[l]-e[c],h=t[c]-t[l],_=t[l]*e[c]-t[c]*e[l],g=l+1,v=Math.abs(u*t[g]+h*e[g]+_);for(let d=l+2;d<c;d++)b=Math.abs(u*t[d]+h*e[d]+_),b>v&&(v=b,g=d);if(v/=Math.sqrt(Math.pow(t[c]-t[l],2)+Math.pow(e[c]-e[l],2)),v>r){if(s.push(g),s.length==n)break;o.push([l,g]),o.push([g,c])}}return s.sort(function(d,y){return d-y})}static find_first_ge(t,e){let r=0,n=t.length;for(;r<n;){let s=Math.trunc((r+n)/2);e-t[s]<=0?n=s:r=s+1}return r==t.length?null:n}static runs(t){let e=[],r=0,n=0,s=t[0],o;for(n=0;n<t.length;n++)o=t[n],o!=s&&(e.push({start:r,stop:n}),r=n,s=o);return e.push({start:r,stop:n}),e}static runs_where(t){let e=[],r=0,n=0,s=t[0],o;for(n=0;n<t.length;n++)o=t[n],o!=s&&(s&&e.push({start:r,stop:n}),r=n,s=o);return s&&e.push({start:r,stop:n}),e}static condense(t,e,r){let n=[];if(t.length>0){let s=t[0],o=s.start,a=s.stop;for(let l=0;l<t.length;l++)s=t[l],e[s.start]-e[a]<r||(n.push({start:o,stop:a}),o=s.start),a=s.stop;n.push({start:o,stop:a})}return n}static hashcode(t){for(var e=0,r=0;e<t.length;e++)r=Math.imul(31,r)+t.charCodeAt(e)|0;return r}static datediffsecs(t,e){return t>e?(t.getTime()-e.getTime())/1e3:(t.getTime()+864e5-e.getTime())/1e3}static salient2(t,e){let r=[],n=f((s,o)=>{if(o-s<2)return;let a=0,l=s,c=o;if(t[s]<=t[o]){let u=s;for(let h=s+1;h<o;h++)t[h]>t[u]?u=h:t[u]-t[h]>a&&(l=u,c=h,a=t[u]-t[h])}if(t[s]>=t[o]){let u=s;for(let h=s+1;h<o;h++)t[h]<t[u]?u=h:t[h]-t[u]>a&&(l=u,c=h,a=t[h]-t[u])}if(a>=e[e.length-1]&&(l!=s||c!=o)){for(let u=0,h=e[0];u<e.length;u++,h=e[u])a<h||((!r.hasOwnProperty(l)||r[l]>u)&&(r[l]=u),(!r.hasOwnProperty(c)||r[c]>u)&&(r[c]=u));n(s,l),n(l,c),n(c,o)}},"helper");return t.length>0&&(r[0]=0,r[t.length-1]=0,n(0,t.length-1)),r}static seconds_to_date(t){return new Date(t*1e3)}static datetime_floor(t,e){return t=new Date(t.getTime()),e>=3600?(t.setMinutes(0),t.setSeconds(0),new Date(t.getTime()-36e5*(t.getHours()%Math.trunc(e/3600)))):e>=60?(t.setSeconds(0),new Date(t.getTime()-6e4*(t.getMinutes()%Math.trunc(e/60)))):e>=1?new Date(t.getTime()-1e3*(t.getSeconds()%Math.trunc(e))):t}static make_table(t,e=["#dddddd","#ffffff"]){let r='<table cellpadding="1" cellspacing="1">';return t.forEach((n,s)=>{r+=`<tr bgcolor="${e[s%2]}"><th align="right">${n[0]}</th><td>${n[1]}</td></tr>`}),r+="</table>",r}static capitalizeFirstLetter(t){return t=t??"",t.charAt(0).toUpperCase()+t.slice(1)}static roundToFloor(t,e){return Math.floor(t/e)*e}static roundToCeil(t,e){return Math.ceil(t/e)*e}};f(gt,"Utils");var ie=class{static id(t){let e="",r=this.characters.length,n=0;for(;n<t;)e+=this.characters.charAt(Math.floor(Math.random()*r)),n+=1;return e}static factorial(t){return t==0||t==1?1:this.factorials[t]>0?this.factorials[t]:this.factorials[t]=this.factorial(t-1)*t}static combinaisons(){let t=this.characters.length;return this.factorial(t+this.len-1)/(this.factorial(this.len)*this.factorial(t-1))}static reset(t){this.len=typeof t=="number"&&t>0?t:1,this.ids=[]}static makeid(t){typeof t=="number"&&t>0&&(this.len=t);let e;for(;this.combinaisons()<=this.ids.length;)this.len++;let r=0;do e=this.id(this.len),r++;while(r<this.maxretry&&this.ids.some(n=>n==e));return r==this.maxretry?(this.len++,this.makeid()):(this.ids.push(e),"_"+e)}};f(ie,"RandomIdGenerator"),ie.ids=[],ie.len=1,ie.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",ie.factorials=[1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,121645100408832e3,243290200817664e4,5109094217170944e4,11240007277776077e5,2585201673888498e7,6204484017332394e8,15511210043330986e9,40329146112660565e10,10888869450418352e12,30488834461171387e13,8841761993739702e15,26525285981219107e16,8222838654177922e18,2631308369336935e20,8683317618811886e21,29523279903960416e22,10333147966386145e24,37199332678990125e25,13763753091226346e27,5230226174666011e29,20397882081197444e30,8159152832478977e32,3345252661316381e34,140500611775288e37,6041526306337383e37,2658271574788449e39,11962222086548019e40,5502622159812089e42,25862324151116818e43,12413915592536073e45,6082818640342675e47,30414093201713376e48,15511187532873822e50,8065817517094388e52,42748832840600255e53,2308436973392414e56,12696403353658276e57,7109985878048635e59,40526919504877214e60,23505613312828785e62,13868311854568984e64,832098711274139e67,5075802138772248e68,3146997326038794e70,198260831540444e73,12688693218588417e73,8247650592082472e75,5443449390774431e77,3647111091818868e79,24800355424368305e80,1711224524281413e83,11978571669969892e84,8504785885678623e86,61234458376886085e87,44701154615126844e89,3307885441519386e92,248091408113954e95,18854947016660504e95,14518309202828587e97,11324281178206297e99,8946182130782976e101,7156945704626381e103,5797126020747368e105,4753643337012842e107,3945523969720659e109,3314240134565353e111,281710411438055e114,24227095383672734e114,2107757298379528e117,18548264225739844e118,1650795516090846e121,14857159644817615e122,1352001527678403e125,12438414054641308e126,11567725070816416e128,1087366156656743e131,1032997848823906e133,9916779348709496e134,9619275968248212e136,9426890448883248e138,9332621544394415e140,9332621544394415e142],ie.maxretry=20;var I;(ei=>{class i{constructor(K,G){this.name="";this.value="";this.name=K,this.value=G}}f(i,"Attribute");class t extends i{constructor(G,rt,ft=!1){ft===!0&&(G=null);super(G??"",rt);this.defaultns=!1;this.defaultns=G==null||ft}get uri(){return this.value}}f(t,"Namespace");let e=2;class r{constructor(K,G=null){this.namespaces={};this.name="";this.nsprefix=null;this.attributes=[];this.id="";this.name=K??this.constructor.name,this.nsprefix=G}get Id(){return(this.id??"").trim().length>0?this.id:(this.id=ie.makeid(5),this.add_attr("id",this.id),this.id)}get url(){return"#"+this.Id}add_ns(K,G){this.namespaces[K??"default"]=new t(K,G)}add_attr(K,G){this.attributes.push(new i(K,G))}serialize(K=!1,G=0){let rt=((this.nsprefix??"").trim().length>0?this.nsprefix+":":"")+this.name,ft=(K?" ".repeat(G*e):"")+"<"+rt;for(let lt in this.namespaces){let _t="";this.namespaces[lt].defaultns||(_t=":"+this.namespaces[lt].name),ft+=` xmlns${_t}="${this.namespaces[lt].uri}"`}for(let lt=0;lt<this.attributes.length;lt++)ft+=` ${this.attributes[lt].name}="${this.attributes[lt].value}"`;return ft+="></"+rt+">",ft}}f(r,"Element"),ei.Element=r;class n extends r{constructor(G){super();this.text=G??""}serialize(G,rt){return`<!--${this.text}-->`}}f(n,"Comment"),ei.Comment=n;class s extends r{constructor(G=[]){super();this.childs=[];this.childs=G}add(G){this.childs.push(G)}prefixes(){let G=[];if(this.childs&&this.childs.length>0)for(let rt=0;rt<this.childs.length;rt++)(this.childs[rt].nsprefix??"").trim().length>0&&!G.some(ft=>ft==this.childs[rt].nsprefix)&&G.push(this.childs[rt].nsprefix??""),this.childs[rt]instanceof s&&this.childs[rt].prefixes().forEach(ft=>{G.some(lt=>lt==ft)||G.push(ft)});return G}serialize(G=!1,rt=0){let ft=((this.nsprefix??"").trim().length>0?this.nsprefix+":":"")+this.name,lt=(G?" ".repeat(rt*e):"")+"<"+ft;for(let _t in this.namespaces){let le=":"+_t;this.namespaces[_t].defaultns&&(le=""),lt+=` xmlns${le}="${this.namespaces[_t].uri}"`}for(let _t=0;_t<this.attributes.length;_t++)lt+=` ${this.attributes[_t].name}="${this.attributes[_t].value}"`;if(this.childs.length==0)lt+="/>"+(G?`
`:"");else{lt+=">"+(G?`
`:"");for(let _t=0;_t<this.childs.length;_t++)lt+=this.childs[_t].serialize(G,rt+1)+(G?`
`:"");lt+=(G?" ".repeat(rt*e):"")+"</"+ft+">"}return lt}}f(s,"CompoundElement"),ei.CompoundElement=s;class o extends r{constructor(G,rt){super(G);this.content=rt??""}serialize(G=!1,rt=0){let ft=((this.nsprefix??"").trim().length>0?this.nsprefix+":":"")+this.name,lt=(G?" ".repeat(rt*e):"")+"<"+ft;for(let _t in this.namespaces){let le=":"+_t;this.namespaces[_t].defaultns&&(le=""),lt+=` xmlns${le}="${this.namespaces[_t].uri}"`}for(let _t=0;_t<this.attributes.length;_t++)lt+=` ${this.attributes[_t].name}="${this.attributes[_t].value}"`;return(this.content??"").trim().length==0?lt+="/>":lt+=">"+this.content+"</"+ft+">",lt}}f(o,"SimpleElement"),ei.SimpleElement=o;class a extends o{constructor(K,G){super(K,`<![CDATA[${G}]]>`)}}f(a,"CDATA"),ei.CDATA=a;class l extends o{}f(l,"altitude"),ei.altitude=l;class c extends o{constructor(K){super(void 0,K)}}f(c,"altitudeMode"),ei.altitudeMode=c;class u extends s{}f(u,"BalloonStyle"),ei.BalloonStyle=u;class h extends o{}f(h,"begin"),ei.begin=h;class _ extends o{}f(_,"bgColor"),ei.bgColor=_;class g extends s{constructor(K,G,rt){super([new o("altitude",K.ele.toString()),new o("heading",G.toString()),new o("latitude",K.lat_deg.toString()),new o("longitude",K.lon_deg.toString()),new o("tilt",rt.toString())])}}f(g,"Camera"),ei.Camera=g;class v extends o{constructor(K){K instanceof Ht?super(void 0,K.toHexString()):super(void 0,K)}}f(v,"color"),ei.color=v;class b extends o{constructor(K){Array.isArray(K)||(K=[K]),super(void 0,K.map(G=>`${G.lon_deg},${G.lat_deg},${G.ele}`).join(" "))}static circle(K,G,rt,ft=.1){let lt=Math.ceil(Math.PI/Math.acos((G-ft)/(G+ft))),_t=[];for(let le=0;le<lt+1;le++){let Qi=K.coord_at(-2*Math.PI*le/lt,G+ft);typeof rt=="number"&&(Qi.ele=rt),_t.push(Qi)}return _t}}f(b,"coordinates"),ei.coordinates=b;class d extends s{constructor(K,G){super([new o("value",G.toString())]),this.add_attr("name",K)}}f(d,"Data"),ei.Data=d;class y extends o{}f(y,"description"),ei.description=y;class w extends s{}f(w,"Document"),ei.Document=w;class C extends o{}f(C,"end"),ei.end=C;class P extends s{constructor(K){super([]);for(let G in K)this.add(new d(G,K[G]))}}f(P,"ExtendedData"),ei.ExtendedData=P;class k extends o{}f(k,"extrude"),ei.extrude=k;class A extends s{constructor(K,G=null,rt=null,ft=null,lt=null){rt=rt??[],ft!=null&&rt.unshift(new R(ft)),lt!=null&&rt.unshift(new H(lt)),K!=null&&rt.unshift(new o("name",K)),G!=null&&rt.push(new p(G)),super(rt)}}f(A,"Folder"),ei.Folder=A;class E extends o{}f(E,"heading"),ei.heading=E;class M extends o{}f(M,"href"),ei.href=M;class F extends s{static palette(K,G,rt=""){return new F([new o("href",`http://maps.google.com/mapfiles/kml/pal${K}/icon${G}${rt}.png`)])}}f(F,"Icon"),ei.Icon=F;class x extends s{}f(x,"IconStyle"),ei.IconStyle=x;class D extends s{constructor(K,G){super([G]),this.name="kml",this.add_ns(null,"http://earth.google.com/kml/"+K.toString()),this.add_ns("gx","http://www.google.com/kml/ext/"+K.toString())}serialize(K=!1,G=0){let rt=this.prefixes();for(let ft in this.namespaces)this.namespaces[ft].name&&(rt.includes(this.namespaces[ft].name)||delete this.namespaces[ft]);return`<?xml version="1.0" encoding="UTF-8"?>
`+super.serialize(K,G)}}f(D,"KML"),ei.KML=D;class m extends s{constructor(K,G,rt){super(),K&&this.add(new v(K)),rt&&this.add(new o("colorMode",rt)),G&&this.add(new ct(G.toString()))}}f(m,"LabelStyle"),ei.LabelStyle=m;class z extends o{}f(z,"latitude"),ei.latitude=z;class $ extends s{constructor(K,G,rt){super(),G&&this.add(new c(G)),typeof rt=="boolean"&&this.add(new U(rt)),this.add(new b(K))}}f($,"LineString"),ei.LineString=$;class N extends s{constructor(K,G){super([new o("color",K),new o("width",G.toString())])}}f(N,"LineStyle"),ei.LineStyle=N;class J extends s{constructor(K){super([new o("listItemType",K)])}}f(J,"ListStyle"),ei.ListStyle=J;class W extends o{}f(W,"listItemType"),ei.listItemType=W;class it extends o{}f(it,"longitude"),ei.longitude=it;class B extends s{}f(B,"MultiGeometry"),ei.MultiGeometry=B;class R extends o{constructor(K){super("open",K?"1":"0")}}f(R,"open"),ei.open=R;class nt extends o{constructor(K,G,rt,ft){super(),this.add_attr("x",K.toString()),this.add_attr("y",rt.toString()),this.add_attr("xunits",G),this.add_attr("yunits",ft)}}f(nt,"overlayXY"),ei.overlayXY=nt;class q extends s{constructor(K=null,G=null,rt=null,ft=null,lt=null,_t=null){rt=rt??[],lt!=null&&rt.unshift(new R(lt)),_t!=null&&rt.unshift(new H(_t)),G&&rt.unshift(G),ft&&rt.unshift(new p(ft)),K&&rt.unshift(new o("name",K)),super(rt)}}f(q,"Placemark"),ei.Placemark=q;class Y extends s{constructor(K,G){super(),G&&this.add(new c(G)),this.add(new b(K))}}f(Y,"Point"),ei.Point=Y;class At extends s{}f(At,"PolyStyle"),ei.PolyStyle=At;class Dt extends o{}f(Dt,"roll"),ei.roll=Dt;class ct extends o{constructor(K){super(void 0,K)}}f(ct,"scale"),ei.scale=ct;class yt extends s{}f(yt,"ScreenOverlay"),ei.ScreenOverlay=yt;class Bt extends nt{}f(Bt,"screenXY"),ei.screenXY=Bt;class Et extends nt{}f(Et,"size"),ei.size=Et;class oe extends o{constructor(K){super(void 0,K)}}f(oe,"Snippet"),ei.Snippet=oe;class se extends s{}f(se,"Style"),ei.Style=se;class p extends o{constructor(K){super(void 0,K)}}f(p,"styleUrl"),ei.styleUrl=p;class U extends o{constructor(K){super(void 0,K?"1":"0")}}f(U,"tessellate"),ei.tessellate=U;class j extends o{}f(j,"text"),ei.text=j;class O extends o{}f(O,"tilt"),ei.tilt=O;class S extends s{constructor(K,G){super(),K!=null&&this.add(new o("begin",K.toISOString())),G!=null&&this.add(new o("end",G.toISOString()))}}f(S,"TimeSpan"),ei.TimeSpan=S;class T extends o{}f(T,"value"),ei.value=T;class H extends o{constructor(K){super(void 0,K?"1":"0")}}f(H,"visibility"),ei.visibility=H;class V extends o{}f(V,"when"),ei.when=V;class L extends o{}f(L,"width"),ei.width=L;class X extends s{constructor(G=null,rt=0){super();this.nsprefix="gx",G!=null&&this.add(new o("name",G)),this.playlist=new tt(rt),this.add(this.playlist)}add_update(G,rt=.02){this.playlist.add_update(G,rt)}}f(X,"Tour"),ei.Tour=X;class tt extends s{constructor(K=0){super(),this.nsprefix="gx",K>0&&this.add(new Z(K))}add_update(K,G=.02){this.add(new Ct(K)),this.add(new Z(G))}}f(tt,"Playlist"),ei.Playlist=tt;class Z extends s{constructor(K){super([new st(K)]),this.nsprefix="gx"}}f(Z,"Wait"),ei.Wait=Z;class st extends o{constructor(K){super(void 0,K.toString()),this.nsprefix="gx"}}f(st,"duration"),ei.duration=st;class Ct extends s{constructor(K){super([new pt(K)]),this.nsprefix="gx"}}f(Ct,"AnimatedUpdate"),ei.AnimatedUpdate=Ct;class pt extends s{constructor(K){super([new Jt(K)])}}f(pt,"Update"),ei.Update=pt;class Jt extends s{constructor(K){let G=new q(null,null,null,null,null,!0);G.add_attr("targetId",K),super([G])}}f(Jt,"Change"),ei.Change=Jt})(I||={});var is=ii(es());var ir=class{constructor(t,e){this.path=t,this.content=e}};f(ir,"KMZResource");var xt=class{constructor(t){this.elements=[];this.files=[];t&&(this.elements=t),this.roots=[]}add_roots(t){return t.forEach(e=>this.roots.push(e)),this}add_root(t){return this.roots.push(t),this}add_file(t,e){return this.files.push(new ir(t,e)),this}add_files(t){return t.forEach(e=>this.files.push(e)),this}add(t){return t.forEach(e=>{this.elements[0]instanceof I.CompoundElement&&(e instanceof xt?(e.elements.forEach(r=>this.elements[0].add(r)),this.add_roots(e.roots),this.add_files(e.files)):this.elements[0].add(e))}),this}add_siblings(t){return t.forEach(e=>{e instanceof xt?(e.elements.forEach(r=>this.elements.push(r)),this.add_roots(e.roots),this.add_files(e.files)):this.elements.push(e)}),this}get_data(t,e=!1,r=!1){return new Promise(n=>{let s=new is.default,o=new I.Document;this.roots.forEach(l=>o.add(l)),this.elements.forEach(l=>o.add(l));let a=new I.KML(t,o);if(e||r){let l=a.serialize(!0);if(r&&console.log(l),e){n(l);return}}s.file("doc.kml",a.serialize());for(let l=0;l<this.files.length;l++)s.file(this.files[l].path,this.files[l].content,{base64:typeof this.files[l].content=="string"});s.generateAsync({type:"arraybuffer",compression:"DEFLATE"}).then(l=>n(l))})}};f(xt,"KMZ");var de=class{constructor(t,e,r=1,n=wi,s=16){this.grid_step=0;if(this.range=t,this.title=e,this.cbgradient=n,this.step=r,r>0){let o=0,a=r;for(;;){o=++o%3==0?0:o,o==1?a=r:o==2?a=2*r:(a=5*r,r*=10);let l=Math.trunc(this.range.min/a),c=Math.trunc(this.range.max/a);if(this.range.min<a*l&&l--,this.range.max>a*c&&c++,c-l<=s){this.grid_step=100/(c-l),this.range=new Pt([a*l,a*c]),this.step=a;break}}}}normalize(t){return t<this.range.min?0:this.range.max<=t?1:(t-this.range.min)/(this.range.max-this.range.min)}discretize(t,e=32){if(t<this.range.min)return 0;if(this.range.max<=t)return e-1;let r=Math.trunc(e*this.normalize(t));return r>e-1?e-1:r}color(t){return this.cbgradient(this.normalize(t))}colors(t=32){return Array.from(Array(t)).map((e,r)=>this.cbgradient(r/(t-1)))}};f(de,"Scale");var ri=class extends de{normalize(t){return t<0?t<this.range.min?0:.5-.5*t/this.range.min:t==0?.5:this.range.max<=t?1:.5+.5*t/this.range.max}};f(ri,"ZeroCenteredScale");var ze=class extends de{constructor(e,r,n=1,s=wi,o=16,a=0){super(e,r,0,s,o);this.labels=[];this.positions=[];this.step=n;let l=gt.seconds_to_date(e.min),c=gt.seconds_to_date(e.max);if(n>0){let h=[1,5,15,30,60,300,900,1800,3600,10800,21600,43200].filter(_=>_>=n);for(let _=0,g=h[0];_<h.length;_++,g=h[_])if(l=gt.datetime_floor(gt.seconds_to_date(e.min),g),c=gt.datetime_floor(gt.seconds_to_date(e.max),g),c<e.max&&(c=new Date(c.getTime()+g*1e3)),(c.getTime()-l.getTime())/(g*1e3)<o){this.range=new Pt([l.getTime()/1e3,c.getTime()/1e3]),this.grid_step=100*g/((c.getTime()-l.getTime())/1e3),this.step=g;break}}let u=new Date(new Date(l.getFullYear(),l.getMonth(),l.getDate(),l.getHours(),0).getTime()+this.step*1e3);for(;u<c;){let h=new Date(u.getTime()+a*1e3);this.labels.push(h.toTimeString().split(" ")[0].substring(0,5)),this.positions.push(Math.round(100*gt.datediffsecs(u,l)/gt.datediffsecs(c,l))%3600),u=new Date(u.getTime()+this.step*1e3)}}};f(ze,"TimeScale");var Ra=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],kt=class{constructor(t,e,r,n){this.lat=t,this.lon=e,this.ele=r??0,this.dt=n??new Date}static deg(t,e,r,n){return new kt(Math.PI*t/180,Math.PI*e/180,r,n)}get lat_deg(){return 180*this.lat/Math.PI}get lon_deg(){return 180*this.lon/Math.PI}static todegree(t){return 180*t/Math.PI}static rad_to_cardinal(t){for(;t<0;)t+=2*Math.PI;return Ra[Math.trunc(8*t/Math.PI+.5)%16]}halfway_to(t){let e=Math.cos(t.lat)*Math.cos(t.lon-this.lon),r=Math.cos(t.lat)*Math.sin(t.lon-this.lon),n=Math.cos(this.lat)+e,s=Math.atan2(Math.sin(this.lat)+Math.sin(t.lat),Math.sqrt(n*n+r*r)),o=this.lon+Math.atan2(r,n),a=(this.ele+t.ele)/2;return new kt(s,o,a)}initial_bearing_to(t){let e=Math.sin(t.lon-this.lon)*Math.cos(t.lat),r=Math.cos(this.lat)*Math.sin(t.lat)-Math.sin(this.lat)*Math.cos(t.lat)*Math.cos(t.lon-this.lon);return Math.atan2(e,r)}initial_bearing_to_deg(t){return this.initial_bearing_to(new kt(kt.todegree(t.lat),kt.todegree(t.lon)))}distance_to(t){let e=Math.sin(this.lat)*Math.sin(t.lat)+Math.cos(this.lat)*Math.cos(t.lat)*Math.cos(this.lon-t.lon);return e<1?6371e3*Math.acos(e):0}static haversineDistance(t,e){Array.isArray(t)&&(t=new kt(t[1],t[0])),Array.isArray(e)&&(e=new kt(e[1],e[0]));let r=(e.lat-t.lat)*Math.PI/180,n=(e.lon-t.lon)*Math.PI/180,s=Math.cos(t.lat*Math.PI/180)*Math.cos(e.lat*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2)+Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}interpolate(t,e){let r=Math.sin(this.lat)*Math.sin(t.lat)+Math.cos(this.lat)*Math.cos(t.lat)*Math.cos(t.lon-this.lon);r=r<1?e*Math.acos(r):0;let n=Math.sin(t.lon-this.lon)*Math.cos(t.lat),s=Math.cos(this.lat)*Math.sin(t.lat)-Math.sin(this.lat)*Math.cos(t.lat)*Math.cos(t.lon-this.lon),o=Math.atan2(n,s),a=Math.asin(Math.sin(this.lat)*Math.cos(r)+Math.cos(this.lat)*Math.sin(r)*Math.cos(o)),l=this.lon+Math.atan2(Math.sin(o)*Math.sin(r)*Math.cos(this.lat),Math.cos(r)-Math.sin(this.lat)*Math.sin(a)),c=(1-e)*this.ele+e*t.ele;return new kt(a,l,c)}coord_at(t,e){let r=Math.asin(Math.sin(this.lat)*Math.cos(e/6371e3)+Math.cos(this.lat)*Math.sin(e/6371e3)*Math.cos(t)),n=this.lon+Math.atan2(Math.sin(t)*Math.sin(e/6371e3)*Math.cos(this.lat),Math.cos(e/6371e3)-Math.sin(this.lat)*Math.sin(this.lat)),s=this.ele;return new kt(r,n,s)}};f(kt,"Coord");var La="->",Fa="inf";var Ba="n/a",be=class{constructor(t){this.photos=[];this.url="";this.time_positions=[];this.pcount=0;this.id="";this.endconv=null;this.track=t,this.root=new xt([new I.Folder(this.track.filename,null,[],!0)]),t.elevation_data?this.altitude_mode="absolute":this.altitude_mode="clampToGround";let e=Ht.fromRGBAHexString(t.options.solid_color);e?e.a=255/255:e=new Ht(0,0,0,255/255),this.color=e.toHexString(),this.width=2,this.pilot_name=t.pilot_name,this.glider_type=t.glider_type,this.glider_id=t.glider_id}get Id(){return(this.id??"").trim().length>0?this.id:(this.id=ie.makeid(5),this.id)}endwork(){this.pcount--,this.pcount<=0&&this.endconv&&this.endconv(this.root)}make_description(t){let e=[];this.pilot_name&&e.push(["Pilot name",this.pilot_name]),this.glider_type&&e.push(["Glider type",this.glider_type]),this.glider_id&&e.push(["Glider ID",this.glider_id]);let r=new Date((this.track.bounds.time?.min+t.tz_offset)*1e3);e.push(["Take-off time",r.toISOString().substring(11,19)]);let n=new Date((this.track.bounds.time?.max+t.tz_offset)*1e3);e.push(["Landing time",n.toISOString().substring(11,19)]);let s=this.track.bounds.time?.max-this.track.bounds.time?.min,o=Math.trunc(s/3600),a=s%3600,l=Math.trunc(a/60),c=Math.trunc(a%60);if(e.push(["Duration",`${o}h ${("0"+l.toString()).substr(-2)}m ${("0"+c.toString()).substr(-2)}s`]),this.track.elevation_data&&(e.push(["Take-off altitude",this.track.coords[0].ele+"m"]),e.push(["Maximum altitude",this.track.bounds.ele?.max+"m"]),e.push(["Minimum altitude",this.track.bounds.ele?.min+"m"]),e.push(["Landing altitude",this.track.coords[this.track.coords.length-1].ele+"m"]),e.push(["Total altitude gain",this.track.total_dz_positive+"m"]),e.push(["Maximum altitude gain",this.track.max_dz_positive+"m"]),e.push(["Maximum climb",Math.round(this.track.bounds.climb?.max*10)/10+"m/s"]),e.push(["Maximum sink",Math.round(this.track.bounds.climb?.min*10)/10+"m/s"])),e.push(["Maximum speed",Math.round(this.track.bounds.speed?.max*10)/10+"km/h"]),this.url){let h=new URL(this.url);e.push(["Flight URL",`<a href="${this.url}">${h.hostname}</a>`])}let u=gt.make_table(e);return new xt([new I.CDATA("description",u)])}make_snippet(t){let e=new Date((this.track.bounds.time?.min+t.tz_offset)*1e3),r=[this.pilot_name,e.toISOString().substring(0,10)];return new xt([new I.Snippet(r.join(", "))])}static make_task_folder(t,e){let r=e.name??"Task",n=[],s=null,o=0,a=-1,l=gt.runs(e.tps.map(b=>b.name));for(let b=0,d=l[0];b<l.length;b++,d=l[b]){if(!s){s=e.tps[d.start];continue}let y=e.tps[d.stop-1],w=s.coord.distance_to(y.coord),C=`${s.name} ${La} ${y.name}`,P=`${zt(w/1e3,1)}km`;n.push([C,P]),o+=w,a++,s=y}n.push(["Total",`${zt(o/1e3,1)}km`]);let c=gt.make_table(n),u=`${zt(o/1e3,1)}km via ${a} turnpoints`,h=t.stock.check_hide_children_style.url,_=new I.Folder(r,h,[new I.CDATA("description",c),new I.Snippet(u)]),g=new I.Style([new I.LineStyle("cc00F5FF","2")]);_.add(g),h=t.stock.xc_style.url;let v=[];for(let b=0,d=e.tps[0];b<e.tps.length;b++,d=e.tps[b]){let y=d.name;if(v.indexOf(y)>=0)continue;v.push(y);let w=new I.Point(d.coord);_.add(new I.Placemark(d.name,w,[],h))}v=[];for(let b=0,d=e.tps[0];b<e.tps.length;b++,d=e.tps[b]){if(d.radius==0)continue;let y=d.name+d.radius.toString();if(v.indexOf(y)>=0)continue;v.push(y);let w=I.coordinates.circle(d.coord,d.radius),C=new I.LineString(w,null,!0);_.add(new I.Placemark(null,C,[],h))}s=null,l=gt.runs(e.tps.map(b=>b.name));for(let b=0,d=l[0];b<l.length;b++,d=l[b]){if(!s){s=e.tps[d.start];continue}let y=e.tps[d.stop-1],w=s.coord.coord_at(s.coord.initial_bearing_to(y.coord),s.radius),C=y.coord.initial_bearing_to(s.coord),P=y.coord.coord_at(C,y.radius),k=new I.LineString([w,P],null,!0),A=[P.coord_at(C-Math.PI/12,400),P,P.coord_at(C+Math.PI/12,400)],E=new I.LineString(A,null,!0),M=new I.MultiGeometry([k,E]);_.add(new I.Placemark(null,M,[],g.url)),s=y}return new xt([_])}make_solid_track(t,e,r,n,s=null,o=!1){let a=new I.LineString(this.track.coords,r);o&&a.add(new I.SimpleElement("extrude","1"));let l=new I.Placemark(null,a,[e]),c=t.stock.check_hide_children_style.url,u=new I.Folder(n,c,[l]);return s!=null&&u.add(new I.visibility(s)),new xt([u])}make_colored_track(t,e,r,n,s,o=!0){if(!r)return new xt;let a=new I.Folder("Colored by "+r.title,t.stock.check_hide_children_style.url,[],null,s),l=r.colors().map(_=>new I.Style([new I.LineStyle(_.toHexString(),this.width.toString())]))??[],c=e.map(_=>r.discretize(_)),u=gt.runs(c);for(let _=0,g=u[0];_<u.length;_++,g=u[_]){let v=this.track.coords.slice(g.start,g.stop+1),b=new I.LineString(v,n),d=l[c[g.start]].url,y=new I.Placemark(null,b,[],d);a.add(y)}let h="images/"+r.title.replaceAll(" ","_")+"_scale.png";if(o&&r&&t.canvas){t.files.indexOf(h)<0&&(t.files.push(h),this.pcount++,this.make_scale_chart(t,r).then(y=>{this.root.add_file(h,y),this.endwork()}).catch(y=>{console.log(y),this.endwork()}));let _=new I.Icon([new I.CDATA("href",h)]),g=new I.overlayXY(0,"fraction",1,"fraction"),v=new I.screenXY(0,"fraction",1,"fraction"),b=new I.size(0,"fraction",0,"fraction"),d=new I.ScreenOverlay([_,g,v,b]);a.add(d)}return new xt([a]).add_roots(l)}make_scale_chart(t,e){return new Promise((r,n)=>{if(!t.canvas)return n("no canvas");t.canvas.create_canvas(50,200).then(s=>{let o=s.getContext("2d");if(!o||!e)return n("no context");o.clearRect(0,0,s.width,s.height),o.fillStyle="#ffffff00",o.fillRect(0,0,s.width,s.height);let a=Math.max(Math.round(e.range.max).toString().length,Math.round(e.range.min).toString().length)*9+2;o.fillStyle="#ffffffcc",o.fillRect(0,0,s.width-a,s.height);for(let c=0;c<32;c++){let u=e.color((c*(e.range.max-e.range.min)+.5)/32+e.range.min);o.fillStyle=u.toRGBString(),o.fillRect(0,(31-c)*(s.height/32),s.width-a,s.height/32)}o.strokeStyle="#ff9f9f9f",o.fillStyle="#fff",o.font=`12pt ${t.canvas?.fontname}`;let l=s.height/25;for(let c=0;c<l;c++){let u=c*(s.height/l),h=Math.round((l-c)*(e.range.max-e.range.min)/l+e.range.min).toString();o.beginPath(),o.moveTo(0,u),o.lineTo(s.width-a+1,u),o.stroke(),o.fillText(h,s.width-a+1,u)}t.canvas.get_base64(s).then(c=>r(c))})})}make_graph_chart(t,e,r){return new Promise((n,s)=>{if(!t.canvas)return s("no canvas");t.canvas.create_canvas(t.graph_width,t.graph_height).then(o=>{let a=o.getContext("2d"),l=console.log;console.log=function(){};let c=t.scales.time;if(!a||!(c instanceof ze)||!r)return s("no context");a.clearRect(0,0,o.width,o.height),a.fillStyle="#ffffff00",a.fillRect(0,0,o.width,o.height),a.fillStyle="#ffffffcc";let u=35,h=14,_=t.graph_width-u,g=t.graph_height-h;a.fillRect(u,0,_,g),a.fillStyle="#ffffffff",a.font=`12pt ${t.canvas?.fontname} bold`;let v=_/c.labels.length;for(let M=0;M<c.labels.length;M++)a.fillText(c.labels[M],u+M*v,o.height-1);for(a.textAlign="right",v=50;(r.range.max-r.range.min)/v>10;)v+=50;let b=gt.roundToFloor(r.range.min,v),d=gt.roundToCeil(r.range.max,v),y=g/(d-b);for(let M=b;M<=d;M+=v)a.fillText(M.toString(),u-1,g-(M-b)*y);a.textAlign="left";let w=e.map(M=>g*(M-r.range.min)/(r.range.max-r.range.min)),C=gt.incr_douglas_peucker(this.time_positions,w,1,450),P=new Array(2);P[0]=[],P[1]=[];for(let M=0;M<C.length;M++)P[0].push(this.track.t[C[M]]),P[1].push(w[C[M]]);let k=_/(c.range.max-c.range.min);a.strokeStyle="#FF9500",a.lineWidth=2;let A=u+k*(P[0][0]-c.range.min),E=g-P[1][0];a.beginPath(),a.moveTo(A,E);for(let M=1;M<C.length;M++)A=u+k*(P[0][M]-c.range.min),E=g-P[1][M],a.lineTo(A,E);a.stroke(),console.log=l,t.canvas.get_base64(o).then(M=>n(M))})})}make_track_folder(t){let e=t.stock.radio_folder_style.url,r=new xt([new I.Folder("Track",e,[],!0)]);r.add([t.stock.invisible_none_folder]);let n;this.track.elevation_data&&(n=t.default_track=="climb",r.add([this.make_colored_track(t,this.track.climb,t.scales.climb,"absolute",n)]),n=t.default_track=="altitude",r.add([this.make_colored_track(t,this.track.ele,t.scales.altitude,"absolute",n)]),n=t.default_track=="tec",r.add([this.make_colored_track(t,this.track.tec,t.scales.tec,"absolute",n)])),n=t.default_track=="speed",r.add([this.make_colored_track(t,this.track.speed,t.scales.speed,this.altitude_mode,n)]),n=t.default_track=="time",r.add([this.make_colored_track(t,this.track.t,t.scales.t,this.altitude_mode,n,!1)]),n=t.default_track=="solid_color";let s=new I.Style([new I.LineStyle(this.color,this.width.toString())]);return r.add([this.make_solid_track(t,s,this.altitude_mode,"Solid color",n)]),r}make_shadow_folder(t){if(!this.track.elevation_data)return new xt;let e=t.stock.radio_folder_style.url,r=new xt([new I.Folder("Shadow",e,[],!1)]);r.add([t.stock.invisible_none_folder]);let n=new I.Style([new I.LineStyle("ff000000","1")]);r.add([this.make_solid_track(t,n,"clampToGround","Normal")]);let s=new I.LineStyle("00000000","1"),o=Ht.fromRGBAHexString(t.options.extrude_color);o?o.a=128/255:o=new Ht(0,0,0,128/255);let a=new I.PolyStyle([new I.SimpleElement("color",o.toHexString()),new I.SimpleElement("width","1")]);return n=new I.Style([s,a]),r.add([this.make_solid_track(t,n,"absolute","Extrude",!1,!0)]),n=new I.Style([new I.LineStyle(this.color,this.width.toString())]),r.add([this.make_solid_track(t,n,"clampToGround","Solid color",!1)]),r}make_animation_tour(t){let e=t.stock.radio_folder_style.url,r=new I.Folder("Animation",e,[],!1),n=new I.Style([new I.LineStyle("bf00aaff","2")]);r.add(n);let s=new I.Tour("Double-click here to start tour",1);r.add(s),e=t.stock.check_hide_children_style.url;let o=new I.Folder("Path segments",e,[],!1),a=[],l=new I.LineString(this.track.coords.slice(0,2),this.altitude_mode,!0),c=new I.Placemark("1",l,[],n.url,!1,!1);a.push(c),s.add_update(c.Id);for(let u=1;u<this.track.coords.length;u++)l=new I.LineString(this.track.coords.slice(u,u+2),this.altitude_mode,!0),c=new I.Placemark(null,l,[],n.url,!1,!1),a.push(c),s.add_update(c.Id);return a.forEach(u=>o.add(u)),r.add(o),r}make_animation(t){let e=new I.IconStyle([t.stock.animation_icon,new I.color(this.color),new I.scale(t.stock.icon_scales[0].toString())]),r=new I.ListStyle("checkHideChildren"),n=Ht.fromRGBAHexString(t.options.anim_tail_color);n?n.a=159/255:n=new Ht(255/255,155/255,0/255,159/255);let s=new I.LineStyle(n.toHexString(),this.width.toString()),o=new Ht(Math.random(),Math.random(),Math.random(),1),a=new I.LabelStyle(o,1),l=new I.Style([e,r,s,a]),c=new I.Folder("Animation",null,[l],null,!1),u=new I.Point(this.track.coords[0],this.altitude_mode),h=new I.TimeSpan(null,this.track.coords[0].dt),_=new I.Placemark(null,u,[h],l.url);c.add(_);for(let v=1;v<this.track.coords.length-1;v++){let b=this.track.coords[v-1].halfway_to(this.track.coords[v]);if(u=new I.Point(b,this.altitude_mode),h=new I.TimeSpan(this.track.coords[v-1].dt,this.track.coords[v].dt),_=new I.Placemark(null,u,[h],l.url),t.flights.length>1&&_.add(new I.SimpleElement("name",this.track.pilot_name)),c.add(_),t.options.anim_tail){let d=new I.LineString([this.track.coords[v-1],this.track.coords[v]],"absolute"),y=null;t.options.anim_tail_duration>0&&(y=new Date(this.track.coords[v].dt.getTime()+t.options.anim_tail_duration*1e3)),h=new I.TimeSpan(this.track.coords[v].dt,y),_=new I.Placemark(null,d,[h],l.url),c.add(_)}}u=new I.Point(this.track.coords[this.track.coords.length-1],this.altitude_mode);let g=new I.LineString(this.track.coords.slice(this.track.indexOf(new Date(this.track.coords[this.track.coords.length-1].dt.getTime()-6e4)),this.track.coords.length-1),"absolute");return h=new I.TimeSpan(this.track.coords[this.track.coords.length-1].dt),_=new I.Placemark(null,u,[h],l.url),c.add(_),_=new I.Placemark(null,g,[h],l.url),c.add(_),new xt([c])}make_photos_folder(t){if(this.photos.length<=0)return new xt;let e=new I.Folder("Photos",null,[],!1);return this.photos.sort((n,s)=>s.date.getTime()-n.date.getTime()).forEach(n=>{let s,o;n.coord?(s=n.coord,o=n.elevation_data?"absolute":"clampToGround"):(s=this.track.coord_at(qr(n.date,-1*t.tz_offset)),o=this.altitude_mode);let a=new I.Point(s,o),l=n.name;(n.description?.trim().length??0>0)&&(l+=": "+n.description);let c=`<h3>${l}</h3>${n.to_html_img()}`,u=t.stock.photo_style.url,h=new I.Placemark(n.name,a,[new I.CDATA("description",c),new I.CDATA("Snippet",c)],u);e.add(h)}),new xt([e])}make_xc_folder(t){if(!this.track.xc_score||!this.track.xc_score.solution||typeof this.track.xc_score.solution.scoreInfo!="object")return new xt;let e=this.track.xc_score.solution.scoreInfo,r=[];r.push(["Rules",t.options.xc_score_rules]),r.push(["Type",this.track.xc_score.solution.opt.scoring.name]),r.push(["Score",`${e.score}pts`]),e.legs&&e.legs.forEach(h=>{r.push([h.name,`${h.d}km`])}),r.push(["Distance",`${e.distance}km`]),this.track.xc_score.closingCircleRadius>0&&r.push(["Closing distance",`${this.track.xc_score.closingCircleRadius/1e3}km`]);let n=gt.make_table(r),s=`${this.track.xc_score.solution.opt.scoring.name} ${e.score}pts`,o=t.stock.check_hide_children_style.url,a=new I.Folder("Score",o,[new I.CDATA("description",n),new I.Snippet(s)]),l=new I.Style([new I.LineStyle("cc00FF00","1")]);a.add(l);let c=new I.Style([new I.LineStyle("ccFFFFFF","1")]);a.add(c);let u=new I.Style([new I.LineStyle("cc00F5FF","1")]);if(a.add(u),o=t.stock.xc_style.url,e.tp&&e.tp.forEach((h,_)=>{let g=kt.deg(h.y,h.x),v=new I.Point(g);a.add(new I.Placemark("TP"+(_+1),v,[],o))}),e.legs&&e.legs.forEach(h=>{let _=kt.deg(h.start.y,h.start.x),g=kt.deg(h.finish.y,h.finish.x),v=new I.LineString([_,g],null,!0);a.add(new I.Placemark(null,v,[],l.url))}),e.cp){let h=kt.deg(e.cp.in.y,e.cp.in.x),_=kt.deg(e.cp.out.y,e.cp.out.x);if(a.add(new I.Placemark("IN",new I.Point(h),[],o)),a.add(new I.Placemark("OUT",new I.Point(_),[],o)),e.tp){let g=kt.deg(e.tp[0].y,e.tp[0].x),v=new I.LineString([h,g],null,!0);a.add(new I.Placemark(null,v,[],c.url)),g=kt.deg(e.tp[e.tp.length-1].y,e.tp[e.tp.length-1].x),v=new I.LineString([_,g],null,!0),a.add(new I.Placemark(null,v,[],c.url))}if(this.track.xc_score.closingCircleRadius>0){let g=I.coordinates.circle(h,this.track.xc_score.closingCircleRadius),v=new I.LineString(g,null,!0);a.add(new I.Placemark(null,v,[],u.url))}}return new xt([a])}make_tour_folder(t){let e=t.stock.check_hide_children_style.url,r=new I.Folder("Tour",e,[],null,!1),n=this.track.coords[0].dt,s=15*60,o=[];for(;n<this.track.coords[this.track.coords.length-1].dt;)o.push(this.track.coord_at(n)),n=qr(n,s);for(let a=0;a<o.length;a++){let l=(a+1)%o.length,c=new I.Point(o[a],this.altitude_mode),u=o[a].initial_bearing_to_deg(o[l]),h=new I.Camera(o[a],u,75),_=new I.Placemark(null,c,[h]);r.add(_)}return r}make_placemark(t,e,r,n,s){let o=new I.Point(e,r);return new I.Placemark(n,o,[new I.Snippet],s)}make_altitude_marks_folder(t){if(!this.track.elevation_data)return new xt;let e=t.stock.check_hide_children_style.url,r=new I.Folder("Altitude marks",e,[],null,!1);return gt.salient2(this.track.coords.map(n=>n.ele),[100,50,10]).forEach((n,s)=>{let o=this.track.coords[s],a=t.scales.altitude?.discretize(o.ele)??0;e=t.altitude_styles[n][a].url,r.add(this.make_placemark(t,o,"absolute",`${o.ele}m`,e))}),new xt([r])}make_graph(t,e,r){if(!t.canvas)return new I.Comment("Error while generating graph");let n="images/"+r.title.replaceAll(" ","_")+"_"+this.Id+"_graph.png";this.pcount++,this.make_graph_chart(t,e,r).then(g=>{this.root.add_file(n,g),this.endwork()}).catch(g=>{console.log(g),this.endwork()});let s=new I.Icon([new I.CDATA("href",n)]),o=new I.overlayXY(0,"fraction",0,"fraction"),a=new I.screenXY(0,"fraction",16,"pixels"),l=new I.size(0,"fraction",0,"fraction"),c=new I.ScreenOverlay([s,o,a,l]),u=t.stock.check_hide_children_style.url,h=gt.capitalizeFirstLetter(r.title)+" graph";return new I.Folder(h,u,[c],null,!1)}make_analysis_folder(t,e,r,n){if(!this.track.elevation_data||r.length<=0)return new xt;let s=t.stock.check_hide_children_style.url,o=new I.Folder(gt.capitalizeFirstLetter(e)+"s",s,null,null,!1);for(let a=0,l=r[0];a<r.length;a++,l=r[a]){let c=this.track.coords[l.start],u=this.track.coords[l.stop],h=c.halfway_to(u),_=new I.Point(h,"absolute"),g=0,v=0,b=new Pt(0);for(let J=l.start;J<l.stop;J++){let W=this.track.coords[J+1].ele-this.track.coords[J].ele,it=this.track.t[J+1]-this.track.t[J];W>0?g+=W:W<0&&(v+=W),b.update(W/it)}let d=new Pt(this.track.climb.slice(l.start,l.stop)),y=this.track.coords[l.stop].ele-this.track.coords[l.start].ele,w=this.track.t[l.stop]-this.track.t[l.start],C=c.distance_to(u),P=c.initial_bearing_to(u),k={};k.altitude_change=zt(y),k.average_climb=zt(y/w,1),k.maximum_climb=zt(d.max,1),k.peak_climb=zt(b.max,1);let A=w*d.max;A==0?k.efficiency=Ba:k.efficiency=zt(100*y/A),k.distance=zt(C/1e3,1);let E=y<0?zt(-C/y,1).toString():Fa;k.average_ld=E,k.average_speed=zt(3.6*C/w,1),k.maximum_descent=zt(d.min,1),k.peak_descent=zt(b.min,1),k.start_altitude=c.ele,k.finish_altitude=u.ele;let M=new Date(c.dt.getTime()+t.tz_offset*1e3);k.start_time=M.toISOString().substring(11,19);let F=new Date(u.dt.getTime()+t.tz_offset*1e3);k.finish_time=F.toISOString().substring(11,19);let x=this.track.t[l.stop]-this.track.t[l.start],D=("0"+Math.trunc(x%60).toString()).substr(-2);k.duration=`${Math.trunc(x/60)}m ${D}ds`,k.accumulated_altitude_gain=g,k.accumulated_altitude_loss=v,k.drift_direction=kt.rad_to_cardinal(P+Math.PI);let m=new I.ExtendedData(k),z="";e=="thermal"?z=`${zt(y)}m at ${zt(y/w,1)}m/s`:e=="glide"?z=`${zt(C/1e3,1)}km at ${E}:1, ${zt(3.6*C/w)}km/h`:e=="dive"&&(z=`${-1*zt(-y)}m at ${zt(y/w,1)}m/s`);let $=new I.Placemark(z,_,[m],n);o.add($);let N=new I.LineString([c,u],"absolute");$=new I.Placemark(null,N,null,n),o.add($)}return new xt([o])}make_time_mark(t,e,r,n){let s=new I.Point(e,this.altitude_mode),o=new Date(r.getTime()+t.tz_offset*1e3).toISOString().substring(11,16);return new I.Placemark(o,s,[],n)}make_time_marks_folder(t,e=300){let r=t.stock.check_hide_children_style.url,n=new I.Folder("Time marks",r,[],null,!1),s=this.track.coords[0];r=t.stock.time_mark_styles[0].url,n.add(this.make_time_mark(t,s,s.dt,r));let o=gt.datetime_floor(this.track.coords[0].dt,e);for(;o<=this.track.coords[0].dt;)o=new Date(o.getTime()+e*1e3);for(;o<this.track.coords[this.track.coords.length-1].dt;){s=this.track.coord_at(o);let a=3;o.getMinutes()==0?a=0:o.getMinutes()==30?a=1:(o.getMinutes()==15||o.getMinutes()==45)&&(a=2),r=t.stock.time_mark_styles[a].url,n.add(this.make_time_mark(t,s,o,r)),o=new Date(o.getTime()+e*1e3)}return s=this.track.coords[this.track.coords.length-1],r=t.stock.time_mark_styles[0].url,n.add(this.make_time_mark(t,s,s.dt,r)),n}to_kmz(t){return new Promise((e,r)=>{if(this.endconv=e,this.pcount++,t.scales.time!=null){let n=t.scales.time?.range.max,s=t.scales.time?.range.min;this.time_positions=this.track.t.map(o=>Math.trunc(t.graph_width*(o-s)/(n-s)))}if(this.root.add([this.make_description(t)]),this.root.add([this.make_snippet(t)]),this.track.declaration&&this.root.add([be.make_task_folder(t,this.track.declaration)]),this.root.add([this.make_track_folder(t)]),this.root.add([this.make_shadow_folder(t)]),this.root.add([this.make_animation(t)]),this.root.add([this.make_photos_folder(t)]),this.root.add([this.make_xc_folder(t)]),this.root.add([this.make_altitude_marks_folder(t)]),this.track.elevation_data&&t.scales.altitude){let n=this.track.coords.map(s=>s.ele);this.root.add([this.make_graph(t,n,t.scales.altitude)])}this.root.add([this.make_analysis_folder(t,"thermal",this.track.thermals,t.stock.thermal_style.url)]),this.root.add([this.make_analysis_folder(t,"glide",this.track.glides,t.stock.glide_style.url)]),this.root.add([this.make_analysis_folder(t,"dive",this.track.dives,t.stock.dive_style.url)]),this.root.add([this.make_time_marks_folder(t)]),this.photos.forEach(n=>this.root.add_file(n.filename,n.image)),this.endwork()})}};f(be,"Flight");var Qr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfXBQMSDhn88FT5AAAA1klEQVQoz32QsUoDURBFz4RlIVYWNgEr21TaprCxzedYuB8QsPMbUlmkk7SmCdiJWAhuYaWFhCAWKgThWLxs0N2NM8V7j7n3zr0v5P/K0vHimF2eWfLIOz0KBpEmITDxgAX35JzwzYxrnsi5TRCZWnpq32NFVn744LlD+84VpPRy/aj60zdnDj1UMii54mizE6AbuAOsgA5ccMd+zXs3XvmCBMjZYxRFLe8NvSrmNNp/YFylqPrMtnunjVs42qj+AiQfUfNSUwj/8huEEIytCs1xc2WjfgBWl2gno0VlygAAAABJRU5ErkJggg==";var tn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH2AQMFBQfNWb8lgAAAA1JREFUCJljYGBgYAAAAAUAAYehTtQAAAAASUVORK5CYII=";var xi=class{constructor(){this.icons=[];this.kmz=new xt,this.icons=[25,25,24,24].map(h=>I.Icon.palette(4,h)),this.icon_scales=[.6,.5,.4,.3].map(h=>Math.sqrt(h)),this.label_scales=[.6,.5,.4,.3].map(h=>Math.sqrt(h));let t=new I.ListStyle("radioFolder");this.radio_folder_style=new I.Style([t]),this.kmz.add_root(this.radio_folder_style),t=new I.ListStyle("checkHideChildren"),this.check_hide_children_style=new I.Style([t]),this.kmz.add_root(this.check_hide_children_style);let e=["#ffcccc","#ffdddd"],r=[["Altitude gain","$[altitude_change]m"],["Average climb","$[average_climb]m/s"],["Maximum climb","$[maximum_climb]m/s"],["Peak climb","$[peak_climb]m/s"],["Efficiency","$[efficiency]%"],["Start altitude","$[start_altitude]m"],["Finish altitude","$[finish_altitude]m"],["Start time","$[start_time]"],["Finish time","$[finish_time]"],["Duration","$[duration]"],["Accumulated altitude gain","$[accumulated_altitude_gain]m"],["Accumulated altitude loss","$[accumulated_altitude_loss]m"],["Drift","$[average_speed]km/h $[drift_direction]"]];this.thermal_style=this.make_analysis_style("cc3333ff",e,r),this.kmz.add_root(this.thermal_style),e=["#ccccff","#ddddff"],r=[["Altitude change","$[altitude_change]m"],["Average descent","$[average_climb]m/s"],["Maximum descent","$[maximum_descent]m/s"],["Peak descent","$[peak_descent]m/s"],["Start altitude","$[start_altitude]m"],["Finish altitude","$[finish_altitude]m"],["Start time","$[start_time]"],["Finish time","$[finish_time]"],["Duration","$[duration]"],["Accumulated altitude gain","$[accumulated_altitude_gain]m"],["Accumulated altitude loss","$[accumulated_altitude_loss]m"]],this.dive_style=this.make_analysis_style("ccff3333",e,r),this.kmz.add_root(this.dive_style),e=["#ccffcc","#ddffdd"],r=[["Altitude change","$[altitude_change]m"],["Average descent","$[average_climb]m/s"],["Distance","$[distance]km"],["Average glide ratio","$[average_ld]:1"],["Average speed","$[average_speed]km/h"],["Start altitude","$[start_altitude]m"],["Finish altitude","$[finish_altitude]m"],["Start time","$[start_time]"],["Finish time","$[finish_time]"],["Duration","$[duration]"],["Accumulated altitude gain","$[accumulated_altitude_gain]m"],["Accumulated altitude loss","$[accumulated_altitude_loss]m"]],this.glide_style=this.make_analysis_style("cc33ff33",e,r),this.kmz.add_root(this.glide_style),this.time_mark_styles=[];for(let h=0;h<this.icons.length;h++){let _=new I.IconStyle([this.icons[0],new I.scale(this.icon_scales[h].toString())]),g=new I.LabelStyle("cc33ffff",this.label_scales[h]);this.time_mark_styles.push(new I.Style([_,g]))}this.kmz.add_roots(this.time_mark_styles);let n=new I.BalloonStyle([new I.CDATA("text","$[description]")]),s=new I.IconStyle([I.Icon.palette(4,46),new I.scale(this.icon_scales[0].toString())]),o=new I.LabelStyle(void 0,this.label_scales[0]);this.photo_style=new I.Style([n,s,o]),this.kmz.add_root(this.photo_style),n=new I.BalloonStyle([new I.CDATA("text","<h3>$[name]</h3>$[description]")]),s=new I.IconStyle([this.icons[0],new I.SimpleElement("color","ccff33ff"),new I.scale(this.icon_scales[0].toString())]),o=new I.LabelStyle("ccff33ff",this.label_scales[0]);let a=new I.LineStyle("ccff33ff","2");this.xc_style=new I.Style([n,s,o,a]),this.kmz.add_root(this.xc_style),n=new I.BalloonStyle([new I.CDATA("text","<h3>$[name]</h3>$[description]")]),s=new I.IconStyle([this.icons[0],new I.SimpleElement("color","ccff33ff"),new I.scale(this.icon_scales[0].toString())]),o=new I.LabelStyle("ccff33ff"),a=new I.LineStyle("ccff33ff","2"),this.xc_style2=new I.Style([n,s,o,a]),this.kmz.add_root(this.xc_style2),this.pixel_url="images/pixel.png";let l=tn.substring(tn.indexOf("base64,")+7);this.kmz.add_file(this.pixel_url,l),this.visible_none_folder=this.make_none_folder(1),this.invisible_none_folder=this.make_none_folder(0);let c="images/paraglider.png";this.animation_icon=new I.Icon([new I.SimpleElement("href",c)]);let u=Qr.substring(Qr.indexOf("base64,")+7);this.kmz.add_file(c,u)}make_none_folder(t){let e=new I.Icon([new I.SimpleElement("href",this.pixel_url)]),r=new I.overlayXY(0,"fraction",0,"fraction"),n=new I.screenXY(0,"fraction",0,"fraction"),s=new I.size(0,"fraction",0,"fraction"),o=new I.ScreenOverlay([e,r,n,s,new I.SimpleElement("visibility",t.toString())]),a=this.check_hide_children_style.url;return new I.Folder("None",a,[o])}make_analysis_style(t,e,r){let n="<h3>$[name]</h3>$[description]"+gt.make_table(r,e),s="ff"+[...e[1].substring(1).matchAll(/../g)].reverse().join(""),o=new I.BalloonStyle([new I.CDATA("text",n),new I.SimpleElement("bgColor",s)]),a=new I.IconStyle([this.icons[0],new I.SimpleElement("color",t),new I.scale(this.icon_scales[0].toString())]),l=new I.LabelStyle(t,this.label_scales[0]),c=new I.LineStyle(t,"4");return new I.Style([o,a,l,c])}};f(xi,"Stock");var ae={tz_offset:0,same_start:!1,solid_color:"#ff0000",anim_tail:!0,anim_tail_duration:60,anim_tail_color:"#ff9b00",extrude_color:"#000000",xc_score:!0,xc_score_rules:"FFVL",xc_score_maxtime:10,dbg_serialize:!1},Si=class{constructor(t){this.bounds={};this.scales={};this.stock=new xi;this.task=null;this.tz_offset=0;this.altitude_styles=[];this.graph_width=600;this.graph_height=300;this.default_track="solid_color";this.canvas=null;this.files=[];this.flights=[];this.options=ae;t&&(this.canvas=t)}convert(t,e=ae,r,n=!1){this.flights=t,this.options=e,this.bounds={},this.scales={},this.altitude_styles=[],this.files=[],t.forEach(o=>{Qn(this.bounds,o.track.bounds)}),this.tz_offset=e.tz_offset*3600,r&&(this.task=r);let s=Jn;if(this.bounds.climb!=null&&(this.bounds.climb.min<-5?this.bounds.climb.min=-5:this.bounds.climb.max>5&&(this.bounds.climb.max=5),this.scales.climb=new ri(this.bounds.climb,"climb",.1,s)),this.bounds.speed!=null&&(this.scales.speed=new de(this.bounds.speed,"ground speed")),this.bounds.time!=null){let o=Math.trunc((this.bounds.time.max-this.bounds.time.min)/3600);if(o>24)throw new Error(`Invalid operation : more than 24 hours between flights (${o} hours)`);this.scales.time=new ze(this.bounds.time,"ground speed",1,wi,16,this.tz_offset)}if(this.bounds.tec!=null&&(this.scales.tec=new ri(this.bounds.tec,"climb with energy compensation",1,s)),this.bounds.t!=null&&(this.scales.t=new de(this.bounds.t,"time")),this.bounds.tas!=null&&(this.scales.tas=new de(this.bounds.tas,"air speed")),this.bounds.ele){this.scales.altitude=new de(this.bounds.ele,"altitude");for(let o=0;o<3;o++){let a=[],l=this.scales.altitude.colors();for(let c=0,u=l[c];c<l.length;c++,u=l[c]){let h=new I.BalloonStyle([new I.SimpleElement("text","$[description]")]),_=new I.IconStyle([this.stock.icons[o],new I.color(u),new I.scale(this.stock.icon_scales[o].toString())]),g=new I.LabelStyle(u,this.stock.label_scales[o]);a.push(new I.Style([h,_,g]))}this.stock.kmz.add_roots(a),this.altitude_styles.push(a)}}return t.length==1&&(t[0].track.elevation_data?this.default_track="climb":this.default_track="speed"),new Promise(o=>{let a=new xt;a.add_siblings([this.stock.kmz]),r&&a.add_siblings([be.make_task_folder(this,r)]),Promise.all(t.map(l=>l.to_kmz(this))).then(l=>{a.add_siblings(l)}).then(()=>{n?a.get_data(2.1,!0).then(o):a.get_data(2.1,!1,this.options.dbg_serialize).then(o)})})}flights2kml(t,e=ae,r){return this.convert(t,e,r)}flights2kmz(t,e=ae,r){return this.convert(t,e,r)}};f(Si,"FlightConvert");var rn=ii(us());var rr=class{constructor(t,e,r,n){this.name="";this.description="";this.type=0;this.radius=0;this.name=t??"",this.coord=kt.deg(e,r,n)}};f(rr,"Turnpoint");var pe=class{constructor(){this.name=null;this.tps=[]}static loadTask(t){try{let e=JSON.parse(t);if(e.taskType=="CLASSIC"){if(e.version==1)return new nr(t);if(e.version==2)return new sr(t)}else if(e.V==2&&e.T=="W")return new or(t)}catch{}return null}add_turnpoint(t,e,r,n){let s=new rr(t,e,r,n);return this.tps.push(s),s}};f(pe,"Task");var nr=class extends pe{constructor(t){super();let e=JSON.parse(t);Array.isArray(e.turnpoints)&&e.turnpoints.forEach(r=>{if(typeof r.radius!="number"||typeof r.waypoint!="object")return;let n=this.parse_waypoint(r.waypoint);if(n&&(n.radius=r.radius,typeof r.type=="string"))switch(r.type){case"SSS":n.type=2;break;case"ESS":n.type=3;break;case"TAKEOFF":n.type=1;break;default:n.type=0;break}})}parse_waypoint(t){if(typeof t.name!="string"||typeof t.lat!="number"||typeof t.lon!="number"||typeof t.altSmoothed!="number")return null;let e=this.add_turnpoint(t.name,t.lat,t.lon,t.altSmoothed);return e&&typeof t.description=="string"&&(e.description=t.description),e}};f(nr,"XCTrackTask");var sr=class extends pe{constructor(t){super();let e=JSON.parse(t);Array.isArray(e.t)&&e.t.forEach(r=>{if(typeof r.z!="string"||typeof r.n!="string")return;let n=(0,rn.decode)(r.z);if(n.length<=0)return;let s=this.add_turnpoint(r.n,n[0][1],n[0][0]);n.length>1&&(s.radius=kt.haversineDistance(n[0],n[1])),s&&typeof r.d=="string"&&(s.description=r.d)})}};f(sr,"XCTrackTaskV2");var or=class extends pe{constructor(t){super();let e=JSON.parse(t);Array.isArray(e.t)&&e.t.forEach(r=>{typeof r.z!="string"||typeof r.n!="string"||(0,rn.decode)(r.z).forEach(n=>this.add_turnpoint(r.n,n[1],n[0]))})}};f(or,"XCTrackWaypointsTask");var Wo=ii(co(),1);var uo={a:6378.137,b:6356.752314245,f:.0033528106647474805};function ce(i){return i/(180/Math.PI)}f(ce,"radians");function li(i){return i*(180/Math.PI)}f(li,"degrees");function fo(i,t){let e=ce(i.y),r=ce(i.x),n=ce(t.y),s=ce(t.x),{a:o,b:a,f:l}=uo,c=s-r,u=(1-l)*Math.tan(e),h=1/Math.sqrt(1+u*u),_=u*h,g=(1-l)*Math.tan(n),v=1/Math.sqrt(1+g*g),b=g*v,d=_*b,y=h*v,w=h*b,C=_*v,P=Math.abs(c)>Math.PI/2||Math.abs(n-e)>Math.PI/2,k=c,A=null,E=null,M=P?Math.PI:0,F=0,x=P?-1:1,D=null,m=1,z=null,$=1,N=null,J=null,W=0;do{A=Math.sin(k),E=Math.cos(k);let Dt=v*A,ct=w-C*E;if(D=Dt*Dt+ct*ct,Math.abs(D)<Number.EPSILON)break;if(F=Math.sqrt(D),x=d+y*E,M=Math.atan2(F,x),z=y*A/F,$=1-z*z,m=$!=0?x-2*d/$:0,N=l/16*$*(4+l*(4-3*$)),J=k,k=c+(1-N)*l*z*(M+N*F*(m+N*x*(-1+2*m*m))),(P?Math.abs(k)-Math.PI:Math.abs(k))>Math.PI)throw new EvalError("\u03BB > \u03C0")}while(Math.abs(k-J)>1e-7&&++W<1e3);if(W>=1e3)throw new EvalError("Vincenty formula failed to converge");let it=$*(o*o-a*a)/(a*a),B=1+it/16384*(4096+it*(-768+it*(320-175*it))),R=it/1024*(256+it*(-128+it*(74-47*it))),nt=R*F*(m+R/4*(x*(-1+2*m*m)-R/6*m*(-3+4*F*F)*(-3+4*m*m))),q=a*B*(M-nt),Y=Math.abs(D)<Number.EPSILON?0:Math.atan2(v*A,w-C*E),At=Math.abs(D)<Number.EPSILON?Math.PI:Math.atan2(h*A,-C+w*E);return{distance:q,initialBearing:Math.abs(q)<Number.EPSILON?NaN:li(Y),finalBearing:Math.abs(q)<Number.EPSILON?NaN:li(At),iterations:W}}f(fo,"inverse");var wt=class{constructor(t,e){Array.isArray(t)?(this.x=+t[e].longitude,this.y=+t[e].latitude,this.r=+e):(this.x=t,this.y=e)}geojson(t,e){return{type:"Feature",id:t,properties:e||{},geometry:{type:"Point",coordinates:[this.x,this.y]}}}toString(){return JSON.stringify(this.geojson())}intersects(t){if(t instanceof wt)return this.x==t.x&&this.y==t.y;if(t instanceof te)return t.intersects(this);throw new TypeError("other must be either Point or Box")}distanceEarth(t){return this.distanceEarthFCC(t)}distanceEarthFCC(t){let e=t.y-this.y,r=t.x-this.x,n=ce((this.y+t.y)/2),s=Math.cos(n),o=2*s*s-1,a=s*(2*o-1),l=2*o*o-1,c=2*o*a-s,u=111.13209-.566605*o+.0012*l,h=111.41513*s-.09455*a+12e-5*c;return Math.sqrt(u*e*(u*e)+h*r*(h*r))}distanceEarthRev(t,e){let r=this.x+li(t/6371/Math.cos(ce(this.y))),n=this.y+li(e/6371);return new wt(r,n)}distanceEarthVincentys(t){return fo(this,t).distance}};f(wt,"Point");var re=class{constructor(t,e){if(this.start=t,this.end=e,e<t)throw new Error("start should be before end")}count(){return this.end-this.start+1}center(){return this.start+Math.floor((this.end-this.start)/2)}left(){return new re(this.start,this.center())}right(){return new re(this.start+Math.ceil((this.end-this.start)/2),this.end)}contains(t){return this.start<=t&&t<=this.end}toString(){return`${this.start}:${this.end}`}};f(re,"Range");var te=class{constructor(t,e,r,n){if(t instanceof re){this.x1=1/0,this.y1=1/0,this.x2=-1/0,this.y2=-1/0;for(let s=t.start;s<=t.end;s++)this.x1=Math.min(e.flightPoints[s].x,this.x1),this.y1=Math.min(e.flightPoints[s].y,this.y1),this.x2=Math.max(e.flightPoints[s].x,this.x2),this.y2=Math.max(e.flightPoints[s].y,this.y2)}else this.x1=t,this.y1=e,this.x2=r,this.y2=n}vertices(){return[new wt(this.x1,this.y1),new wt(this.x2,this.y1),new wt(this.x2,this.y2),new wt(this.x1,this.y2)]}intersects(t){return t instanceof wt?this.x1<=t.x&&this.y1<=t.y&&this.x2>=t.x&&this.y2>=t.y:!(this.x1>t.x2||this.x2<t.x1||this.y1>t.y2||this.y2<t.y1)}area(){return Math.abs((this.x2-this.x1)*(this.y2-this.y1))}distance(t){if(this.intersects(t))return 0;let e=this.x1,r=this.x1,n=this.y1,s=this.y1;return this.x1>t.x2?r=t.x2:this.x2<t.x1&&(e=this.x2,r=t.x1),this.y1<t.y2?s=t.y2:this.y2>t.y1&&(n=this.y2,s=t.y1),new wt(e,n).distanceEarth(new wt(r,s))}geojson(t,e){return{type:"Feature",id:t,properties:e||{},geometry:{type:"Polygon",coordinates:[[[this.x1,this.y1],[this.x1,this.y2],[this.x2,this.y2],[this.x2,this.y1],[this.x1,this.y1]]]}}}geojson_collection(t){let e=[];for(let n=0;n<t.length;n++)e.push(t[n].geojson(n,{id:n}));return{type:"FeatureCollection",features:e}}toString(){return JSON.stringify(this.geojson())}};f(te,"Box");var bl=0,xe=class{constructor(t,e,r){t.length>e.scoring.cardinality?this.ranges=t.slice(0,e.scoring.cardinality):this.ranges=t,this.opt=e,this.boxes=[];for(let n=0;n<this.ranges.length;n++)n>0&&this.ranges[n-1].start>this.ranges[n].start&&(this.ranges[n]=new re(this.ranges[n-1].start,this.ranges[n].end)),n<this.ranges.length-1&&this.ranges[n].end>this.ranges[n+1].end&&(this.ranges[n]=new re(this.ranges[n].start,this.ranges[n+1].end)),this.boxes[n]=new te(this.ranges[n],e.flight);this.score=void 0,this.bound=void 0,this.id=bl++,this.opt.config&&this.opt.config.debug&&(this.parent=r,this.trace("constructor"))}do_branch(){let t=0;for(let r=0;r<this.ranges.length;r++)this.ranges[r].count()>this.ranges[t].count()&&(t=r);for(let r=0;r<this.ranges.length;r++)this.ranges[r].count()>1&&this.boxes[r].area()>this.boxes[t].area()*8&&(t=r);if(this.ranges[t].count()==1)return[];let e=[];for(let r of[this.ranges[t].left(),this.ranges[t].right()]){let n=[];for(let s=0;s<this.ranges.length;s++)s!=t?n[s]=this.ranges[s]:n[s]=r;e.push(new xe(n,this.opt,this))}return e}do_bound(){this.bound=this.opt.scoring.bound(this.ranges,this.boxes,this.opt),this.trace("bounding")}do_score(){for(let e=0;e<this.ranges.length;e++)if(e<this.ranges.length-1&&this.ranges[e].center()>=this.ranges[e+1].center()){this.score=0;return}let t=[];for(let e=0;e<this.ranges.length;e++)t[e]=new wt(this.opt.flight.filtered,this.ranges[e].center());this.scoreInfo=this.opt.scoring.score(t,this.opt),this.opt.scoring.post&&this.opt.scoring.post(this.scoreInfo,this.opt),this.score=this.scoreInfo.score,this.trace("scoring")}contentEquals(t,e){return t.id===e.id}contentCompare(t,e){return t.bound<e.bound?-1:t.bound>e.bound?1:t.id<e.id?-1:t.id>e.id?1:0}geojson(){let t=[];if(this.opt.config&&this.opt.config.debug)for(let r=0;r<this.ranges.length;r++)t.push(new te(this.ranges[r],this.opt.flight).geojson("box"+r,{id:"box"+r,area:new te(this.ranges[r],this.opt.flight).area(),a:this.ranges[r].start,b:this.ranges[r].end}));try{let r=this.scoreInfo.tp;for(let n in r)t.push(r[n].geojson("tp"+n,{id:"tp"+n,r:r[n].r,timestamp:r[n].r!==void 0?this.opt.flight.filtered[r[n].r].timestamp:void 0})),this.scoreInfo.ep&&n==r.length-1||t.push({type:"Feature",id:"seg"+n,properties:{id:"seg"+n,stroke:"yellow","stroke-width":4,d:r[n].distanceEarth(r[(n+1)%r.length])},geometry:{type:"LineString",coordinates:[[r[n].x,r[n].y],[r[(n+1)%r.length].x,r[(n+1)%r.length].y]],style:{stroke:"yellow","stroke-width":4}}});if(this.opt.config.debug&&this.boxes)for(let n in this.boxes)t.push({type:"Feature",id:"box"+n,properties:{id:"box"+n,stroke:"black","stroke-width":4},geometry:{type:"LineString",coordinates:[[this.boxes[n].x1,this.boxes[n].y1],[this.boxes[n].x2,this.boxes[n].y1],[this.boxes[n].x2,this.boxes[n].y2],[this.boxes[n].x1,this.boxes[n].y2],[this.boxes[n].x1,this.boxes[n].y1]],style:{stroke:"black","stroke-width":4}}})}catch{}try{if(this.scoreInfo.ep!==void 0||this.scoreInfo.cp!==void 0){let r=this.scoreInfo.cp,n=this.scoreInfo.tp,s=this.scoreInfo.ep;if(r&&r.in&&r.out){for(let o of["in","out"])t.push(r[o].geojson("cp_"+o,{id:"cp_"+o,r:r[o].r,timestamp:this.opt.flight.filtered[r[o].r].timestamp}));t.push({type:"Feature",id:"closing",properties:{id:"closing",stroke:"green","stroke-width":3,d:r.in.distanceEarth(r.out)},geometry:{type:"LineString",coordinates:[[r.in.x,r.in.y],[r.out.x,r.out.y]],style:{stroke:"green","stroke-width":3}}})}if(s&&s.start&&s.finish){for(let o of["start","finish"])t.push(s[o].geojson("ep_"+o,{id:"ep_"+o,r:s[o].r,timestamp:this.opt.flight.filtered[s[o].r].timestamp}));t.push({type:"Feature",id:"seg_in",properties:{id:"seg_in",stroke:"gold","stroke-width":3,d:s.start.distanceEarth(n[0])},geometry:{type:"LineString",coordinates:[[s.start.x,s.start.y],[n[0].x,n[0].y]],style:{stroke:"green","stroke-width":3}}}),t.push({type:"Feature",id:"seg_out",properties:{id:"seg_out",stroke:"gold","stroke-width":3,d:s.finish.distanceEarth(n[2])},geometry:{type:"LineString",coordinates:[[n[2].x,n[2].y],[s.finish.x,s.finish.y]],style:{stroke:"green","stroke-width":3}}})}}}catch{}for(let r=0;r<this.opt.flight.ll.length;r++){let n=this.opt.flight.ll[r];t.push(this.opt.flight.flightPoints[n.launch].geojson("launch"+r,{id:"launch"+r,r:n.launch,timestamp:this.opt.flight.filtered[n.launch].timestamp})),t.push(this.opt.flight.flightPoints[n.landing].geojson("land"+r,{id:"land"+r,r:n.landing,timestamp:this.opt.flight.filtered[n.landing].timestamp}))}if(!this.opt.config||!this.opt.config.noflight){let r=[];for(let n of this.opt.flight.filtered)r.push([n.longitude,n.latitude]);t.push({type:"Feature",id:"flight",properties:{id:"flight"},geometry:{type:"LineString",coordinates:r}})}return{type:"FeatureCollection",properties:{name:"EPSG:3857",id:this.id,score:this.score!==void 0?this.score:void 0,bound:this.currentUpperBound!==void 0?this.currentUpperBound:this.bound,optimal:this.optimal,processedTime:this.time/1e3,processedSolutions:this.processed,type:this.opt.scoring.name,code:this.opt.scoring.code},features:t}}toString(){let t=`${this.opt.scoring.name}`;if(this.score&&(t+=` ${this.score} points`),this.scoreInfo&&(t+=` ${this.scoreInfo.distance.toFixed(2)}km`),t+=` ( <${this.bound.toFixed(2)} )`,this.opt.config&&this.opt.config.debug){t+=` { id: ${this.id} `;for(let e of this.ranges)t+=" "+e.toString();t+=" } "}return t}trace(t){if(!this.opt.config.trace||!process.stdout)return;let e=this.opt.config.trace.split(",").map(n=>parseInt(n,10));if(e[0]<0){if(this.id%e[1]!==0)return}else if(this.ranges.some((n,s)=>!n.contains(e[s])))return;let r=`${t||""} solution tracing: ${this.id} ${this.opt.scoring.name} `;for(let n of this.ranges)r+=n+" ";this.bound&&(r+=`bound: ${this.bound} `),this.score&&(r+=`score: ${this.score} `),process.stdout.write(`
`+r+`
`),this.opt.config.env.fs.writeFileSync(`debug-${this.id}.json`,JSON.stringify(this.geojson({debug:!0})))}};f(xe,"Solution");var hi=class{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,e){let r=this.length++;for(;r>0;){let n=r-1>>1,s=this.values[n];if(e>=s)break;this.ids[r]=this.ids[n],this.values[r]=s,r=n}this.ids[r]=t,this.values[r]=e}pop(){if(this.length===0)return;let t=this.ids[0];if(this.length--,this.length>0){let e=this.ids[0]=this.ids[this.length],r=this.values[0]=this.values[this.length],n=this.length>>1,s=0;for(;s<n;){let o=(s<<1)+1,a=o+1,l=this.ids[o],c=this.values[o],u=this.values[a];if(a<this.length&&u<c&&(o=a,l=this.ids[a],c=u),c>=r)break;this.ids[s]=l,this.values[s]=c,s=o}this.ids[s]=e,this.values[s]=r}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}};f(hi,"FlatQueue");var go=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],kn=3,Se=class{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[e,r]=new Uint8Array(t,0,2);if(e!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(r>>4!==kn)throw new Error(`Got v${r>>4} data when expected v${kn}.`);let[n]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new Se(s,n,go[r&15],t)}constructor(t,e=16,r=Float64Array,n){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535);let s=t,o=s;this._levelBounds=[s*4];do s=Math.ceil(s/this.nodeSize),o+=s,this._levelBounds.push(o*4);while(s!==1);this.ArrayType=r||Float64Array,this.IndexArrayType=o<16384?Uint16Array:Uint32Array;let a=go.indexOf(this.ArrayType),l=o*4*this.ArrayType.BYTES_PER_ELEMENT;if(a<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this._boxes=new this.ArrayType(this.data,8,o*4),this._indices=new this.IndexArrayType(this.data,8+l,o),this._pos=o*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+l+o*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,o*4),this._indices=new this.IndexArrayType(this.data,8+l,o),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(kn<<4)+a]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t),this._queue=new hi}add(t,e,r,n){let s=this._pos>>2;return this._indices[s]=s,this._boxes[this._pos++]=t,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,t<this.minX&&(this.minX=t),e<this.minY&&(this.minY=e),r>this.maxX&&(this.maxX=r),n>this.maxY&&(this.maxY=n),s}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}let t=this.maxX-this.minX||1,e=this.maxY-this.minY||1,r=new Uint32Array(this.numItems),n=(1<<16)-1;for(let s=0;s<this.numItems;s++){let o=4*s,a=this._boxes[o++],l=this._boxes[o++],c=this._boxes[o++],u=this._boxes[o++],h=Math.floor(n*((a+c)/2-this.minX)/t),_=Math.floor(n*((l+u)/2-this.minY)/e);r[s]=wl(h,_)}On(r,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let s=0,o=0;s<this._levelBounds.length-1;s++){let a=this._levelBounds[s];for(;o<a;){let l=o,c=1/0,u=1/0,h=-1/0,_=-1/0;for(let g=0;g<this.nodeSize&&o<a;g++)c=Math.min(c,this._boxes[o++]),u=Math.min(u,this._boxes[o++]),h=Math.max(h,this._boxes[o++]),_=Math.max(_,this._boxes[o++]);this._indices[this._pos>>2]=l,this._boxes[this._pos++]=c,this._boxes[this._pos++]=u,this._boxes[this._pos++]=h,this._boxes[this._pos++]=_}}}search(t,e,r,n,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4,a=[],l=[];for(;o!==void 0;){let c=Math.min(o+this.nodeSize*4,yo(o,this._levelBounds));for(let u=o;u<c;u+=4){if(r<this._boxes[u]||n<this._boxes[u+1]||t>this._boxes[u+2]||e>this._boxes[u+3])continue;let h=this._indices[u>>2]|0;o<this.numItems*4?(s===void 0||s(h))&&l.push(h):a.push(h)}o=a.pop()}return l}neighbors(t,e,r=1/0,n=1/0,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4,a=this._queue,l=[],c=n*n;for(;o!==void 0;){let u=Math.min(o+this.nodeSize*4,yo(o,this._levelBounds));for(let h=o;h<u;h+=4){let _=this._indices[h>>2]|0,g=mo(t,this._boxes[h],this._boxes[h+2]),v=mo(e,this._boxes[h+1],this._boxes[h+3]),b=g*g+v*v;o<this.numItems*4?(s===void 0||s(_))&&a.push((_<<1)+1,b):a.push(_<<1,b)}for(;a.length&&a.peek()&1;)if(a.peekValue()>c||(l.push(a.pop()>>1),l.length===r))return a.clear(),l;o=a.pop()>>1}return a.clear(),l}};f(Se,"Flatbush");function mo(i,t,e){return i<t?t-i:i<=e?0:i-e}f(mo,"axisDist");function yo(i,t){let e=0,r=t.length-1;for(;e<r;){let n=e+r>>1;t[n]>i?r=n:e=n+1}return t[e]}f(yo,"upperBound");function On(i,t,e,r,n,s){if(Math.floor(r/s)>=Math.floor(n/s))return;let o=i[r+n>>1],a=r-1,l=n+1;for(;;){do a++;while(i[a]<o);do l--;while(i[l]>o);if(a>=l)break;vl(i,t,e,a,l)}On(i,t,e,r,l,s),On(i,t,e,l+1,n,s)}f(On,"sort");function vl(i,t,e,r,n){let s=i[r];i[r]=i[n],i[n]=s;let o=4*r,a=4*n,l=t[o],c=t[o+1],u=t[o+2],h=t[o+3];t[o]=t[a],t[o+1]=t[a+1],t[o+2]=t[a+2],t[o+3]=t[a+3],t[a]=l,t[a+1]=c,t[a+2]=u,t[a+3]=h;let _=e[r];e[r]=e[n],e[n]=_}f(vl,"swap");function wl(i,t){let e=i^t,r=65535^e,n=65535^(i|t),s=i&(t^65535),o=e|r>>1,a=e>>1^e,l=n>>1^r&s>>1^n,c=e&n>>1^s>>1^s;e=o,r=a,n=l,s=c,o=e&e>>2^r&r>>2,a=e&r>>2^r&(e^r)>>2,l^=e&n>>2^r&s>>2,c^=r&n>>2^(e^r)&s>>2,e=o,r=a,n=l,s=c,o=e&e>>4^r&r>>4,a=e&r>>4^r&(e^r)>>4,l^=e&n>>4^r&s>>4,c^=r&n>>4^(e^r)&s>>4,e=o,r=a,n=l,s=c,l^=e&n>>8^r&s>>8,c^=r&n>>8^(e^r)&s>>8,e=l^l>>1,r=c^c>>1;let u=i^t,h=r|65535^(u|e);return u=(u|u<<8)&16711935,u=(u|u<<4)&252645135,u=(u|u<<2)&858993459,u=(u|u<<1)&1431655765,h=(h|h<<8)&16711935,h=(h|h<<4)&252645135,h=(h|h<<2)&858993459,h=(h|h<<1)&1431655765,(h<<1|u)>>>0}f(wl,"hilbert");var Tn=ii(Po(),1),To=ii(Mo(),1);function Do(i,t){let e=Math.min(i[0].x1,i[1].x1,i[2].x1),r=Math.min(i[0].y1,i[1].y1,i[2].y1),n=Math.max(i[0].x2,i[1].x2,i[2].x2),s=Math.max(i[0].y2,i[1].y2,i[2].y2),o=!1;for(let c=0;c<3;c++)if(i[c].intersects(i[(c+1)%3])){o=!0;break}let a=[[],[],[]];for(let c=0;c<3;c++){let u=i[c].vertices();for(let h of u)(h.x==e||h.x==n)&&(h.y==r||h.y==s)&&a[c].push(h);if(a[c].length==0)for(let h of u)(h.x==e||h.x==n||h.y==r||h.y==s)&&a[c].push(h);(a[c].length==0||o)&&(a[c]=u)}let l=0;for(let c of a[0])for(let u of a[1])for(let h of a[2]){let _=t(c,u,h);l=Math.max(l,_)}return l}f(Do,"maxDistance3Rectangles");function Ro(i,t){let e=i[0].vertices(),r=i[1].vertices(),n=i[2].vertices(),s=1/0;for(let o of e)for(let a of r)for(let l of n){let c=t(o,a,l);s=Math.min(s,c)}return s}f(Ro,"minDistance3Rectangles");function Ar(i){let t=i[0].vertices(),e=i[1].vertices(),r=1/0;for(let n of t)for(let s of e){let o=n.distanceEarth(s);r=Math.min(r,o)}return r}f(Ar,"minDistance2Rectangles");function je(i){let t=i[0].vertices(),e=i[1].vertices(),r=0;for(let n of t)for(let s of e){let o=n.distanceEarth(s);r=Math.max(r,o)}return r}f(je,"maxDistance2Rectangles");function Lo(i,t,e){let r=0;for(let n of t[e]){let s=i!==void 0?n.distanceEarth(i):0,o=t.length>e+1?Lo(n,t,e+1):0;r=Math.max(r,s+o)}return r}f(Lo,"maxDistancePath");function Fo(i){let t=[],e=1/0,r=1/0,n=-1/0,s=-1/0,o=[];for(let l=0;l<i.length;l++){if(i[l]instanceof te)t[l]=i[l].vertices(),e=Math.min(e,i[l].x1),r=Math.min(r,i[l].y1),n=Math.max(n,i[l].x2),s=Math.max(s,i[l].y2);else if(i[l]instanceof wt)t[l]=[i[l]],e=Math.min(e,i[l].x),r=Math.min(r,i[l].y),n=Math.max(n,i[l].x),s=Math.max(s,i[l].y);else throw new TypeError("boxes must contain only Box or Point");o[l]=[]}for(let l=1;l<i.length;l++)i[l-1].intersects(i[l])&&(i[l-1].intersecting=!0,i[l].intersecting=!0);for(let l=0;l<i.length;l++){if(i[l].intersecting){o[l]=t[l];continue}for(let c of t[l])(c.x==e||c.x==n)&&(c.y==r||c.y==s)&&o[l].push(c);if(o[l].length==0)for(let c of t[l])(c.x==e||c.x==n||c.y==r||c.y==s)&&o[l].push(c);o[l].length==0&&(o[l]=t[l])}return Lo(void 0,o,0)}f(Fo,"maxDistanceNRectangles");function Ol(i,t,e){let r=e.flight.closestPairs.search({minX:i,minY:t,maxX:i,maxY:t}),n=r.reduce((u,h)=>!u||h.in>u.in?h:u,void 0);if(n=r.reduce((u,h)=>!u||h.out<u.out?h:u,n),n!==void 0)return n.o;let s=new Se(i+1-e.launch,8),o=Math.abs(Math.cos(ce(e.flight.flightPoints[i].y)));for(let u=e.launch;u<=i;u++){let h=e.flight.flightPoints[u];s.add(h.x*o,h.y,h.x*o,h.y)}s.finish(),r=e.flight.closestPairs.search({minX:i,minY:t,maxX:i,maxY:e.landing});let a=r.reduce((u,h)=>!u||h.out<u.out?h:u,void 0),l=a!==void 0?a.maxY:e.landing,c={d:1/0};for(let u=t;u<=l;u++){let h=e.flight.flightPoints[u],_=s.neighbors(h.x*o,h.y,1)[0]+e.launch;if(_!==void 0){let g=e.flight.flightPoints[_],v=e.scoring.rounding(h.distanceEarth(g));v<c.d&&(c.d=v,c.out=h,c.in=g)}}if(a!==void 0){let u=a.o.out,h=a.o.in,_=e.scoring.rounding(u.distanceEarth(h));_<c.d&&(console.log("This flight is very interesting because it has multiple possible closings, please consider submitting it for the unit testing of this program by opening an issue on https://github.com/mmomtchev/igc-xc-score"),c.d=_,c.out=u,c.in=h)}return e.flight.closestPairs.insert({minX:c.in.r,minY:t,maxX:i,maxY:c.out.r,o:c}),c}f(Ol,"findClosestPairIn2Segments");function Al(i,t,e){let r=new Se(i.end+1-i.start),n=Math.abs(Math.cos(ce(e.flight.flightPoints[i.start].y)));for(let o=i.start;o<=i.end;o++){let a=e.flight.flightPoints[o];r.add(a.x*n,a.y,a.x*n,a.y)}r.finish();let s={d:1/0};for(let o=t.start;o<=t.end;o++){let a=e.flight.flightPoints[o],l=r.neighbors(a.x*n,a.y,1)[0]+i.start;if(l!==void 0){let c=e.flight.flightPoints[l],u=e.scoring.rounding(a.distanceEarth(c));u<s.d&&(s.d=u,s.out=a,s.in=c)}}return s}f(Al,"findClosestPairIn2PartialSegments");function Di(i,t,e,r){let n;if(e instanceof te)n=e.vertices();else if(e instanceof wt)n=[e];else throw new TypeError("target must be either Point or Box");let s,o;if(i===r.launch)s=0,o=+t;else if(t===r.landing)s=1,o=+i;else throw new RangeError("this function supports seeking only from the launch or the landing point");let a=-1/0,l;for(let c of n){let u=-1/0,h,_,g=r.flight.furthestPoints[s].get(c.x+":"+c.y);for(let v of g||[])if(o>=v.min&&o<=v.max){_=v;break}if(_)if(i<=_.o.r&&_.o.r<=t)u=c.distanceEarth(_.o),h=_.o;else throw new Error("furthestPoints cache inconsistency");if(h===void 0){let v=!1,b=!1;for(let d=i;d<=t;d++){let y=r.flight.flightPoints[d];if(e instanceof te&&e.intersects(y)){v=!0;continue}let w=c.distanceEarth(y);w>u&&(u=w,h=y,b=!0)}if(v)for(let d of n){let y=c.distanceEarth(d);y>u&&(u=y,h=e,b=!1)}if(b){let d;i===r.launch?d={min:+h.r,max:+t}:t===r.landing&&(d={min:+i,max:+h.r});let y=g;y||(y=[],r.flight.furthestPoints[s].set(c.x+":"+c.y,y));let w=y.filter(C=>C.o.r==h.r&&!(d.max<=C.min||d.min>=C.max))[0];w?(w.min=Math.min(d.min,w.min),w.max=Math.max(d.max,w.max)):y.push({...d,o:h})}}u>a&&(a=u,l=h)}return l===void 0&&(l=e),l}f(Di,"findFurthestPointInSegment");function Ri(i,t,e,r){let n=r.flight.closestPairs.search({minX:r.launch,minY:t,maxX:i,maxY:r.landing});for(let o of n)if(o.o.d<=r.scoring.closingDistanceFree)return o.o;let s=Ol(i,t,r);return s.d<=r.scoring.closingDistance(e,r)?s:!1}f(Ri,"isTriangleClosed");function Bo(i,t,e,r){let n=Al(i,t,r);return n.d<=r.scoring.closingDistance(e,r)?n:!1}f(Bo,"isOutAndReturnClosed");function zo(i){i.flight.closestPairs=new To.default,i.flight.furthestPoints=[new Tn.default,new Tn.default],i.flight.flightPoints=new Array(i.flight.filtered.length);for(let t in i.flight.filtered)i.flight.flightPoints[t]=new wt(i.flight.filtered,t)}f(zo,"init");var jo=10,Li={t:60,x0:1.5,xt:5,z0:.05,zt:.9},Fi={t:20,xmax:2.5,zmax:.1};function El(i){for(let t=0;t<i.length;t++)if((i[t].pressureAltitude==null||i[t].pressureAltitude<-1e3)&&(i[t].pressureAltitude=i[t].gpsAltitude),i[t].pressureAltitude===null&&(i[t].gpsAltitude=void 0),t>0){let e=i[t].timestamp-i[t-1].timestamp;e>0?(i[t].hspeed=new wt(i,t-1).distanceEarth(new wt(i,t))*1e3/e*1e3,i[t].vspeed=(i[t].pressureAltitude-i[t-1].pressureAltitude)/e*1e3):(i[t].hspeed=i[t-1].hspeed,i[t].vspeed=i[t-1].vspeed)}else i[t].hspeed=0,i[t].vspeed=0;for(let t=0;t<i.length;t++){let e=i[t].timestamp,r,n;for(r=t;r>0&&i[r].timestamp>e-Math.round(jo*1e3/2);r--);for(n=t;n<i.length-1&&i[n].timestamp<e+Math.round(jo*1e3/2);n++);let s=i.slice(r,n+1);i[t].hma=s.reduce((o,a)=>o+a.hspeed,0)/s.length,i[t].vma=s.reduce((o,a)=>o+Math.abs(a.vspeed),0)/s.length}}f(El,"prepare");function Il(i){let t;for(let e=0;e<i.length-1;e++)if(t===void 0&&i[e].hma>Li.xt&&i[e].vma>Li.zt&&(t=e),t!==void 0)if(i[e].hma>Li.x0&&i[e].vma>Li.z0){if(i[e].timestamp>i[t].timestamp+Li.t*1e3)for(let r=t;r<=e;r++)i[e].stateFlight=!0}else t=void 0}f(Il,"detectFlight");function Pl(i){let t;for(let e=0;e<i.length-1;e++)if(t===void 0&&i[e].hma<Fi.xmax&&i[e].vma<Fi.zmax&&(t=e),t!==void 0)if(i[e].hma<Fi.xmax&&i[e].vma<Fi.zmax){if(i[e].timestamp>i[t].timestamp+Fi.t*1e3)for(let r=t;r<=e;r++)i[e].stateGround=!0}else t=void 0}f(Pl,"detectGround");function Ml(i){let t=[];for(let e=0;e<i.length-1;e++)if(i[e].stateFlight){let r;for(r=e;r>0&&!i[r].stateGround;r--);let n=r;for(r=e;r<i.length-2&&!i[r].stateGround;r++);let s=r;e=r,t.push({launch:n,landing:s})}return t.length==0&&t.push({launch:0,landing:i.length-1}),t}f(Ml,"detectLaunchLanding");function Uo(i,t){if(t.invalid?i.filtered=i.fixes.slice(0):i.filtered=i.fixes.filter(e=>e.valid).filter((e,r,n)=>r==0||n[r-1].timestamp!==e.timestamp),i.filtered.length<5)throw new Error(`Flight must contain at least 5 valid GPS fixes, ${i.filtered.length} valid fixes found (out of ${i.fixes.length})`);t.trim||t.detectLaunch||t.detectLanding?(El(i.filtered),Il(i.filtered),Pl(i.filtered),i.ll=Ml(i.filtered)):i.ll=[{launch:0,landing:i.filtered.length-1}]}f(Uo,"analyze");function ui(i,t){return t.scoring.rounding(i>(t.scoring.closingDistanceFree||0)?i:0)}f(ui,"closingPenalty");function Mt(i,t){return t.scoring.rounding(Math.max(t.scoring.closingDistanceFixed||0,i*(t.scoring.closingDistanceRelative||0)))}f(Mt,"closingWithLimit");function Xt(i,t){return t.scoring.finalRounding?t.scoring.finalRounding(i):t.scoring.rounding?t.scoring.rounding(i):i}f(Xt,"finalRounding");function fi(i,t,e){let r=Di(e.launch,i[0].start,t[0],e),n=Di(i[2].end,e.landing,t[2],e),s=e.scoring.rounding(Fo([r,t[0],t[1],t[2],n]));return s<(e.scoring.minDistance||0)?0:Xt(s*e.scoring.multiplier,e)}f(fi,"boundDistance3Points");function di(i,t){let e=0,r=Di(t.launch,i[0].r,i[0],t),n=Di(i[2].r,t.landing,i[2],t),s=[r,i[0],i[1],i[2],n],o=[{name:"START : TP1"},{name:"TP1 : TP2"},{name:"TP2 : TP3"},{name:"TP3 : FINISH"}];for(let l=0;l<s.length-1;l++)o[l].d=t.scoring.rounding(s[l].distanceEarth(s[l+1])),e+=o[l].d,o[l].start=s[l],o[l].finish=s[l+1];e=Xt(e,t);let a=e>=(t.scoring.minDistance||0)?Xt(e*t.scoring.multiplier,t):0;return{distance:e,score:a,tp:i,ep:{start:r,finish:n},legs:o}}f(di,"scoreDistance3Points");function Dl(i,t,e){let r=Ro(t,(l,c,u)=>e.scoring.rounding(l.distanceEarth(c))+e.scoring.rounding(c.distanceEarth(u))+e.scoring.rounding(u.distanceEarth(l)));if(i<r)return 0;let n=e.scoring.rounding(je([t[0],t[1]])),s=e.scoring.rounding(je([t[1],t[2]])),o=e.scoring.rounding(je([t[2],t[0]])),a=e.scoring.rounding(Math.min(n,s,o)/e.scoring.minSide);return a<r?0:Math.min(a,i)}f(Dl,"maxFAIDistance");function Rl(i,t,e){let r=e.scoring.rounding(Ar([t[0],t[1]])),n=e.scoring.rounding(Ar([t[1],t[2]])),s=e.scoring.rounding(Ar([t[2],t[0]]));return e.scoring.rounding(Math.max(r,n,s)/e.scoring.maxSide)>i?0:i}f(Rl,"maxTRIDistance");function Zt(i,t,e){let r=Do(t,(o,a,l)=>e.scoring.rounding(o.distanceEarth(a))+e.scoring.rounding(a.distanceEarth(l))+e.scoring.rounding(l.distanceEarth(o)));if(r<(e.scoring.minDistance||0))return 0;let n=r;if(e.scoring.minSide!==void 0&&(n=Dl(n,t,e)),e.scoring.maxSide!==void 0&&(n=Rl(n,t,e)),n===0)return 0;let s={d:0};return i[0].end<i[2].start?(s=Ri(i[0].end,i[2].start,n,e),s?Xt((n-ui(s.d,e))*e.scoring.multiplier,e):0):Xt(n*e.scoring.multiplier,e)}f(Zt,"boundTriangle");function Yt(i,t){let e=0,r=[{name:"TP1 : TP2"},{name:"TP2 : TP3"},{name:"TP3 : TP1"}];for(let a=0;a<i.length;a++)r[a].d=t.scoring.rounding(i[a].distanceEarth(i[(a+1)%i.length])),e+=r[a].d,r[a].start=i[a],r[a].finish=i[(a+1)%i.length];if(e=Xt(e,t),e<(t.scoring.minDistance||0))return{score:0};if(t.scoring.minSide!==void 0){let a=t.scoring.minSide*e;if(r[0].d<a||r[1].d<a||r[2].d<a)return{score:0}}if(t.scoring.maxSide!==void 0){let a=t.scoring.maxSide*e;if(r[0].d>a||r[1].d>a||r[2].d>a)return{score:0}}let n=Ri(i[0].r,i[2].r,e,t);if(!n)return{score:0};let s=ui(n.d,t),o=Xt((e-s)*t.scoring.multiplier,t);return{distance:e,score:o,tp:i,cp:n,legs:r,penalty:s}}f(Yt,"scoreTriangle");function Bi(i,t,e){let r=e.scoring.rounding(je(t))*2;if(r<(e.scoring.minDistance||0))return 0;if(i[0].end<i[1].start){let n=Ri(i[0].end,i[1].start,r,e);return n?Xt((r-ui(n.d,e))*e.scoring.multiplier,e):0}return Xt(r*e.scoring.multiplier,e)}f(Bi,"boundOutAndReturn2");function zi(i,t){let e=t.scoring.rounding(i[0].distanceEarth(i[1])),r=Xt(e*2,t);if(r<(t.scoring.minDistance||0))return{score:0};let n=Ri(i[0].r,i[1].r,r,t);if(!n)return{score:0};let s=ui(n.d,t),o=Xt((r-s)*t.scoring.multiplier,t),a=[{name:"TP1 : TP2",start:i[0],finish:i[1],d:e},{name:"TP2 : TP1",start:i[1],finish:i[0],d:e}];return{distance:r,score:o,tp:i,cp:n,legs:a,penalty:s}}f(zi,"scoreOutAndReturn2");function Go(i,t,e){let r=new te(Math.min(t[0].x1,t[2].x1),Math.min(t[0].y1,t[2].y1),Math.max(t[0].x2,t[2].x2),Math.max(t[0].y2,t[2].y2)),n=e.scoring.rounding(je([t[1],r]));if(n<(e.scoring.minDistance||0))return 0;if(i[0].end<i[2].start){let s=Bo(i[0],i[2],n,e);if(!s)return 0;let o=new te((t[0].x1+t[2].x1)/2,(t[0].y1+t[2].y1)/2,(t[0].x2+t[2].x2)/2,(t[0].y2+t[2].y2)/2),a=e.scoring.rounding(je([t[1],o]));return Xt((a-ui(s.d,e))*2*e.scoring.multiplier,e)}return Xt(n*2*e.scoring.multiplier,e)}f(Go,"boundOutAndReturn1");function Ho(i,t){let e=new wt((i[0].x+i[2].x)/2,(i[0].y+i[2].y)/2),r=t.scoring.rounding(i[1].distanceEarth(e)),n=Xt(r*2,t);if(n<(t.scoring.minDistance||0))return{score:0};let s=t.scoring.rounding(i[0].distanceEarth(i[2]));if(s>t.scoring.closingDistance(n,t))return{score:0};let o=ui(s,t),a=Xt((n-o)*t.scoring.multiplier,t),l=[{name:"TP1 : TP2",start:i[1],finish:e,d:r},{name:"TP2 : TP1",start:e,finish:i[1],d:r}];return{distance:n,score:a,tp:[i[1],e],cp:{d:s,in:i[0],out:i[2]},legs:l}}f(Ho,"scoreOutAndReturn1");function Er(i,t){if(!i.tp||!i.legs||i.score==0)return;function e(n,s){let o=n.distanceEarth(s),a=(o+t.scoring.cylinders)/o,l=(1-a)*s.x+a*n.x,c=(1-a)*s.y+a*n.y;return new wt(l,c)}f(e,"moveAway");let r=[];for(let n in i.tp){if(i.tp[n].r===void 0)continue;let s=+n-1;s<0?i.ep?s=i.ep.start:s=i.tp[i.tp.length-1]:s=i.tp[s];let o=+n+1;o>=i.tp.length?i.ep?o=i.ep.finish:o=i.tp[0]:o=i.tp[o];let a=new wt((s.x+o.x)/2,(s.y+o.y)/2);r[n]=e(i.tp[n],a)}for(let n in i.tp)r[n]&&(i.tp[n]=r[n]);switch(i.ep&&i.ep.start&&(i.ep.start=e(i.ep.start,i.tp[0])),i.ep&&i.ep.finish&&(i.ep.finish=e(i.ep.finish,i.tp[2])),t.scoring.code){case"tri":case"fai":{i.distance=0;for(let n=0;n<i.legs.length;n++)i.legs[n].d=t.scoring.rounding(i.tp[n].distanceEarth(i.tp[(n+1)%i.tp.length]))-t.scoring.cylinders*2,i.distance+=i.legs[n].d}break;case"oar":{let n=t.scoring.rounding(i.tp[0].distanceEarth(i.tp[1]))-t.scoring.cylinders;i.legs[0].d=i.legs[1].d=n,i.distance=n*2}break;case"od":{let n=[i.ep.start,i.tp[0],i.tp[1],i.tp[2],i.ep.finish];i.distance=0;for(let s=0;s<n.length-1;s++)i.legs[s].d=t.scoring.rounding(n[s].distanceEarth(n[s+1])),i.legs[s].d-=t.scoring.cylinders*2,i.distance+=i.legs[s].d}break}i.distance=Xt(i.distance,t),i.score=i.distance>=(t.scoring.minDistance||0)?Xt((i.distance-(i.penalty||0))*t.scoring.multiplier,t):0}f(Er,"adjustFAICylinders");var Fl={FFVL:[{name:"Distance 3 points",multiplier:1,bound:fi,score:di,rounding:Ot,cardinality:3,code:"od"},{name:"Triangle plat",multiplier:1.2,bound:Zt,score:Yt,closingDistance:Mt,closingDistanceFixed:3,closingDistanceFree:3,closingDistanceRelative:.05,rounding:Ot,cardinality:3,code:"tri"},{name:"Triangle FAI",multiplier:1.4,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFixed:3,closingDistanceFree:3,closingDistanceRelative:.05,rounding:Ot,cardinality:3,code:"fai"}],XContest:[{name:"Free Flight",multiplier:1,bound:fi,score:di,rounding:Ot,cardinality:3,code:"od"},{name:"Free Triangle",multiplier:1.2,bound:Zt,score:Yt,closingDistance:Mt,closingDistanceRelative:.2,rounding:Ot,cardinality:3,code:"tri"},{name:"FAI Triangle",multiplier:1.4,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceRelative:.2,rounding:Ot,cardinality:3,code:"fai"},{name:"Closed Free Triangle",multiplier:1.4,bound:Zt,score:Yt,closingDistance:Mt,closingDistanceFixed:0,closingDistanceFree:0,closingDistanceRelative:.05,rounding:Ot,cardinality:3,code:"tri"},{name:"Closed FAI Triangle",multiplier:1.6,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFixed:0,closingDistanceFree:0,closingDistanceRelative:.05,rounding:Ot,cardinality:3,code:"fai"}],FAI:[{name:"Free Distance around 3 TPs",multiplier:1,bound:fi,score:di,rounding:Ot,finalRounding:Vt,cardinality:3,code:"od"},{name:"Free Triangle",multiplier:1.2,bound:Zt,score:Yt,closingDistance:Mt,closingDistanceFree:.8,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri"},{name:"FAI Triangle",multiplier:1.4,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFree:.8,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"fai"}],"FAI-Cylinders":[{name:"Free Distance around 3 TPs",multiplier:1,bound:fi,score:di,rounding:Ot,finalRounding:Vt,cardinality:3,code:"od",cylinders:.4,post:Er},{name:"Free Triangle",multiplier:1.2,bound:Zt,score:Yt,closingDistance:Mt,closingDistanceFree:.8,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",cylinders:.4,post:Er},{name:"FAI Triangle",multiplier:1.4,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFree:.8,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"fai",cylinders:.4,post:Er}],"FAI-OAR":[{name:"Out-and-Return Distance",multiplier:1,bound:Go,score:Ho,closingDistance:Mt,closingDistanceFree:.8,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"oar"}],"FAI-OAR2":[{name:"Out-and-Return Flight around 2 TPs",multiplier:1,bound:Bi,score:zi,closingDistance:Mt,closingDistanceFree:.8,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:2,code:"oar"}],XCLeague:[{name:"Out-and-Return Distance >=35km",multiplier:2,bound:Bi,score:zi,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:2,code:"oar",minDistance:35},{name:"Out-and-Return Distance >=15km",multiplier:1.5,bound:Bi,score:zi,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:2,code:"oar",minDistance:15},{name:"Out-and-Return Distance >=5km (Clubs)",multiplier:1.2,bound:Bi,score:zi,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:2,code:"oar",minDistance:5},{name:"Turnpoint Flight",multiplier:1,bound:fi,score:di,rounding:Ot,finalRounding:Vt,cardinality:3,code:"od",minDistance:5},{name:"Flat Triangle >=35km",multiplier:2,bound:Zt,score:Yt,minSide:.15,maxSide:.45,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",minDistance:35},{name:"Flat Triangle >=15km",multiplier:1.5,bound:Zt,score:Yt,minSide:.15,maxSide:.45,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",minDistance:15},{name:"Flat Triangle >=5km (Clubs)",multiplier:1.2,bound:Zt,score:Yt,minSide:.15,maxSide:.45,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",minDistance:5},{name:"FAI Triangle >=25km",multiplier:2.3,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",minDistance:25},{name:"FAI Triangle >=15km",multiplier:2,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",minDistance:15},{name:"FAI Triangle >=5km (Clubs)",multiplier:1.5,bound:Zt,score:Yt,minSide:.28,closingDistance:Mt,closingDistanceFixed:.8,rounding:Ot,finalRounding:Vt,cardinality:3,code:"tri",minDistance:5}]};function Ot(i){return parseFloat(parseFloat(i).toFixed(2))}f(Ot,"round2");function Vt(i){return parseFloat(parseFloat(i).toFixed(1))}f(Vt,"round1");var Me=Fl;function*Ir(i,t,e){let r,n=t||Me.FFVL,s=e||{};Uo(i,s),zo({flight:i}),s.hp?wt.prototype.distanceEarth=wt.prototype.distanceEarthVincentys:wt.prototype.distanceEarth=wt.prototype.distanceEarthFCC;let o=[];for(let h of n)for(let _ of i.ll){let g={flight:i,launch:_.launch,landing:_.landing,scoring:h,config:s},v=new xe([new re(_.launch,_.landing),new re(_.launch,_.landing),new re(_.launch,_.landing)],g);v.do_bound(),v.do_score(),o.push(v)}let a=o[0],l=new Wo.default(o,xe.prototype.contentEquals,xe.prototype.contentCompare),c=0,u=0;do{let h=Date.now();for(;l.length>0;){if(c%100===0&&s.env&&s.env.v8!=="undefined"){let b=s.env.v8.getHeapStatistics();if(b.used_heap_size/b.heap_size_limit>.98){console.error(`Out of memory: ${b.used_heap_size/1024}KiB used of ${b.heap_size_limit/1024}KiB total`);break}}let g=l.pop();if(g.bound<=a.score){l.clear();break}let v=g.do_branch();for(let b of v)if(b.do_bound(),!(b.bound<=a.score)){if(b.do_score(),c++,b.score>=a.score&&b.score>0){if(a=b,l.findLeast()&&l.findLeast().value.bound<=a.score){let d=l.findGreatestLessThanOrEqual({bound:a.score});if(d!==void 0){let y=l.indexOf(d.value);l.splice(0,y+1).length}}}else delete b.scoreInfo;l.push(b),s.debug&&(a.last=b)}if(c>s.maxloop||Date.now()-h>s.maxcycle)break}a.processed=c;let _=l.findGreatest();if(a.currentUpperBound=_?_.value.bound:a.bound,u+=Date.now()-h,a.time=u,l.length==0?a.optimal=!0:a.optimal=!1,a.optimal)return r=!0,a;r=yield a}while(!r)}f(Ir,"solver");var Ni=class{constructor(t,e){this.closingCircleRadius=0;this.options=e,this.solution=t;try{let r=Me[this.options.xc_score_rules].find(n=>n.name==t.opt.scoring.name);r&&t.scoreInfo&&typeof r.closingDistance=="function"&&(this.closingCircleRadius=r.closingDistance(t.scoreInfo.distance,{scoring:r})*1e3)}catch{}}};f(Ni,"XC");var Ue=class{constructor(t,e,r=ae){this.bounds={};this.elevation_data=!1;this.s=[0];this.ele=[];this.total_dz_positive=0;this.max_dz_positive=0;this.min_ele=0;this.speed=[];this.climb=[];this.tec=[];this.progress=[];this.thermals=[];this.glides=[];this.dives=[];this.declaration=null;this.xc_score=null;if(this.options=r,this.flight=t,this.filename=e??"flight.igc",this.coords=Ue.filter(t.fixes.map(n=>kt.deg(n.latitude,n.longitude,(n.pressureAltitude??n.gpsAltitude)||0,new Date(n.timestamp)))),this.t=this.coords.map(n=>n.dt.getTime()/1e3),this.t.length<=0)throw new Error("No valid records in "+this.filename);if(this.t.length<5)throw new Error(`The IGC '${this.filename}' seems corrupted : ${this.t.length} records, starting at ${this.coords[0].dt}`);(this.t.length<60||this.coords[0].dt>new Date)&&console.warn(`The IGC '${this.filename}' seems corrupted : ${this.t.length} records, starting at ${this.coords[0].dt}`),this.pilot_name=t.pilot||"",this.glider_type=t.gliderType||"",this.glider_id=t.registration||"",t.task&&t.task.points&&t.task.points.length>0&&(this.declaration=new pe,t.task.points.forEach(n=>this.declaration?.add_turnpoint(n.name,n.latitude,n.longitude))),this.analyse(20)}static filter(t){let e=[t[0]],r=t[0],n;for(let s=0;s<t.length;s++){if(n=t[s],n.dt<=r.dt)continue;let o=r.distance_to(n),a=(n.dt.getTime()-r.dt.getTime())/1e3;if(a==0||o/a>100)continue;let l=n.ele-r.ele;l/a<-30||30<l/a||(e.push(n),r=n)}return e}indexOf(t){let e=t.getTime()/1e3;return e<this.t[0]?0:this.t[this.t.length-1]<=e?this.coords.length-1:gt.find_first_ge(this.t,e)??0}coord_at(t){let e=t.getTime()/1e3,r=this.indexOf(t);if(r==0||r==this.coords.length-1)return this.coords[r];if(this.t[r]==e)return this.coords[r];{let n=(e-this.t[r-1])/(this.t[r]-this.t[r-1]);return this.coords[r-1].interpolate(this.coords[r],n)}}analyse(t){let e=this.coords.length,r=(this.coords[e-1].dt.getTime()-this.coords[0].dt.getTime())/1e3/e;t<2*r&&(t=2*r),this.bounds.ele=Pt.createbounds(this.coords.map(F=>F.ele)),this.bounds.time=Pt.createbounds([this.coords[0].dt.getTime()/1e3,this.coords[e-1].dt.getTime()/1e3]),this.bounds.t=Pt.createbounds([this.t[0],this.t[e-1]]),this.bounds.tas=Pt.createbounds(this.flight.fixes.filter(F=>F.extensions.hasOwnProperty("TAS")).map(F=>parseInt(F.extensions.TAS))),this.bounds.ele&&(this.bounds.ele.min!=0||this.bounds.ele.max!=0)&&(this.elevation_data=!0),this.min_ele=this.coords[0].ele;let n=0;for(let F=1;F<e;F++)this.s.push(this.s[F-1]+this.coords[F-1].distance_to(this.coords[F])),this.ele.push((this.coords[F-1].ele+this.coords[F-1].ele)/2),n=this.coords[F].ele-this.coords[F-1].ele,n>0&&(this.total_dz_positive+=n),this.coords[F].ele<this.min_ele?this.min_ele=this.coords[F].ele:this.coords[F].ele-this.min_ele>this.max_dz_positive&&(this.max_dz_positive=this.coords[F].ele-this.min_ele);let s=0,o=0,a=0,l=0,c=0,u=0,h=0,_=0,g=0,v=0,b=0,d=0,y,w;for(let F=1;F<e;F++){for(a=(this.t[F-1]+this.t[F])/2-t/2;this.t[s]<=a;)s++;for(s==0?(y=this.coords[0],c=this.s[0]):(h=(a-this.t[s-1])/(this.t[s]-this.t[s-1]),y=this.coords[s-1].interpolate(this.coords[s],h),c=(1-h)*this.s[s-1]+h*this.s[s]),l=a+t;o<e&&this.t[o]<l;)o++;o==e?(w=this.coords[e-1],u=this.s[e-1]):(_=(l-this.t[o-1])/(this.t[o]-this.t[o-1]),w=this.coords[o-1].interpolate(this.coords[o],_),u=(1-_)*this.s[o-1]+_*this.s[o]),g=u-c,v=u*u-c*c,n=w.ele-y.ele,b=y.distance_to(w),g==0?d=0:b>g?d=1:d=b/g,this.speed.push(3.6*g/t),this.climb.push(n/t),this.tec.push(n/t+v/(2*9.80665)),this.progress.push(d)}this.bounds.speed=Pt.createbounds(this.speed),this.bounds.climb=Pt.createbounds(this.climb),this.bounds.tec=Pt.createbounds(this.tec);let C=Array(e-1).fill(0),P=this.progress.map(F=>F>=.9),k,A=gt.condense(gt.runs_where(P),this.t,60);for(let F=0;F<A.length;F++){k=A[F];for(let x=k.start;x<k.stop;x++)C[x]=2}let E=Array.from(Array(e-1)).map((F,x)=>this.progress[x]<.9&&this.climb[x]<1);A=gt.condense(gt.runs_where(E),this.t,30);for(let F=0;F<A.length;F++)if(k=A[F],!(this.coords[k.stop].ele-this.coords[k.start].ele>=-100))for(let x=k.start;x<k.stop;x++)C[x]=3;let M=Array.from(Array(e-1)).map((F,x)=>this.progress[x]<.9&&this.climb[x]>0||this.speed[x]<10&&this.climb[x]>0||this.climb[x]>1);A=gt.condense(gt.runs_where(M),this.t,60);for(let F=0;F<A.length;F++){k=A[F];for(let x=k.start;x<k.stop;x++)C[x]=1}A=gt.runs(C);for(let F=0;F<A.length;F++)switch(k=A[F],t=this.t[k.stop]-this.t[k.start],n=this.coords[k.stop].ele-this.coords[k.start].ele,C[k.start]){case 1:t>=60&&n>50&&this.thermals.push(k);break;case 3:t>=30&&n/t<-2&&this.dives.push(k);break;case 2:t>=120&&this.glides.push(k);break}if(this.options.xc_score){let F=Date.now()+this.options.xc_score_maxtime*1e3;Me.hasOwnProperty(this.options.xc_score_rules)||(this.options.xc_score_rules=ae.xc_score_rules);let x=Ir(this.flight,Me[this.options.xc_score_rules]),D,m;do if(D=x.next(),(m===void 0||D.value.id!==m.id)&&(m=D.value),Date.now()>F)break;while(!D.done);m&&(this.xc_score=new Ni(m,this.options))}}};f(Ue,"Track");var Ur=typeof self<"u"?self:global,Yi=typeof navigator<"u",Bl=Yi&&typeof HTMLImageElement>"u",Br=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),Gr=Ur.Buffer,Pr=Ur.BigInt,Hr=!!Gr,zl=f(i=>i,"o");function zr(i,t=zl){if(Br)try{return typeof Ae=="function"?Promise.resolve(t(Ae(i))):import(i).then(t)}catch{console.warn(`Couldn't load ${i}`)}}f(zr,"l");var Un=Ur.fetch,Nl=f(i=>Un=i,"u");if(!Ur.fetch){let i=zr("http",r=>r),t=zr("https",r=>r),e=f((r,{headers:n}={})=>new Promise(async(s,o)=>{let{port:a,hostname:l,pathname:c,protocol:u,search:h}=new URL(r),_={method:"GET",hostname:l,path:encodeURI(c)+h,headers:n};a!==""&&(_.port=Number(a));let g=(u==="https:"?await t:await i).request(_,v=>{if(v.statusCode===301||v.statusCode===302){let b=new URL(v.headers.location,r).toString();return e(b,{headers:n}).then(s).catch(o)}s({status:v.statusCode,arrayBuffer:()=>new Promise(b=>{let d=[];v.on("data",y=>d.push(y)),v.on("end",()=>b(Buffer.concat(d)))})})});g.on("error",o),g.end()}),"i");Nl(e)}function ot(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}f(ot,"c");var Nr=f(i=>na(i)?void 0:i,"f"),jl=f(i=>i!==void 0,"d");function na(i){return i===void 0||(i instanceof Map?i.size===0:Object.values(i).filter(jl).length===0)}f(na,"p");function Gt(i){let t=new Error(i);throw delete t.stack,t}f(Gt,"g");function Ge(i){return(i=function(t){for(;t.endsWith("\0");)t=t.slice(0,-1);return t}(i).trim())===""?void 0:i}f(Ge,"m");function Fn(i){let t=function(e){let r=0;return e.ifd0.enabled&&(r+=1024),e.exif.enabled&&(r+=2048),e.makerNote&&(r+=2048),e.userComment&&(r+=1024),e.gps.enabled&&(r+=512),e.interop.enabled&&(r+=100),e.ifd1.enabled&&(r+=1024),r+2048}(i);return i.jfif.enabled&&(t+=50),i.xmp.enabled&&(t+=2e4),i.iptc.enabled&&(t+=14e3),i.icc.enabled&&(t+=6e3),t}f(Fn,"S");var Bn=f(i=>String.fromCharCode.apply(null,i),"C"),Vo=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function sa(i){return Vo?Vo.decode(i):Hr?Buffer.from(i).toString("utf8"):decodeURIComponent(escape(Bn(i)))}f(sa,"b");var qt=class{static from(t,e){return t instanceof this&&t.le===e?t:new qt(t,void 0,void 0,e)}constructor(t,e=0,r,n){if(typeof n=="boolean"&&(this.le=n),Array.isArray(t)&&(t=new Uint8Array(t)),t===0)this.byteOffset=0,this.byteLength=0;else if(t instanceof ArrayBuffer){r===void 0&&(r=t.byteLength-e);let s=new DataView(t,e,r);this._swapDataView(s)}else if(t instanceof Uint8Array||t instanceof DataView||t instanceof qt){r===void 0&&(r=t.byteLength-e),(e+=t.byteOffset)+r>t.byteOffset+t.byteLength&&Gt("Creating view outside of available memory in ArrayBuffer");let s=new DataView(t.buffer,e,r);this._swapDataView(s)}else if(typeof t=="number"){let s=new DataView(new ArrayBuffer(t));this._swapDataView(s)}else Gt("Invalid input argument for BufferView: "+t)}_swapArrayBuffer(t){this._swapDataView(new DataView(t))}_swapBuffer(t){this._swapDataView(new DataView(t.buffer,t.byteOffset,t.byteLength))}_swapDataView(t){this.dataView=t,this.buffer=t.buffer,this.byteOffset=t.byteOffset,this.byteLength=t.byteLength}_lengthToEnd(t){return this.byteLength-t}set(t,e,r=qt){return t instanceof DataView||t instanceof qt?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||Gt("BufferView.set(): Invalid data argument."),this.toUint8().set(t,e),new r(this,e,t.byteLength)}subarray(t,e){return e=e||this._lengthToEnd(t),new qt(this,t,e)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(t,e){return new Uint8Array(this.buffer,this.byteOffset+t,e)}getString(t=0,e=this.byteLength){return sa(this.getUint8Array(t,e))}getLatin1String(t=0,e=this.byteLength){let r=this.getUint8Array(t,e);return Bn(r)}getUnicodeString(t=0,e=this.byteLength){let r=[];for(let n=0;n<e&&t+n<this.byteLength;n+=2)r.push(this.getUint16(t+n));return Bn(r)}getInt8(t){return this.dataView.getInt8(t)}getUint8(t){return this.dataView.getUint8(t)}getInt16(t,e=this.le){return this.dataView.getInt16(t,e)}getInt32(t,e=this.le){return this.dataView.getInt32(t,e)}getUint16(t,e=this.le){return this.dataView.getUint16(t,e)}getUint32(t,e=this.le){return this.dataView.getUint32(t,e)}getFloat32(t,e=this.le){return this.dataView.getFloat32(t,e)}getFloat64(t,e=this.le){return this.dataView.getFloat64(t,e)}getFloat(t,e=this.le){return this.dataView.getFloat32(t,e)}getDouble(t,e=this.le){return this.dataView.getFloat64(t,e)}getUintBytes(t,e,r){switch(e){case 1:return this.getUint8(t,r);case 2:return this.getUint16(t,r);case 4:return this.getUint32(t,r);case 8:return this.getUint64&&this.getUint64(t,r)}}getUint(t,e,r){switch(e){case 8:return this.getUint8(t,r);case 16:return this.getUint16(t,r);case 32:return this.getUint32(t,r);case 64:return this.getUint64&&this.getUint64(t,r)}}toString(t){return this.dataView.toString(t,this.constructor.name)}ensureChunk(){}};f(qt,"I");function zn(i,t){Gt(`${i} '${t}' was not loaded, try using full build of exifr.`)}f(zn,"P");var pi=class extends Map{constructor(t){super(),this.kind=t}get(t,e){return this.has(t)||zn(this.kind,t),e&&(t in e||function(r,n){Gt(`Unknown ${r} '${n}'.`)}(this.kind,t),e[t].enabled||zn(this.kind,t)),super.get(t)}keyList(){return Array.from(this.keys())}};f(pi,"k");var me=new pi("file parser"),Ut=new pi("segment parser"),ye=new pi("file reader");function Ul(i,t){return typeof i=="string"?Ko(i,t):Yi&&!Bl&&i instanceof HTMLImageElement?Ko(i.src,t):i instanceof Uint8Array||i instanceof ArrayBuffer||i instanceof DataView?new qt(i):Yi&&i instanceof Blob?Nn(i,t,"blob",qe):void Gt("Invalid input argument")}f(Ul,"D");function Ko(i,t){return(e=i).startsWith("data:")||e.length>1e4?jn(i,t,"base64"):Br&&i.includes("://")?Nn(i,t,"url",Ye):Br?jn(i,t,"fs"):Yi?Nn(i,t,"url",Ye):void Gt("Invalid input argument");var e}f(Ko,"O");async function Nn(i,t,e,r){return ye.has(e)?jn(i,t,e):r?async function(n,s){let o=await s(n);return new qt(o)}(i,r):void Gt(`Parser ${e} is not loaded`)}f(Nn,"x");async function jn(i,t,e){let r=new(ye.get(e))(i,t);return await r.read(),r}f(jn,"v");var Ye=f(i=>Un(i).then(t=>t.arrayBuffer()),"M"),qe=f(i=>new Promise((t,e)=>{let r=new FileReader;r.onloadend=()=>t(r.result||new ArrayBuffer),r.onerror=e,r.readAsArrayBuffer(i)}),"R"),Tr=class extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}};f(Tr,"L");function Ft(i,t,e){let r=new Tr;for(let[n,s]of e)r.set(n,s);if(Array.isArray(t))for(let n of t)i.set(n,r);else i.set(t,r);return r}f(Ft,"U");function Je(i,t,e){let r,n=i.get(t);for(r of e)n.set(r[0],r[1])}f(Je,"F");var Kt=new Map,fe=new Map,Be=new Map,De=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],_i=["jfif","xmp","icc","iptc","ihdr"],Qe=["tiff",..._i],Tt=["ifd0","ifd1","exif","gps","interop"],Re=[...Qe,...Tt],Le=["makerNote","userComment"],bi=["translateKeys","translateValues","reviveValues","multiSegment"],Fe=[...bi,"sanitize","mergeOutput","silentErrors"],Ui=class{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}};f(Ui,"_");var Te=class extends Ui{get needed(){return this.enabled||this.deps.size>0}constructor(t,e,r,n){if(super(),ot(this,"enabled",!1),ot(this,"skip",new Set),ot(this,"pick",new Set),ot(this,"deps",new Set),ot(this,"translateKeys",!1),ot(this,"translateValues",!1),ot(this,"reviveValues",!1),this.key=t,this.enabled=e,this.parse=this.enabled,this.applyInheritables(n),this.canBeFiltered=Tt.includes(t),this.canBeFiltered&&(this.dict=Kt.get(t)),r!==void 0)if(Array.isArray(r))this.parse=this.enabled=!0,this.canBeFiltered&&r.length>0&&this.translateTagSet(r,this.pick);else if(typeof r=="object"){if(this.enabled=!0,this.parse=r.parse!==!1,this.canBeFiltered){let{pick:s,skip:o}=r;s&&s.length>0&&this.translateTagSet(s,this.pick),o&&o.length>0&&this.translateTagSet(o,this.skip)}this.applyInheritables(r)}else r===!0||r===!1?this.parse=this.enabled=r:Gt(`Invalid options argument: ${r}`)}applyInheritables(t){let e,r;for(e of bi)r=t[e],r!==void 0&&(this[e]=r)}translateTagSet(t,e){if(this.dict){let r,n,{tagKeys:s,tagValues:o}=this.dict;for(r of t)typeof r=="string"?(n=o.indexOf(r),n===-1&&(n=s.indexOf(Number(r))),n!==-1&&e.add(Number(s[n]))):e.add(r)}else for(let r of t)e.add(r)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,jr(this.pick,this.deps)):this.enabled&&this.pick.size>0&&jr(this.pick,this.deps)}};f(Te,"Y");var ee={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},$o=new Map,ge=class extends Ui{static useCached(t){let e=$o.get(t);return e!==void 0||(e=new this(t),$o.set(t,e)),e}constructor(t){super(),t===!0?this.setupFromTrue():t===void 0?this.setupFromUndefined():Array.isArray(t)?this.setupFromArray(t):typeof t=="object"?this.setupFromObject(t):Gt(`Invalid options argument ${t}`),this.firstChunkSize===void 0&&(this.firstChunkSize=Yi?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let t;for(t of De)this[t]=ee[t];for(t of Fe)this[t]=ee[t];for(t of Le)this[t]=ee[t];for(t of Re)this[t]=new Te(t,ee[t],void 0,this)}setupFromTrue(){let t;for(t of De)this[t]=ee[t];for(t of Fe)this[t]=ee[t];for(t of Le)this[t]=!0;for(t of Re)this[t]=new Te(t,!0,void 0,this)}setupFromArray(t){let e;for(e of De)this[e]=ee[e];for(e of Fe)this[e]=ee[e];for(e of Le)this[e]=ee[e];for(e of Re)this[e]=new Te(e,!1,void 0,this);this.setupGlobalFilters(t,void 0,Tt)}setupFromObject(t){let e;for(e of(Tt.ifd0=Tt.ifd0||Tt.image,Tt.ifd1=Tt.ifd1||Tt.thumbnail,Object.assign(this,t),De))this[e]=Dn(t[e],ee[e]);for(e of Fe)this[e]=Dn(t[e],ee[e]);for(e of Le)this[e]=Dn(t[e],ee[e]);for(e of Qe)this[e]=new Te(e,ee[e],t[e],this);for(e of Tt)this[e]=new Te(e,ee[e],t[e],this.tiff);this.setupGlobalFilters(t.pick,t.skip,Tt,Re),t.tiff===!0?this.batchEnableWithBool(Tt,!0):t.tiff===!1?this.batchEnableWithUserValue(Tt,t):Array.isArray(t.tiff)?this.setupGlobalFilters(t.tiff,void 0,Tt):typeof t.tiff=="object"&&this.setupGlobalFilters(t.tiff.pick,t.tiff.skip,Tt)}batchEnableWithBool(t,e){for(let r of t)this[r].enabled=e}batchEnableWithUserValue(t,e){for(let r of t){let n=e[r];this[r].enabled=n!==!1&&n!==void 0}}setupGlobalFilters(t,e,r,n=r){if(t&&t.length){for(let o of n)this[o].enabled=!1;let s=Xo(t,r);for(let[o,a]of s)jr(this[o].pick,a),this[o].enabled=!0}else if(e&&e.length){let s=Xo(e,r);for(let[o,a]of s)jr(this[o].skip,a)}}filterNestedSegmentTags(){let{ifd0:t,exif:e,xmp:r,iptc:n,icc:s}=this;this.makerNote?e.deps.add(37500):e.skip.add(37500),this.userComment?e.deps.add(37510):e.skip.add(37510),r.enabled||t.skip.add(700),n.enabled||t.skip.add(33723),s.enabled||t.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:t,exif:e,gps:r,interop:n}=this;n.needed&&(e.deps.add(40965),t.deps.add(40965)),e.needed&&t.deps.add(34665),r.needed&&t.deps.add(34853),this.tiff.enabled=Tt.some(s=>this[s].enabled===!0)||this.makerNote||this.userComment;for(let s of Tt)this[s].finalizeFilters()}get onlyTiff(){return!_i.map(t=>this[t].enabled).some(t=>t===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let t of Qe)this[t].enabled&&!Ut.has(t)&&zn("segment parser",t)}};f(ge,"q");function Xo(i,t){let e,r,n,s,o=[];for(n of t){for(s of(e=Kt.get(n),r=[],e))(i.includes(s[0])||i.includes(s[1]))&&r.push(s[0]);r.length&&o.push([n,r])}return o}f(Xo,"Q");function Dn(i,t){return i!==void 0?i:t!==void 0?t:void 0}f(Dn,"Z");function jr(i,t){for(let e of t)i.add(e)}f(jr,"ee");ot(ge,"default",ee);var ue=class{constructor(t){ot(this,"parsers",{}),ot(this,"output",{}),ot(this,"errors",[]),ot(this,"pushToErrors",e=>this.errors.push(e)),this.options=ge.useCached(t)}async read(t){this.file=await Ul(t,this.options)}setup(){if(this.fileParser)return;let{file:t}=this,e=t.getUint16(0);for(let[r,n]of me)if(n.canHandle(t,e))return this.fileParser=new n(this.options,this.file,this.parsers),t[r]=!0;this.file.close&&this.file.close(),Gt("Unknown file format")}async parse(){let{output:t,errors:e}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),e.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&e.length>0&&(t.errors=e),Nr(t)}async executeParsers(){let{output:t}=this;await this.fileParser.parse();let e=Object.values(this.parsers).map(async r=>{let n=await r.parse();r.assignToOutput(t,n)});this.options.silentErrors&&(e=e.map(r=>r.catch(this.pushToErrors))),await Promise.all(e)}async extractThumbnail(){this.setup();let{options:t,file:e}=this,r=Ut.get("tiff",t);var n;if(e.tiff?n={start:0,type:"tiff"}:e.jpeg&&(n=await this.fileParser.getOrFindSegment("tiff")),n===void 0)return;let s=await this.fileParser.ensureSegmentChunk(n),o=this.parsers.tiff=new r(s,t,e),a=await o.extractThumbnail();return e.close&&e.close(),a}};f(ue,"te");async function Wr(i,t){let e=new ue(t);return await e.read(i),e.parse()}f(Wr,"ie");var Gl=Object.freeze({__proto__:null,parse:Wr,Exifr:ue,fileParsers:me,segmentParsers:Ut,fileReaders:ye,tagKeys:Kt,tagValues:fe,tagRevivers:Be,createDictionary:Ft,extendDictionary:Je,fetchUrlAsArrayBuffer:Ye,readBlobAsArrayBuffer:qe,chunkedProps:De,otherSegments:_i,segments:Qe,tiffBlocks:Tt,segmentsAndBlocks:Re,tiffExtractables:Le,inheritables:bi,allFormatters:Fe,Options:ge}),Ke=class{constructor(t,e,r){ot(this,"errors",[]),ot(this,"ensureSegmentChunk",async n=>{let s=n.start,o=n.size||65536;if(this.file.chunked)if(this.file.available(s,o))n.chunk=this.file.subarray(s,o);else try{n.chunk=await this.file.readChunk(s,o)}catch(a){Gt(`Couldn't read segment: ${JSON.stringify(n)}. ${a.message}`)}else this.file.byteLength>s+o?n.chunk=this.file.subarray(s,o):n.size===void 0?n.chunk=this.file.subarray(s):Gt("Segment unreachable: "+JSON.stringify(n));return n.chunk}),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=e,this.parsers=r}injectSegment(t,e){this.options[t].enabled&&this.createParser(t,e)}createParser(t,e){let r=new(Ut.get(t))(e,this.options,this.file);return this.parsers[t]=r}createParsers(t){for(let e of t){let{type:r,chunk:n}=e,s=this.options[r];if(s&&s.enabled){let o=this.parsers[r];o&&o.append||o||this.createParser(r,n)}}}async readSegments(t){let e=t.map(this.ensureSegmentChunk);await Promise.all(e)}};f(Ke,"se");var ne=class{static findPosition(t,e){let r=t.getUint16(e+2)+2,n=typeof this.headerLength=="function"?this.headerLength(t,e,r):this.headerLength,s=e+n,o=r-n;return{offset:e,length:r,headerLength:n,start:s,size:o,end:s+o}}static parse(t,e={}){return new this(t,new ge({[this.type]:e}),t).parse()}normalizeInput(t){return t instanceof qt?t:new qt(t)}constructor(t,e={},r){ot(this,"errors",[]),ot(this,"raw",new Map),ot(this,"handleError",n=>{if(!this.options.silentErrors)throw n;this.errors.push(n.message)}),this.chunk=this.normalizeInput(t),this.file=r,this.type=this.constructor.type,this.globalOptions=this.options=e,this.localOptions=e[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(t,e){let r=Be.get(e),n=fe.get(e),s=Kt.get(e),o=this.options[e],a=o.reviveValues&&!!r,l=o.translateValues&&!!n,c=o.translateKeys&&!!s,u={};for(let[h,_]of t)a&&r.has(h)?_=r.get(h)(_):l&&n.has(h)&&(_=this.translateValue(_,n.get(h))),c&&s.has(h)&&(h=s.get(h)||h),u[h]=_;return u}translateValue(t,e){return e[t]||e.DEFAULT||t}assignToOutput(t,e){this.assignObjectToOutput(t,this.constructor.type,e)}assignObjectToOutput(t,e,r){if(this.globalOptions.mergeOutput)return Object.assign(t,r);t[e]?Object.assign(t[e],r):t[e]=r}};f(ne,"re");ot(ne,"headerLength",4),ot(ne,"type",void 0),ot(ne,"multiSegment",!1),ot(ne,"canHandle",()=>!1);function Hl(i){return i===192||i===194||i===196||i===219||i===221||i===218||i===254}f(Hl,"ae");function Wl(i){return i>=224&&i<=239}f(Wl,"oe");function Vl(i,t,e){for(let[r,n]of Ut)if(n.canHandle(i,t,e))return r}f(Vl,"le");var Gi=class extends Ke{constructor(...t){super(...t),ot(this,"appSegments",[]),ot(this,"jpegSegments",[]),ot(this,"unknownSegments",[])}static canHandle(t,e){return e===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(t){t===!0?(this.findAll=!0,this.wanted=new Set(Ut.keyList())):(t=t===void 0?Ut.keyList().filter(e=>this.options[e].enabled):t.filter(e=>this.options[e].enabled&&Ut.has(e)),this.findAll=!1,this.remaining=new Set(t),this.wanted=new Set(t)),this.unfinishedMultiSegment=!1}async findAppSegments(t=0,e){this.setupSegmentFinderArgs(e);let{file:r,findAll:n,wanted:s,remaining:o}=this;if(!n&&this.file.chunked&&(n=Array.from(s).some(a=>{let l=Ut.get(a),c=this.options[a];return l.multiSegment&&c.multiSegment}),n&&await this.file.readWhole()),t=this.findAppSegmentsInRange(t,r.byteLength),!this.options.onlyTiff&&r.chunked){let a=!1;for(;o.size>0&&!a&&(r.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:l}=r,c=this.appSegments.some(u=>!this.file.available(u.offset||u.start,u.length||u.size));if(a=t>l&&!c?!await r.readNextChunk(t):!await r.readNextChunk(l),(t=this.findAppSegmentsInRange(t,r.byteLength))===void 0)return}}}findAppSegmentsInRange(t,e){e-=2;let r,n,s,o,a,l,{file:c,findAll:u,wanted:h,remaining:_,options:g}=this;for(;t<e;t++)if(c.getUint8(t)===255){if(r=c.getUint8(t+1),Wl(r)){if(n=c.getUint16(t+2),s=Vl(c,t,n),s&&h.has(s)&&(o=Ut.get(s),a=o.findPosition(c,t),l=g[s],a.type=s,this.appSegments.push(a),!u&&(o.multiSegment&&l.multiSegment?(this.unfinishedMultiSegment=a.chunkNumber<a.chunkCount,this.unfinishedMultiSegment||_.delete(s)):_.delete(s),_.size===0)))break;g.recordUnknownSegments&&(a=ne.findPosition(c,t),a.marker=r,this.unknownSegments.push(a)),t+=n+1}else if(Hl(r)){if(n=c.getUint16(t+2),r===218&&g.stopAfterSos!==!1)return;g.recordJpegSegments&&this.jpegSegments.push({offset:t,length:n,marker:r}),t+=n+1}}return t}mergeMultiSegments(){if(!this.appSegments.some(e=>e.multiSegment))return;let t=function(e,r){let n,s,o,a=new Map;for(let l=0;l<e.length;l++)n=e[l],s=n[r],a.has(s)?o=a.get(s):a.set(s,o=[]),o.push(n);return Array.from(a)}(this.appSegments,"type");this.mergedAppSegments=t.map(([e,r])=>{let n=Ut.get(e,this.options);return n.handleMultiSegments?{type:e,chunk:n.handleMultiSegments(r)}:r[0]})}getSegment(t){return this.appSegments.find(e=>e.type===t)}async getOrFindSegment(t){let e=this.getSegment(t);return e===void 0&&(await this.findAppSegments(0,[t]),e=this.getSegment(t)),e}};f(Gi,"he");ot(Gi,"type","jpeg"),me.set("jpeg",Gi);var Kl=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4],Dr=class extends ne{parseHeader(){var t=this.chunk.getUint16();t===18761?this.le=!0:t===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(t,e,r=new Map){let{pick:n,skip:s}=this.options[e];n=new Set(n);let o=n.size>0,a=s.size===0,l=this.chunk.getUint16(t);t+=2;for(let c=0;c<l;c++){let u=this.chunk.getUint16(t);if(o){if(n.has(u)&&(r.set(u,this.parseTag(t,u,e)),n.delete(u),n.size===0))break}else!a&&s.has(u)||r.set(u,this.parseTag(t,u,e));t+=12}return r}parseTag(t,e,r){let{chunk:n}=this,s=n.getUint16(t+2),o=n.getUint32(t+4),a=Kl[s];if(a*o<=4?t+=8:t=n.getUint32(t+8),(s<1||s>13)&&Gt(`Invalid TIFF value type. block: ${r.toUpperCase()}, tag: ${e.toString(16)}, type: ${s}, offset ${t}`),t>n.byteLength&&Gt(`Invalid TIFF value offset. block: ${r.toUpperCase()}, tag: ${e.toString(16)}, type: ${s}, offset ${t} is outside of chunk size ${n.byteLength}`),s===1)return n.getUint8Array(t,o);if(s===2)return Ge(n.getString(t,o));if(s===7)return n.getUint8Array(t,o);if(o===1)return this.parseTagValue(s,t);{let l=new(function(u){switch(u){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(s))(o),c=a;for(let u=0;u<o;u++)l[u]=this.parseTagValue(s,t),t+=c;return l}}parseTagValue(t,e){let{chunk:r}=this;switch(t){case 1:return r.getUint8(e);case 3:return r.getUint16(e);case 4:return r.getUint32(e);case 5:return r.getUint32(e)/r.getUint32(e+4);case 6:return r.getInt8(e);case 8:return r.getInt16(e);case 9:return r.getInt32(e);case 10:return r.getInt32(e)/r.getInt32(e+4);case 11:return r.getFloat(e);case 12:return r.getDouble(e);case 13:return r.getUint32(e);default:Gt(`Invalid tiff type ${t}`)}}};f(Dr,"ce");var gi=class extends Dr{static canHandle(t,e){return t.getUint8(e+1)===225&&t.getUint32(e+4)===1165519206&&t.getUint16(e+8)===0}async parse(){this.parseHeader();let{options:t}=this;return t.ifd0.enabled&&await this.parseIfd0Block(),t.exif.enabled&&await this.safeParse("parseExifBlock"),t.gps.enabled&&await this.safeParse("parseGpsBlock"),t.interop.enabled&&await this.safeParse("parseInteropBlock"),t.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(t){let e=this[t]();return e.catch!==void 0&&(e=e.catch(this.handleError)),e}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let t=this.chunk.getUint16(this.ifd0Offset),e=this.ifd0Offset+2+12*t;this.ifd1Offset=this.chunk.getUint32(e)}}parseBlock(t,e){let r=new Map;return this[e]=r,this.parseTags(t,e,r),r}async parseIfd0Block(){if(this.ifd0)return;let{file:t}=this;this.findIfd0Offset(),this.ifd0Offset<8&&Gt("Malformed EXIF data"),!t.chunked&&this.ifd0Offset>t.byteLength&&Gt(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${t.byteLength}`),t.tiff&&await t.ensureChunk(this.ifd0Offset,Fn(this.options));let e=this.parseBlock(this.ifd0Offset,"ifd0");return e.size!==0?(this.exifOffset=e.get(34665),this.interopOffset=e.get(40965),this.gpsOffset=e.get(34853),this.xmp=e.get(700),this.iptc=e.get(33723),this.icc=e.get(34675),this.options.sanitize&&(e.delete(34665),e.delete(40965),e.delete(34853),e.delete(700),e.delete(33723),e.delete(34675)),e):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,Fn(this.options));let t=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=t.get(40965)),this.makerNote=t.get(37500),this.userComment=t.get(37510),this.options.sanitize&&(t.delete(40965),t.delete(37500),t.delete(37510)),this.unpack(t,41728),this.unpack(t,41729),t}unpack(t,e){let r=t.get(e);r&&r.length===1&&t.set(e,r[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let t=this.parseBlock(this.gpsOffset,"gps");return t&&t.has(2)&&t.has(4)&&(t.set("latitude",Zo(...t.get(2),t.get(1))),t.set("longitude",Zo(...t.get(4),t.get(3)))),t}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(t=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||t))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let t=this.ifd1.get(513),e=this.ifd1.get(514);return this.chunk.getUint8Array(t,e)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let t,e,r,n={};for(e of Tt)if(t=this[e],!na(t))if(r=this.canTranslate?this.translateBlock(t,e):Object.fromEntries(t),this.options.mergeOutput){if(e==="ifd1")continue;Object.assign(n,r)}else n[e]=r;return this.makerNote&&(n.makerNote=this.makerNote),this.userComment&&(n.userComment=this.userComment),n}assignToOutput(t,e){if(this.globalOptions.mergeOutput)Object.assign(t,e);else for(let[r,n]of Object.entries(e))this.assignObjectToOutput(t,r,n)}};f(gi,"fe");function Zo(i,t,e,r){var n=i+t/60+e/3600;return r!=="S"&&r!=="W"||(n*=-1),n}f(Zo,"de");ot(gi,"type","tiff"),ot(gi,"headerLength",10),Ut.set("tiff",gi);var $l=Object.freeze({__proto__:null,default:Gl,Exifr:ue,fileParsers:me,segmentParsers:Ut,fileReaders:ye,tagKeys:Kt,tagValues:fe,tagRevivers:Be,createDictionary:Ft,extendDictionary:Je,fetchUrlAsArrayBuffer:Ye,readBlobAsArrayBuffer:qe,chunkedProps:De,otherSegments:_i,segments:Qe,tiffBlocks:Tt,segmentsAndBlocks:Re,tiffExtractables:Le,inheritables:bi,allFormatters:Fe,Options:ge,parse:Wr}),Gn={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},Hn=Object.assign({},Gn,{firstChunkSize:4e4,gps:[1,2,3,4]});async function oa(i){let t=new ue(Hn);await t.read(i);let e=await t.parse();if(e&&e.gps){let{latitude:r,longitude:n}=e.gps;return{latitude:r,longitude:n}}}f(oa,"Se");var Wn=Object.assign({},Gn,{tiff:!1,ifd1:!0,mergeOutput:!1});async function aa(i){let t=new ue(Wn);await t.read(i);let e=await t.extractThumbnail();return e&&Hr?Gr.from(e):e}f(aa,"ye");async function la(i){let t=await this.thumbnail(i);if(t!==void 0){let e=new Blob([t]);return URL.createObjectURL(e)}}f(la,"be");var Vn=Object.assign({},Gn,{firstChunkSize:4e4,ifd0:[274]});async function Kn(i){let t=new ue(Vn);await t.read(i);let e=await t.parse();if(e&&e.ifd0)return e.ifd0[274]}f(Kn,"Pe");var $n=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}}),He=!0,We=!0;if(typeof navigator=="object"){let i=navigator.userAgent;if(i.includes("iPad")||i.includes("iPhone")){let t=i.match(/OS (\d+)_(\d+)/);if(t){let[,e,r]=t;He=Number(e)+.1*Number(r)<13.4,We=!1}}else if(i.includes("OS X 10")){let[,t]=i.match(/OS X 10[_.](\d+)/);He=We=Number(t)<15}if(i.includes("Chrome/")){let[,t]=i.match(/Chrome\/(\d+)/);He=We=Number(t)<81}else if(i.includes("Firefox/")){let[,t]=i.match(/Firefox\/(\d+)/);He=We=Number(t)<77}}async function ha(i){let t=await Kn(i);return Object.assign({canvas:He,css:We},$n[t])}f(ha,"Ae");var Rr=class extends qt{constructor(...t){super(...t),ot(this,"ranges",new Lr),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(t,e,r){if(t===0&&this.byteLength===0&&r){let n=new DataView(r.buffer||r,r.byteOffset,r.byteLength);this._swapDataView(n)}else{let n=t+e;if(n>this.byteLength){let{dataView:s}=this._extend(n);this._swapDataView(s)}}}_extend(t){let e;e=Hr?Gr.allocUnsafe(t):new Uint8Array(t);let r=new DataView(e.buffer,e.byteOffset,e.byteLength);return e.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:e,dataView:r}}subarray(t,e,r=!1){return e=e||this._lengthToEnd(t),r&&this._tryExtend(t,e),this.ranges.add(t,e),super.subarray(t,e)}set(t,e,r=!1){r&&this._tryExtend(e,t.byteLength,t);let n=super.set(t,e);return this.ranges.add(e,n.byteLength),n}async ensureChunk(t,e){this.chunked&&(this.ranges.available(t,e)||await this.readChunk(t,e))}available(t,e){return this.ranges.available(t,e)}};f(Rr,"De");var Lr=class{constructor(){ot(this,"list",[])}get length(){return this.list.length}add(t,e,r=0){let n=t+e,s=this.list.filter(o=>Yo(t,o.offset,n)||Yo(t,o.end,n));if(s.length>0){t=Math.min(t,...s.map(a=>a.offset)),n=Math.max(n,...s.map(a=>a.end)),e=n-t;let o=s.shift();o.offset=t,o.length=e,o.end=n,this.list=this.list.filter(a=>!s.includes(a))}else this.list.push({offset:t,length:e,end:n})}available(t,e){let r=t+e;return this.list.some(n=>n.offset<=t&&r<=n.end)}};f(Lr,"Oe");function Yo(i,t,e){return i<=t&&t<=e}f(Yo,"xe");var $e=class extends Rr{constructor(t,e){super(0),ot(this,"chunksRead",0),this.input=t,this.options=e}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(t=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let e=this.options.chunkSize,r=await this.readChunk(t,e);return!!r&&r.byteLength===e}async readChunk(t,e){if(this.chunksRead++,(e=this.safeWrapAddress(t,e))!==0)return this._readChunk(t,e)}safeWrapAddress(t,e){return this.size!==void 0&&t+e>this.size?Math.max(0,this.size-t):e}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}};f($e,"ve");ye.set("blob",class extends $e{async readWhole(){this.chunked=!1;let i=await qe(this.input);this._swapArrayBuffer(i)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(i,t){let e=t?i+t:void 0,r=this.input.slice(i,e),n=await qe(r);return this.set(n,i,!0)}});var Xl=Object.freeze({__proto__:null,default:$l,Exifr:ue,fileParsers:me,segmentParsers:Ut,fileReaders:ye,tagKeys:Kt,tagValues:fe,tagRevivers:Be,createDictionary:Ft,extendDictionary:Je,fetchUrlAsArrayBuffer:Ye,readBlobAsArrayBuffer:qe,chunkedProps:De,otherSegments:_i,segments:Qe,tiffBlocks:Tt,segmentsAndBlocks:Re,tiffExtractables:Le,inheritables:bi,allFormatters:Fe,Options:ge,parse:Wr,gpsOnlyOptions:Hn,gps:oa,thumbnailOnlyOptions:Wn,thumbnail:aa,thumbnailUrl:la,orientationOnlyOptions:Vn,orientation:Kn,rotations:$n,get rotateCanvas(){return He},get rotateCss(){return We},rotation:ha});ye.set("url",class extends $e{async readWhole(){this.chunked=!1;let i=await Ye(this.input);i instanceof ArrayBuffer?this._swapArrayBuffer(i):i instanceof Uint8Array&&this._swapBuffer(i)}async _readChunk(i,t){let e=t?i+t-1:void 0,r=this.options.httpHeaders||{};(i||e)&&(r.range=`bytes=${[i,e].join("-")}`);let n=await Un(this.input,{headers:r}),s=await n.arrayBuffer(),o=s.byteLength;if(n.status!==416)return o!==t&&(this.size=i+o),this.set(s,i,!0)}});qt.prototype.getUint64=function(i){let t=this.getUint32(i),e=this.getUint32(i+4);return t<1048575?t<<32|e:typeof Pr!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),Pr(t)<<Pr(32)|Pr(e)):void Gt("Trying to read 64b value but JS can only handle 53b numbers.")};var Fr=class extends Ke{parseBoxes(t=0){let e=[];for(;t<this.file.byteLength-4;){let r=this.parseBoxHead(t);if(e.push(r),r.length===0)break;t+=r.length}return e}parseSubBoxes(t){t.boxes=this.parseBoxes(t.start)}findBox(t,e){return t.boxes===void 0&&this.parseSubBoxes(t),t.boxes.find(r=>r.kind===e)}parseBoxHead(t){let e=this.file.getUint32(t),r=this.file.getString(t+4,4),n=t+8;return e===1&&(e=this.file.getUint64(t+8),n+=8),{offset:t,length:e,kind:r,start:n}}parseBoxFullHead(t){if(t.version!==void 0)return;let e=this.file.getUint32(t.start);t.version=e>>24,t.start+=4}};f(Fr,"Re");var Hi=class extends Fr{static canHandle(t,e){if(e!==0)return!1;let r=t.getUint16(2);if(r>50)return!1;let n=16,s=[];for(;n<r;)s.push(t.getString(n,4)),n+=4;return s.includes(this.type)}async parse(){let t=this.file.getUint32(0),e=this.parseBoxHead(t);for(;e.kind!=="meta";)t+=e.length,await this.file.ensureChunk(t,16),e=this.parseBoxHead(t);await this.file.ensureChunk(e.offset,e.length),this.parseBoxFullHead(e),this.parseSubBoxes(e),this.options.icc.enabled&&await this.findIcc(e),this.options.tiff.enabled&&await this.findExif(e)}async registerSegment(t,e,r){await this.file.ensureChunk(e,r);let n=this.file.subarray(e,r);this.createParser(t,n)}async findIcc(t){let e=this.findBox(t,"iprp");if(e===void 0)return;let r=this.findBox(e,"ipco");if(r===void 0)return;let n=this.findBox(r,"colr");n!==void 0&&await this.registerSegment("icc",n.offset+12,n.length)}async findExif(t){let e=this.findBox(t,"iinf");if(e===void 0)return;let r=this.findBox(t,"iloc");if(r===void 0)return;let n=this.findExifLocIdInIinf(e),s=this.findExtentInIloc(r,n);if(s===void 0)return;let[o,a]=s;await this.file.ensureChunk(o,a);let l=4+this.file.getUint32(o);o+=l,a-=l,await this.registerSegment("tiff",o,a)}findExifLocIdInIinf(t){this.parseBoxFullHead(t);let e,r,n,s,o=t.start,a=this.file.getUint16(o);for(o+=2;a--;){if(e=this.parseBoxHead(o),this.parseBoxFullHead(e),r=e.start,e.version>=2&&(n=e.version===3?4:2,s=this.file.getString(r+n+2,4),s==="Exif"))return this.file.getUintBytes(r,n);o+=e.length}}get8bits(t){let e=this.file.getUint8(t);return[e>>4,15&e]}findExtentInIloc(t,e){this.parseBoxFullHead(t);let r=t.start,[n,s]=this.get8bits(r++),[o,a]=this.get8bits(r++),l=t.version===2?4:2,c=t.version===1||t.version===2?2:0,u=a+n+s,h=t.version===2?4:2,_=this.file.getUintBytes(r,h);for(r+=h;_--;){let g=this.file.getUintBytes(r,l);r+=l+c+2+o;let v=this.file.getUint16(r);if(r+=2,g===e)return v>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(r+a,n),this.file.getUintBytes(r+a+n,s)];r+=v*u}}};f(Hi,"Le");var Wi=class extends Hi{};f(Wi,"Ue");ot(Wi,"type","heic");var Vi=class extends Hi{};f(Vi,"Fe");ot(Vi,"type","avif"),me.set("heic",Wi),me.set("avif",Vi),Ft(Kt,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),Ft(Kt,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),Ft(Kt,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),Ft(fe,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);var Ki=Ft(fe,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]),qo={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Ki.set(37392,qo),Ki.set(41488,qo);var Rn={0:"Normal",1:"Low",2:"High"};function Jo(i){return typeof i=="object"&&i.length!==void 0?i[0]:i}f(Jo,"Ge");function Qo(i){let t=Array.from(i).slice(1);return t[1]>15&&(t=t.map(e=>String.fromCharCode(e))),t[2]!=="0"&&t[2]!==0||t.pop(),t.join(".")}f(Qo,"Ve");function Ln(i){if(typeof i=="string"){var[t,e,r,n,s,o]=i.trim().split(/[-: ]/g).map(Number),a=new Date(t,e-1,r);return Number.isNaN(n)||Number.isNaN(s)||Number.isNaN(o)||(a.setHours(n),a.setMinutes(s),a.setSeconds(o)),Number.isNaN(+a)?i:a}}f(Ln,"ze");function ji(i){if(typeof i=="string")return i;let t=[];if(i[1]===0&&i[i.length-1]===0)for(let e=0;e<i.length;e+=2)t.push(ta(i[e+1],i[e]));else for(let e=0;e<i.length;e+=2)t.push(ta(i[e],i[e+1]));return Ge(String.fromCodePoint(...t))}f(ji,"He");function ta(i,t){return i<<8|t}f(ta,"je");Ki.set(41992,Rn),Ki.set(41993,Rn),Ki.set(41994,Rn),Ft(Be,["ifd0","ifd1"],[[50827,function(i){return typeof i!="string"?sa(i):i}],[306,Ln],[40091,ji],[40092,ji],[40093,ji],[40094,ji],[40095,ji]]),Ft(Be,"exif",[[40960,Qo],[36864,Qo],[36867,Ln],[36868,Ln],[40962,Jo],[40963,Jo]]),Ft(Be,"gps",[[0,i=>Array.from(i).join(".")],[7,i=>Array.from(i).join(":")]]);var mi=class extends ne{static canHandle(t,e){return t.getUint8(e+1)===225&&t.getUint32(e+4)===1752462448&&t.getString(e+4,20)==="http://ns.adobe.com/"}static headerLength(t,e){return t.getString(e+4,34)==="http://ns.adobe.com/xmp/extension/"?79:4+28+1}static findPosition(t,e){let r=super.findPosition(t,e);return r.multiSegment=r.extended=r.headerLength===79,r.multiSegment?(r.chunkCount=t.getUint8(e+72),r.chunkNumber=t.getUint8(e+76),t.getUint8(e+77)!==0&&r.chunkNumber++):(r.chunkCount=1/0,r.chunkNumber=-1),r}static handleMultiSegments(t){return t.map(e=>e.chunk.getString()).join("")}normalizeInput(t){return typeof t=="string"?t:qt.from(t).getString()}parse(t=this.chunk){if(!this.localOptions.parse)return t;t=function(s){let o={},a={};for(let l of da)o[l]=[],a[l]=0;return s.replace(Jl,(l,c,u)=>{if(c==="<"){let h=++a[u];return o[u].push(h),`${l}#${h}`}return`${l}#${o[u].pop()}`})}(t);let e=Oe.findAll(t,"rdf","Description");e.length===0&&e.push(new Oe("rdf","Description",void 0,t));let r,n={};for(let s of e)for(let o of s.properties)r=ql(o.ns,n),ca(o,r);return function(s){let o;for(let a in s)o=s[a]=Nr(s[a]),o===void 0&&delete s[a];return Nr(s)}(n)}assignToOutput(t,e){if(this.localOptions.parse)for(let[r,n]of Object.entries(e))switch(r){case"tiff":this.assignObjectToOutput(t,"ifd0",n);break;case"exif":this.assignObjectToOutput(t,"exif",n);break;case"xmlns":break;default:this.assignObjectToOutput(t,r,n)}else t.xmp=e}};f(mi,"We");ot(mi,"type","xmp"),ot(mi,"multiSegment",!0),Ut.set("xmp",mi);var Xe=class{static findAll(t){return ua(t,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Xe.unpackMatch)}static unpackMatch(t){let e=t[1],r=t[2],n=t[3].slice(1,-1);return n=fa(n),new Xe(e,r,n)}constructor(t,e,r){this.ns=t,this.name=e,this.value=r}serialize(){return this.value}};f(Xe,"Ke");var Oe=class{static findAll(t,e,r){if(e!==void 0||r!==void 0){e=e||"[\\w\\d-]+",r=r||"[\\w\\d-]+";var n=new RegExp(`<(${e}):(${r})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else n=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return ua(t,n).map(Oe.unpackMatch)}static unpackMatch(t){let e=t[1],r=t[2],n=t[4],s=t[8];return new Oe(e,r,n,s)}constructor(t,e,r,n){this.ns=t,this.name=e,this.attrString=r,this.innerXml=n,this.attrs=Xe.findAll(r),this.children=Oe.findAll(n),this.value=this.children.length===0?fa(n):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:t,name:e}=this;return t==="rdf"&&(e==="Seq"||e==="Bag"||e==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return Yl(this.children.map(Zl));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let t={};for(let e of this.properties)ca(e,t);return this.value!==void 0&&(t.value=this.value),Nr(t)}};f(Oe,"Xe");function ca(i,t){let e=i.serialize();e!==void 0&&(t[i.name]=e)}f(ca,"_e");var Zl=f(i=>i.serialize(),"Ye"),Yl=f(i=>i.length===1?i[0]:i,"$e"),ql=f((i,t)=>t[i]?t[i]:t[i]={},"Je");function ua(i,t){let e,r=[];if(!i)return r;for(;(e=t.exec(i))!==null;)r.push(e);return r}f(ua,"qe");function fa(i){if(function(r){return r==null||r==="null"||r==="undefined"||r===""||r.trim()===""}(i))return;let t=Number(i);if(!Number.isNaN(t))return t;let e=i.toLowerCase();return e==="true"||e!=="false"&&i.trim()}f(fa,"Qe");var da=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],Jl=new RegExp(`(<|\\/)(${da.join("|")})`,"g"),Ql=Object.freeze({__proto__:null,default:Xl,Exifr:ue,fileParsers:me,segmentParsers:Ut,fileReaders:ye,tagKeys:Kt,tagValues:fe,tagRevivers:Be,createDictionary:Ft,extendDictionary:Je,fetchUrlAsArrayBuffer:Ye,readBlobAsArrayBuffer:qe,chunkedProps:De,otherSegments:_i,segments:Qe,tiffBlocks:Tt,segmentsAndBlocks:Re,tiffExtractables:Le,inheritables:bi,allFormatters:Fe,Options:ge,parse:Wr,gpsOnlyOptions:Hn,gps:oa,thumbnailOnlyOptions:Wn,thumbnail:aa,thumbnailUrl:la,orientationOnlyOptions:Vn,orientation:Kn,rotations:$n,get rotateCanvas(){return He},get rotateCss(){return We},rotation:ha});var ea=zr("fs",i=>i.promises);ye.set("fs",class extends $e{async readWhole(){this.chunked=!1,this.fs=await ea;let i=await this.fs.readFile(this.input);this._swapBuffer(i)}async readChunked(){this.chunked=!0,this.fs=await ea,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(i,t){this.fh===void 0&&await this.open(),i+t>this.size&&(t=this.size-i);var e=this.subarray(i,t,!0);return await this.fh.read(e.dataView,0,t,i),e}async close(){if(this.fh){let i=this.fh;this.fh=void 0,await i.close()}}});ye.set("base64",class extends $e{constructor(...i){super(...i),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(i,t){let e,r,n=this.input;i===void 0?(i=0,e=0,r=0):(e=4*Math.floor(i/3),r=i-e/4*3),t===void 0&&(t=this.size);let s=i+t,o=e+4*Math.ceil(s/3);n=n.slice(e,o);let a=Math.min(t,this.size-i);if(Hr){let l=Gr.from(n,"base64").slice(r,r+a);return this.set(l,i,!0)}{let l=this.subarray(i,a,!0),c=atob(n),u=l.toUint8();for(let h=0;h<a;h++)u[h]=c.charCodeAt(r+h);return l}}});var $i=class extends Ke{static canHandle(t,e){return e===18761||e===19789}extendOptions(t){let{ifd0:e,xmp:r,iptc:n,icc:s}=t;r.enabled&&e.deps.add(700),n.enabled&&e.deps.add(33723),s.enabled&&e.deps.add(34675),e.finalizeFilters()}async parse(){let{tiff:t,xmp:e,iptc:r,icc:n}=this.options;if(t.enabled||e.enabled||r.enabled||n.enabled){let s=Math.max(Fn(this.options),this.options.chunkSize);await this.file.ensureChunk(0,s),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(t){if(this.parsers.tiff[t]){let e=this.parsers.tiff[t];this.injectSegment(t,e)}}};f($i,"ot");ot($i,"type","tiff"),me.set("tiff",$i);var th=zr("zlib"),eh=["ihdr","iccp","text","itxt","exif"],Xi=class extends Ke{constructor(...t){super(...t),ot(this,"catchError",e=>this.errors.push(e)),ot(this,"metaChunks",[]),ot(this,"unknownChunks",[])}static canHandle(t,e){return e===35152&&t.getUint32(0)===2303741511&&t.getUint32(4)===218765834}async parse(){let{file:t}=this;await this.findPngChunksInRange(8,t.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(t,e){let{file:r}=this;for(;t<e;){let n=r.getUint32(t),s=r.getUint32(t+4),o=r.getString(t+4,4).toLowerCase(),a=n+4+4+4,l={type:o,offset:t,length:a,start:t+4+4,size:n,marker:s};eh.includes(o)?this.metaChunks.push(l):this.unknownChunks.push(l),t+=a}}parseTextChunks(){let t=this.metaChunks.filter(e=>e.type==="text");for(let e of t){let[r,n]=this.file.getString(e.start,e.size).split("\0");this.injectKeyValToIhdr(r,n)}}injectKeyValToIhdr(t,e){let r=this.parsers.ihdr;r&&r.raw.set(t,e)}findIhdr(){let t=this.metaChunks.find(e=>e.type==="ihdr");t&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",t.chunk)}async findExif(){let t=this.metaChunks.find(e=>e.type==="exif");t&&this.injectSegment("tiff",t.chunk)}async findXmp(){let t=this.metaChunks.filter(e=>e.type==="itxt");for(let e of t)e.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",e.chunk)}async findIcc(){let t=this.metaChunks.find(a=>a.type==="iccp");if(!t)return;let{chunk:e}=t,r=e.getUint8Array(0,81),n=0;for(;n<80&&r[n]!==0;)n++;let s=n+2,o=e.getString(0,n);if(this.injectKeyValToIhdr("ProfileName",o),Br){let a=await th,l=e.getUint8Array(s);l=a.inflateSync(l),this.injectSegment("icc",l)}}};f(Xi,"ut");ot(Xi,"type","png"),me.set("png",Xi),Ft(Kt,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),Je(Kt,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);var ia=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];Je(Kt,"ifd0",ia),Je(Kt,"exif",ia),Ft(fe,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);var yi=class extends ne{static canHandle(t,e){return t.getUint8(e+1)===224&&t.getUint32(e+4)===1246120262&&t.getUint8(e+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}};f(yi,"ft");ot(yi,"type","jfif"),ot(yi,"headerLength",9),Ut.set("jfif",yi),Ft(Kt,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);var Zi=class extends ne{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}};f(Zi,"dt");ot(Zi,"type","ihdr"),Ut.set("ihdr",Zi),Ft(Kt,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),Ft(fe,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);var Ze=class extends ne{static canHandle(t,e){return t.getUint8(e+1)===226&&t.getUint32(e+4)===1229144927}static findPosition(t,e){let r=super.findPosition(t,e);return r.chunkNumber=t.getUint8(e+16),r.chunkCount=t.getUint8(e+17),r.multiSegment=r.chunkCount>1,r}static handleMultiSegments(t){return function(e){let r=function(n){let s=n[0].constructor,o=0;for(let c of n)o+=c.length;let a=new s(o),l=0;for(let c of n)a.set(c,l),l+=c.length;return a}(e.map(n=>n.chunk.toUint8()));return new qt(r)}(t)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:t}=this;this.chunk.byteLength<84&&Gt("ICC header is too short");for(let[e,r]of Object.entries(ih)){e=parseInt(e,10);let n=r(this.chunk,e);n!=="\0\0\0\0"&&t.set(e,n)}}parseTags(){let t,e,r,n,s,{raw:o}=this,a=this.chunk.getUint32(128),l=132,c=this.chunk.byteLength;for(;a--;){if(t=this.chunk.getString(l,4),e=this.chunk.getUint32(l+4),r=this.chunk.getUint32(l+8),n=this.chunk.getString(e,4),e+r>c)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");s=this.parseTag(n,e,r),s!==void 0&&s!=="\0\0\0\0"&&o.set(t,s),l+=12}}parseTag(t,e,r){switch(t){case"desc":return this.parseDesc(e);case"mluc":return this.parseMluc(e);case"text":return this.parseText(e,r);case"sig ":return this.parseSig(e)}if(!(e+r>this.chunk.byteLength))return this.chunk.getUint8Array(e,r)}parseDesc(t){let e=this.chunk.getUint32(t+8)-1;return Ge(this.chunk.getString(t+12,e))}parseText(t,e){return Ge(this.chunk.getString(t+8,e-8))}parseSig(t){return Ge(this.chunk.getString(t+8,4))}parseMluc(t){let{chunk:e}=this,r=e.getUint32(t+8),n=e.getUint32(t+12),s=t+16,o=[];for(let a=0;a<r;a++){let l=e.getString(s+0,2),c=e.getString(s+2,2),u=e.getUint32(s+4),h=e.getUint32(s+8)+t,_=Ge(e.getUnicodeString(h,u));o.push({lang:l,country:c,text:_}),s+=n}return r===1?o[0].text:o}translateValue(t,e){return typeof t=="string"?e[t]||e[t.toLowerCase()]||t:e[t]||t}};f(Ze,"pt");ot(Ze,"type","icc"),ot(Ze,"multiSegment",!0),ot(Ze,"headerLength",18);var ih={4:ke,8:function(i,t){return[i.getUint8(t),i.getUint8(t+1)>>4,i.getUint8(t+1)%16].map(e=>e.toString(10)).join(".")},12:ke,16:ke,20:ke,24:function(i,t){let e=i.getUint16(t),r=i.getUint16(t+2)-1,n=i.getUint16(t+4),s=i.getUint16(t+6),o=i.getUint16(t+8),a=i.getUint16(t+10);return new Date(Date.UTC(e,r,n,s,o,a))},36:ke,40:ke,48:ke,52:ke,64:(i,t)=>i.getUint32(t),80:ke};function ke(i,t){return Ge(i.getString(t,4))}f(ke,"mt");Ut.set("icc",Ze),Ft(Kt,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);var Mr={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},ra={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};Ft(fe,"icc",[[4,Mr],[12,ra],[40,Object.assign({},Mr,ra)],[48,Mr],[80,Mr],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);var Ve=class extends ne{static canHandle(t,e,r){return t.getUint8(e+1)===237&&t.getString(e+4,9)==="Photoshop"&&this.containsIptc8bim(t,e,r)!==void 0}static headerLength(t,e,r){let n,s=this.containsIptc8bim(t,e,r);if(s!==void 0)return n=t.getUint8(e+s+7),n%2!=0&&(n+=1),n===0&&(n=4),s+8+n}static containsIptc8bim(t,e,r){for(let n=0;n<r;n++)if(this.isIptcSegmentHead(t,e+n))return n}static isIptcSegmentHead(t,e){return t.getUint8(e)===56&&t.getUint32(e)===943868237&&t.getUint16(e+4)===1028}parse(){let{raw:t}=this,e=this.chunk.byteLength-1,r=!1;for(let n=0;n<e;n++)if(this.chunk.getUint8(n)===28&&this.chunk.getUint8(n+1)===2){r=!0;let s=this.chunk.getUint16(n+3),o=this.chunk.getUint8(n+2),a=this.chunk.getLatin1String(n+5,s);t.set(o,this.pluralizeValue(t.get(o),a)),n+=4+s}else if(r)break;return this.translate(),this.output}pluralizeValue(t,e){return t!==void 0?t instanceof Array?(t.push(e),t):[t,e]:e}};f(Ve,"yt");ot(Ve,"type","iptc"),ot(Ve,"translateValues",!1),ot(Ve,"reviveValues",!1),Ut.set("iptc",Ve),Ft(Kt,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),Ft(fe,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);var pa=Ql;var ti=class{constructor(t,e,r,n=null,s=null){this.coord=null;this.elevation_data=!1;this.description=null;this.id="img_"+ie.makeid(),this.name=t,this.image=e,this.date=r,this.coord=n,this.elevation_data=!!n,this.description=s}get filename(){let t="jpg",e=this.name.lastIndexOf(".");return e>-1&&(t=this.name.substring(e+1)),"images/"+this.id+"."+t}to_html_img(){return`<img alt="${this.name}" src="${this.filename}" style="max-width:1024px"/>`}static parse(t,e){t=t??"image",t.replaceAll("\\","/");let r=t.lastIndexOf("/");return r>-1&&(t=t.substring(r+1)),new Promise(n=>{pa.parse(e??t).then(s=>{let o=new Date(2e3,0,1),a,l=null;if(s){s.DateTimeOriginal&&typeof s.DateTimeOriginal.getTime=="function"?o=s.DateTimeOriginal:s.DateTime&&typeof s.DateTime.getTime=="function"&&(o=s.DateTime);let u=null;typeof s.latitude=="number"?u=s.latitude:Array.isArray(s.GPSLatitude)&&s.GPSLatitude.length==3&&(u=s.GPSLatitude[0]+s.GPSLatitude[1]/60+s.GPSLatitude[2]/(60*60));let h=null;typeof s.longitude=="number"?h=s.longitude:Array.isArray(s.GPSLongitude)&&s.GPSLongitude.length==3&&(h=s.GPSLongitude[0]+s.GPSLongitude[1]/60+s.GPSLongitude[2]/(60*60));let _=typeof s.GPSAltitude=="number"?s.GPSAltitude:void 0;u&&h&&(a=kt.deg(u,h,_)),typeof s.UserComment=="string"&&(l=s.UserComment)}let c=new ti(t,e,o,a,l);n(c)})})}};f(ti,"Photo");var Oh=wa(),xa="1.0.5.2",Sa="1680514102070",Ca=ae;var Ji,Xn,qi=class{constructor(t,e=ae){Yn(this,Ji);this.igccontents=[];this.filenames=[];this.taskcontent=null;this.photos=[];this.cv=t,this.options={...ae,...e}}setOptions(t){this.options={...ae,...t}}addIGC(t,e){this.igccontents.push([e??`track${this.igccontents.length}.igc`,t])}addTask(t){this.taskcontent=t}addPhoto(t,e){this.photos.push([e??`track${this.photos.length+1}.igc`,t])}clear(){this.photos=this.filenames=this.igccontents=[],this.taskcontent=null}toKMZ(){return $r(this,Ji,Xn).call(this)}toKML(){return $r(this,Ji,Xn).call(this,!0)}};f(qi,"IGC2KMZ"),Ji=new WeakSet,Xn=f(function(t=!1){let e=[],r=-1;for(let o=0;o<this.igccontents.length;o++){let a=Oh.parse(this.igccontents[o][1],{lenient:!0});if(this.options.same_start&&a.fixes.length>0)if(r<0)r=a.fixes[0].timestamp;else{let l=r-a.fixes[0].timestamp;a.fixes.forEach(c=>c.timestamp+=l)}e.push(new be(new Ue(a,this.igccontents[o][0],this.options)))}let n=null;this.taskcontent&&(n=pe.loadTask(this.taskcontent));let s=[];return e.length>0&&this.photos&&this.photos.forEach(o=>{s.push(ti.parse(o[0],o[1]))}),new Promise(o=>{Promise.all(s).then(a=>{e.length>0&&a.length>0&&e[e.length-1].photos.push(...a),new Si(this.cv).convert(e,this.options,n,t).then(o)})})},"#convert");var Vr=class{constructor(){this.fontname="Source Sans Pro"}create_canvas(t,e){return new Promise(r=>{let n=document.createElement("canvas");n.setAttribute("width",t.toString()),n.setAttribute("height",e.toString()),r(n)})}get_base64(t){return new Promise(e=>{let r=t.toDataURL();e(r.substring(r.indexOf("base64,")+7))})}};f(Vr,"WebCanvas");if(typeof window=="object"){let i=function(t,e,r,n,s){let o=new Vr,a=new qi(o,s);if(t=Array.isArray(t)?t:[t??""],e=Array.isArray(e)?e:[e??""],e.length<t.length)for(let u=e.length;u<t.length;u++)e.push(`track${u+1}.igc`);let l=e.length>0&&e[0].trim().length>0?e[0]:"track.igc",c=l.lastIndexOf(".");return c>=0&&(l=l.substring(0,c)),l+=".kmz",t.forEach((u,h)=>a.addIGC(u,e&&e[h]||"")),r&&a.addTask(r),n&&n.forEach(u=>{a.addPhoto(u[1],u[0])}),new Promise(u=>{a.toKMZ().then(h=>{h&&((0,ka.saveAs)(new Blob([h]),l),u(l))})})};ed=i,f(i,"igc2kmzwrapper"),window.igc2kmz=i,window.DEFAULT_IGC2KMZ_CONFIGURATION=Ca,window.IGC2KMZ_VERSION=xa,window.IGC2KMZ_BUILDDATE=new Date(parseInt(Sa))}var ed;})();
/*! Bundled license information:

jszip/dist/jszip.min.js:
  (*!
  
  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>
  
  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.
  
  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  *)
*/
